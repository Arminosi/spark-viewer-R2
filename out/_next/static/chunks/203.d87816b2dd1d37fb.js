(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[203],{203:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>tp});var n=s(7876),r=s(8847),a=s.n(r),i=s(4232),l=s(3038),o=s(6570),c=s.n(o),d=s(1041),u=s(7460),h=s(9915);function p(){let[e,t]=(0,i.useState)(!0);if(!e)return null;let s=(0,n.jsx)("span",{role:"img","aria-label":"warning",children:"⚠️"});return(0,n.jsxs)(h.A,{extraClassName:c()["version-warning"],children:[s,(0,n.jsx)("b",{children:" This profile was created using an old version of spark! "}),s,(0,n.jsx)(u.g,{icon:d.GRI,onClick:function(){t(!1)}}),(0,n.jsx)("br",{}),"Some viewer features cannot be supported. Please consider updating to a newer version."]})}var m=s(140),f=s(4344),g=s(3957),x=s(9099);let v=e=>(t,s)=>{if(!Array.isArray(s))return e(t,s);for(let n of s)if(e(t,n))return!0;return!1},w=v((e,t)=>e.has(t)),j=v((e,t)=>(e.add(t),!1)),b=v((e,t)=>(e.delete(t),!1));var k=s(2162);class N{resolveSearchQuery(e){let t=new Set;for(let s of this.data.nodes.threadNodes)this.resolve(s,e,t);return t}resolve(e,t,s){for(let n of(!s.has(e.id)&&this.nodeMatchesQuery(t,e)&&(s.add(e.id),this.addAllChildren(e,s),this.addAllParents(e,s)),e.children))this.resolve(n,t,s)}addAllChildren(e,t){for(let s of e.children)t.add(e.id),this.addAllChildren(s,t)}addAllParents(e,t){for(let s of this.data.bottomUp.getParents(e.id))t.add(s)}nodeMatchesQuery(e,t){if((0,k.fX)(t))return t.name.toLowerCase().includes(e);{let s=this.data.sources.getSource(t.id);return t.className.toLowerCase().includes(e)||t.methodName.toLowerCase().includes(e)||s&&s.toLowerCase().includes(e)}}constructor(e){this.data=e}}var y=s(3576),S=s(2701),C=function(e){return e[e.KEEP_LISTENING=0]="KEEP_LISTENING",e[e.STOP_LISTENING=1]="STOP_LISTENING",e}({});class T{register(e){return this.listeners.push(e),()=>this.unregister(e)}unregister(e){let t=this.listeners.indexOf(e);t>=0&&this.listeners.splice(t,1)}dispatch(e){let t=[];this.listeners.forEach((s,n)=>{s(e)===C.STOP_LISTENING&&t.unshift(n)}),t.forEach(e=>this.listeners.splice(e,1))}constructor(){this.listeners=[]}}var M=s(3270),I=s.n(M),A=s(5436);class E{async run(){this.socket.eventBus.register(this.onMessage.bind(this)),await this.sendClientConnect()}async sendClientConnect(){let{browser:e,os:t}=I().parse(window.navigator.userAgent),s={clientId:this.clientId,description:"".concat(e.name," on ").concat(t.name)};await this.socket.send({oneofKind:"clientConnect",clientConnect:s})}constructor(e,t){this.onMessage=e=>{if("serverConnectResponse"!==e.oneofKind)return C.KEEP_LISTENING;let t=e.serverConnectResponse;if(t.clientId!==this.clientId)return C.KEEP_LISTENING;if(t.state===A.zr.ACCEPTED||t.state===A.zr.UNTRUSTED){let e=t.state===A.zr.ACCEPTED;return console.log("[WS] Established connection with server (".concat(e?"trusted":"untrusted",")")),this.socket.startKeepalive(this.listener.onPing).then(e=>{}),this.listener.onConnect(this.socket,t.settings,e,this.clientId,t.lastPayloadId),e?C.STOP_LISTENING:C.KEEP_LISTENING}if(t.state===A.zr.REJECTED)return console.log("[WS] Rejected by server, disconnecting."),this.socket.socket.close(),C.STOP_LISTENING;throw Error("unknown state: ".concat(t.state))},this.socket=e,this.listener=t,this.clientId="".concat(P(4),"-").concat(P(4))}}function P(e){let t=new Uint8Array((e||40)/2);return crypto.getRandomValues(t),Array.from(t,function(e){return e.toString(16).padStart(2,"0")}).join("")}var L=s(943),_=s(6823);async function D(){let e=(0,_.get)("viewer-public-key"),t=(0,_.get)("viewer-private-key");if(e&&t){var s,n;return{publicKey:await (s=(0,L.D)(e),F("spki",s,[])),privateKey:await (n=(0,L.D)(t),F("pkcs8",n,["sign"]))}}}async function V(){let{publicKey:e,privateKey:t}=await crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["sign"]),s=await crypto.subtle.exportKey("spki",e);(0,_.set)("viewer-public-key",(0,L.l)(s));let n=await crypto.subtle.exportKey("pkcs8",t);return(0,_.set)("viewer-private-key",(0,L.l)(n)),{publicKey:e,privateKey:t}}function F(e,t,s){return crypto.subtle.importKey(e,t,{name:"RSASSA-PKCS1-v1_5",hash:"SHA-256"},!0,s)}var K=s(5583);class O{static async connect(e,t,n){console.log("[WS] Creating remote socket client");let r=new Worker(s.tu(new URL(s.p+s.u(614),s.b))),a=(0,K.LV)(r);return new O(await new a(e,t,(0,K.BX)({onclose:(0,K.BX)(n.onclose),onerror:(0,K.BX)(n.onerror),onmessage:(0,K.BX)(n.onmessage),onopen:(0,K.BX)(n.onopen)})))}async send(e){await this.proxy.send((0,K.k0)(e,[e.buffer]))}async startKeepalive(e){await this.proxy.startKeepalive((0,K.BX)(e))}async close(){await this.proxy.close(),this.proxy[K.A2]()}constructor(e){this.proxy=e}}class R{static async connect(e,t){let s=await D()||await V(),n=await F("spki",e.publicKey,["verify"]);console.log("[WS] Loaded viewer keys and decoded remote public key");let r=new R,a=await O.connect(e.channelId,{remotePublicKey:n,localPublicKey:s.publicKey,localPrivateKey:s.privateKey},{onclose:()=>{t.onClose()},onopen:()=>{console.log("[WS] Socket open, initialising connection..."),new E(r,t).run()},onmessage:e=>{r.onReceive(e)},onerror:()=>{}});r.setSocket(a)}setSocket(e){this.socket=e}async startKeepalive(e){await this.socket.startKeepalive(e)}async send(e){await this.socket.send(A.A1.toBinary({packet:e}))}async onReceive(e){this.eventBus.dispatch(A.A1.fromBinary(e).packet)}constructor(){this.eventBus=new T}}class B{static async create(e){let t=new Worker(s.tu(new URL(s.p+s.u(467),s.b))),n=(0,K.LV)(t),r={threads:e.threads,sources:e.sources};return new B(await new n(r))}generateFlatView(){return this.proxy.generateFlatView()}generateSourcesView(){return this.proxy.generateSourcesView()}close(){this.proxy[K.A2]()}constructor(e){this.proxy=e}}var U=s(1630),W=s.n(U),G=s(5573),X=s(8144),$=s(7328),z=s.n($),Q=s(3213),q=s(2779);function Y(e){let{metadata:t}=e,{user:s,startTime:r,interval:a,dataAggregator:i}=t,l=t.comment?'"'+t.comment+'"':"",[o,c]=(0,q.Yq)(r),d="";i&&i.type===A.zy.TICKED&&(d=", ticks >= "+i.tickLengthThreshold/1e3+"ms");let u=t.samplerMode===A.gi.ALLOCATION,h=u?(0,q.DL)(a):"".concat(a/1e3,"ms");return(0,n.jsxs)("div",{className:"textbox title",children:[(0,n.jsx)(z(),{children:(0,n.jsxs)("title",{children:[u?"Memory Profile":"Profile"," @ ",o," ",c," | spark"]})}),(0,n.jsxs)("span",{children:[l,(0,n.jsx)(Q.A,{user:s,platform:t.platform}),null==s?void 0:s.name," @ ",o," ",c,", interval"," ",h,d]})]})}var H=s(2318);function J(e){let{setFlameData:t}=e;return(0,n.jsx)(H.A,{icon:d.GRI,onClick:function(){t(void 0)},title:"Exit the Flame Graph view"})}class Z{getId(){return this.node.id}getDetails(){return(0,k.fX)(this.node)?{type:"thread",name:this.node.name}:{type:"stackTrace",className:this.node.className,methodName:this.node.methodName,parentLineNumber:this.node.parentLineNumber,lineNumber:this.node.lineNumber,methodDesc:this.node.methodDesc}}getTime(){return this.node.time}getTimes(){return this.node.times}getChildren(){return void 0===this.children&&(this.children=this.node.children.map(e=>new Z(this.data,e,this))),this.children}getParents(){return this.parent?[this.parent]:[]}getSource(){return this.data.sources.getSource(this.node.id)}constructor(e,t,s){this.data=e,this.node=t,this.parent=s}}function ee(e){let{data:t,setFlameData:s}=e;return 1!==t.threads.length?null:(0,n.jsx)(H.A,{icon:d.kNw,onClick:function(){s(new Z(t,t.threads[0]))},title:"View the profile as a Flame Graph"})}function et(e){let{graphSupported:t,showGraph:s,setShowGraph:r}=e;return t?(0,n.jsx)(H.A,{icon:d.gK3,onClick:function(){r(e=>!e)},title:"View the graph",extraClassName:s?"toggled":void 0}):null}var es=s(5039),en=s.n(es),er=s(1995);function ea(e){var t,s;let{socket:r,showSocketInfo:a,setShowSocketInfo:i}=e;return r.socket.socket?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:en()("last-update-spinner button textbox",{toggled:a}),onClick:function(e){i(e=>!e)},children:(0,n.jsx)(er.F,{isPlaying:!0,size:26,strokeWidth:4,duration:null!=(s=null==(t=r.socket.settings)?void 0:t.samplerInterval)?s:60,colors:"#b5b5b5",trailColor:"#3c3f41",children:()=>{var e,t;return(0,n.jsx)(er.F,{isPlaying:!0,size:16,strokeWidth:4,duration:null!=(t=null==(e=r.socket.settings)?void 0:e.statisticsInterval)?t:10,colors:"#b5b5b5",trailColor:"#3c3f41"},r.lastStatsUpdate)}},r.lastSamplerUpdate)})}):null}function ei(e){let{searchQuery:t}=e;return(0,n.jsx)("input",{className:"searchbar",type:"text",value:t.value,onChange:function(e){t.setValue(e.target.value.toLowerCase())}})}function el(e){let{showSettings:t,setShowSettings:s}=e;return(0,n.jsx)(H.A,{icon:d._$s,onClick:function(){s(e=>!e)},title:"Click to show the settings menu",extraClassName:t?"toggled":void 0})}let eo="flat";function ec(e){let{metadata:t,view:s,setView:r,sourcesViewSupported:a}=e,i=["all",eo,...a?["sources"]:[]];return(0,n.jsx)(n.Fragment,{children:i.map(e=>{let a;if("all"===e)a="all";else if(e===eo)a="flat";else{var i;a=["Fabric","Forge","NeoForge"].includes((null==t||null==(i=t.platform)?void 0:i.name)||"")?"mods":"plugins"}return(0,n.jsx)(H.A,{icon:d.pS3,onClick:function(){r(e)},title:"Toggle the view",extraClassName:s===e?"sources-view-button toggled":"sources-view-button",children:(0,n.jsx)("span",{children:a})},a)})})}function ed(e){let{data:t,metadata:s,metadataToggle:r,exportCallback:a,showSettings:i,setShowSettings:l,view:o,setView:c,sourcesViewSupported:d,graphSupported:u,showGraph:h,setShowGraph:p,socket:m,showSocketInfo:f,setShowSocketInfo:g,flameData:x,setFlameData:v,searchQuery:w}=e;return(0,n.jsxs)("div",{className:W().controls,children:[(0,n.jsx)(Y,{metadata:s}),(0,n.jsx)(X.A,{metadata:s,metadataToggle:r}),(0,n.jsx)(et,{graphSupported:u,showGraph:h,setShowGraph:p}),(0,n.jsx)(el,{showSettings:i,setShowSettings:l}),x?(0,n.jsx)(J,{setFlameData:v}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ec,{metadata:s,view:o,setView:c,sourcesViewSupported:d}),(0,n.jsx)(ee,{data:t,setFlameData:v}),(0,n.jsx)(G.A,{exportCallback:a}),(0,n.jsx)(ei,{searchQuery:w})]}),(0,n.jsx)(ea,{socket:m,showSocketInfo:f,setShowSocketInfo:g})]})}var eu=s(7560),eh=s(3860);function ep(e){let{flameData:t,mappings:s,metadata:r,timeSelector:a}=e,l=a.getTime,o=r.samplerMode===A.gi.ALLOCATION,[c,d]=(0,i.useMemo)(()=>(function e(t,s,n,r){let a,i,l=t.getDetails();if("thread"===l.type)a=l.name;else if("stackTrace"===l.type){let e=s.resolve(l);if("native"===e.type)a=l.methodName+" (native)";else{let{className:s,methodName:n,packageName:o}=e;o=em(o,"nms.",/^net\.minecraft\.server(?:\.v[0-9R_]+)?\.(.*)$/),o=em(o,"nm.",/^net\.minecraft(?:\.v[0-9R_]+)?\.(.*)$/),o=em(o,"obc.",/^org\.bukkit\.craftbukkit(?:\.v[0-9R_]+)?\.(.*)$/),a="".concat(o||"").concat(s,".").concat(n,"()");let c=r?(0,q.DL)(t.getTime()):"".concat(t.getTime(),"ms");i="".concat(l.className,".").concat(l.methodName,"() - ").concat(c)}}else throw Error("unknown type: "+l.type);let o=n(t),c=[],d=1;for(let a of t.getChildren().sort((e,t)=>n(t)-n(e))){let[t,i]=e(a,s,n,r);d=Math.max(d,i+1),c.push(t)}return[{name:a,tooltip:i,value:o,children:c},d]})(t,s,l,o),[t,s,l,o]),u=Math.min(20*d,5e3);return(0,n.jsx)("div",{className:"flame",style:{height:"".concat(u,"px")},children:(0,n.jsx)(eh.t$,{children:e=>{let{width:t}=e;return(0,n.jsx)(eu.C,{data:c,height:u,width:t})}})})}function em(e,t,s){if(!e)return e;let n=e.match(s);return n&&2===n.length&&(e=t+n[1]),e}function ef(e){let{isConnectedToSocket:t}=e;return(0,n.jsxs)(h.A,{extraClassName:c()["no-data"],children:[(0,n.jsxs)("h2",{children:[(0,n.jsx)(u.g,{icon:d.QJT})," ",(0,n.jsx)("b",{children:"No Data"})]}),t?(0,n.jsx)("p",{children:"This profile doesn't contain any data yet! The viewer will refresh shortly."}):(0,n.jsx)("p",{children:"This profile doesn't contain any data!"})]})}function eg(e){var t;let{socket:s}=e,{clientId:r,settings:a,latency:i}=s.socket;return(0,n.jsxs)(h.A,{extraClassName:c()["socket-info"],children:[(0,n.jsxs)("h2",{children:[(0,n.jsx)(u.g,{icon:d.jBL,color:"#89d753"})," ",(0,n.jsx)("b",{children:"Connected"})," via WebSocket"]}),(0,n.jsxs)("p",{children:["spark viewer is connected to the spark profiler using a socket connection. ",(0,n.jsx)("br",{}),"The statistics will update every"," ",null!=(t=null==a?void 0:a.statisticsInterval)?t:"?"," seconds, and the profiler data will update every minute."]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("b",{children:"Latency"}),": ",null!=i?i:"?","ms",(0,n.jsx)("br",{}),(0,n.jsx)("b",{children:"Client ID"}),": ",r]})]})}let ex=(0,i.createContext)(void 0),ev=(0,i.createContext)(void 0),ew=(0,i.createContext)(void 0),ej=(0,i.createContext)(void 0),eb=(0,i.createContext)(void 0),ek=(0,i.createContext)(!1),eN=(0,i.createContext)(void 0);function ey(e){let{mappings:t,infoPoints:s,highlighted:r,searchQuery:a,labelMode:i,metadata:l,timeSelector:o,children:c}=e;return(0,n.jsx)(ex.Provider,{value:t,children:(0,n.jsx)(ev.Provider,{value:s,children:(0,n.jsx)(ew.Provider,{value:r,children:(0,n.jsx)(ej.Provider,{value:a,children:(0,n.jsx)(ek.Provider,{value:i,children:(0,n.jsx)(eb.Provider,{value:l,children:(0,n.jsx)(eN.Provider,{value:o,children:c})})})})})})})}class eS{addNode(e){let t=eS.keyForNode(e),s=this.map.get(t);void 0===s&&(s=[],this.map.set(t,s)),s.push(e)}build(){return Array.from(this.map.values())}static keyForNode(e){return"".concat(e.className,"\0").concat(e.methodName,"\0").concat(e.methodDesc)}constructor(){this.map=new Map}}class eC{getId(){return 1==this.nodes.length?this.nodes[0].id:this.nodes.map(e=>e.id)}getDetails(){let e=this.nodes[0];return(0,k.fX)(e)?{type:"thread",name:e.name}:{type:"stackTrace",className:e.className,methodName:e.methodName,parentLineNumber:e.parentLineNumber,lineNumber:e.lineNumber,methodDesc:e.methodDesc}}getTime(){return this.nodes.reduce((e,t)=>e+t.time,0)}getTimes(){if(1===this.nodes.length)return this.nodes[0].times;let e=this.nodes[0].times.length;return this.nodes.reduce((t,s)=>{for(let n=0;n<e;n++)t[n]=t[n]+s.times[n];return t},Array(e).fill(0))}getChildren(){if(1==this.nodes.length)return this.nodes[0].children.map(e=>new eC(this.data,[e]));let e=new eS;return this.nodes.flatMap(e=>e.children).forEach(t=>e.addNode(t)),e.build().map(e=>new eC(this.data,e))}getParents(){let e=new eS,t=[];return this.nodes.map(e=>this.data.bottomUp.getParent(e.id)).filter(e=>void 0!==e).map(e=>this.data.nodes.getNode(e)).forEach(s=>{(0,k.fX)(s)?t.push(s):e.addNode(s)}),[...t.map(e=>new Z(this.data,e)),...e.build().map(e=>new eC(this.data,e))]}getSource(){for(let e of this.nodes){let t=this.data.sources.getSource(e.id);if(t)return t}}constructor(e,t){if(this.data=e,this.nodes=t,0===t.length)throw Error("nodes length is 0")}}class eT{getId(){return this.node.id}getDetails(){return{type:"thread",name:this.node.name}}getTime(){return this.node.threadTime}getTimes(){return this.node.threadTimes}getChildren(){return void 0===this.children&&(this.children=this.node.children.map(e=>new eC(this.data,e.map(e=>this.data.nodes.getNode(e))))),this.children}getParents(){return[]}getSource(){return this.data.sources.getSource(this.node.id)}getSourceTime(){return this.node.sourceTime}constructor(e,t){this.data=e,this.node=t}}class eM{getId(){return this.node.id}getDetails(){return{type:"thread",name:this.node.name}}getTime(){return this.node.time}getTimes(){return this.node.times}getChildren(){return void 0===this.children&&(this.children=this.node.children.map(e=>new eC(this.data,e.map(e=>this.data.nodes.getNode(e))))),this.children}getParents(){return[]}getSource(){return this.data.sources.getSource(this.node.id)}constructor(e,t){this.data=e,this.node=t}}var eI=s(8341);function eA(e){let{value:t,setValue:s,title:r,labelTrue:a,labelFalse:i,children:l}=e;return(0,n.jsxs)("div",{className:"button",children:[(0,n.jsxs)("button",{onClick:function(){s(!t)},children:[(0,n.jsx)(u.g,{icon:d.Ubc})," ",(0,n.jsxs)("span",{children:[r,":"]})," ",t?a:i]}),t?l[0]:l[1]]})}function eE(e){let{bottomUp:t,setBottomUp:s}=e,{t:r}=(0,eI.o)();return(0,n.jsxs)(eA,{value:t,setValue:s,title:r("viewer.sampler.buttons.display"),labelTrue:r("viewer.sampler.displayMode.bottomUp"),labelFalse:r("viewer.sampler.displayMode.topDown"),children:[(0,n.jsx)("p",{children:r("viewer.sampler.displayMode.bottomUpDescription")}),(0,n.jsx)("p",{children:r("viewer.sampler.displayMode.topDownDescription")})]})}function eP(e){let{labelMode:t,setLabelMode:s}=e,{t:r}=(0,eI.o)(),a=(0,i.useContext)(eb);return a.numberOfTicks?a.samplerMode===A.gi.ALLOCATION?(0,n.jsxs)(eA,{value:t,setValue:s,title:r("viewer.sampler.buttons.label"),labelTrue:r("viewer.sampler.buttons.bytesPerSecond"),labelFalse:r("viewer.sampler.labelMode.percentage"),children:[(0,n.jsx)("p",{children:r("viewer.sampler.buttons.bytesPerSecondDescription")}),(0,n.jsx)("p",{children:r("viewer.sampler.buttons.percentageAllocationDescription")})]}):(0,n.jsxs)(eA,{value:t,setValue:s,title:r("viewer.sampler.buttons.label"),labelTrue:r("viewer.sampler.buttons.timePerTick"),labelFalse:r("viewer.sampler.labelMode.percentage"),children:[(0,n.jsx)("p",{children:r("viewer.sampler.buttons.timePerTickDescription")}),(0,n.jsx)("p",{children:r("viewer.sampler.labelMode.percentageDescription")})]}):null}function eL(e){let{selfTimeMode:t,setSelfTimeMode:s}=e,{t:r}=(0,eI.o)();return(0,i.useContext)(eb).samplerMode===A.gi.ALLOCATION?(0,n.jsxs)(eA,{value:t,setValue:s,title:r("viewer.sampler.buttons.sortMode"),labelTrue:r("viewer.sampler.buttons.selfBytesAllocated"),labelFalse:r("viewer.sampler.buttons.totalBytesAllocated"),children:[(0,n.jsx)("p",{children:r("viewer.sampler.buttons.selfBytesDescription")}),(0,n.jsx)("p",{children:r("viewer.sampler.buttons.totalBytesDescription")})]}):(0,n.jsxs)(eA,{value:t,setValue:s,title:r("viewer.sampler.buttons.sortMode"),labelTrue:r("viewer.sampler.sortMode.selfTime"),labelFalse:r("viewer.sampler.sortMode.totalTime"),children:[(0,n.jsx)("p",{children:r("viewer.sampler.sortMode.selfTimeDescription")}),(0,n.jsx)("p",{children:r("viewer.sampler.sortMode.totalTimeDescription")})]})}function e_(e){let{children:t}=e,{t:s}=(0,eI.o)();return(0,n.jsxs)("div",{className:"header",children:[(0,n.jsx)("h2",{children:s("viewer.flatView.title")}),(0,n.jsx)("p",{children:s("viewer.flatView.description")}),t]})}let eD=(0,i.createContext)(!1);function eV(e){let{data:t,viewData:s,setLabelMode:r}=e,a=(0,i.useContext)(ek),[l,o]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!1),u=c?null==s?void 0:s.flatSelfTime:null==s?void 0:s.flatTotalTime;return(0,n.jsxs)("div",{className:"flatview",children:[(0,n.jsxs)(e_,{children:[(0,n.jsx)(eP,{labelMode:a,setLabelMode:r}),(0,n.jsx)(eE,{bottomUp:l,setBottomUp:o}),(0,n.jsx)(eL,{selfTimeMode:c,setSelfTimeMode:d})]}),(0,n.jsx)("hr",{}),u?(0,n.jsx)("div",{className:"stack",children:(0,n.jsx)(eD.Provider,{value:l,children:u.map(e=>(0,n.jsx)(eX,{parents:[],node:new eM(t,e)},e.name))})}):(0,n.jsx)(h.A,{children:"Loading..."})]})}function eF(e){let{node:t,parent:s}=e;if(!s)return null;let r=t.getDetails();if("stackTrace"!==r.type||!r.parentLineNumber)return null;let a=s.getDetails();if("stackTrace"!==a.type)return null;let i="Invoked on line "+r.parentLineNumber+" of "+a.className+"."+a.methodName+"()";return(0,n.jsxs)("span",{className:"lineNumber",title:i,children:[":",r.parentLineNumber]})}function eK(e){let{details:t,mappings:s}=e;switch(t.type){case"thread":return(0,n.jsx)(eO,{details:t,mappings:s});case"stackTrace":return(0,n.jsx)(eR,{details:t,mappings:s})}}let eO=e=>{let{details:t,mappings:s}=e;return(0,n.jsx)(n.Fragment,{children:t.name})},eR=e=>{let{details:t,mappings:s}=e,r=s.resolve(t);if("native"===r.type)return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"native-part",children:t.methodName}),(0,n.jsx)("span",{className:"package-part",children:" (native)"})]});let{className:a,methodName:i,packageName:l,lambda:o,remappedClass:c,remappedMethod:d}=r;return(0,n.jsxs)(n.Fragment,{children:[!!l&&(0,n.jsx)("span",{className:"package-part",children:l}),c?(0,n.jsx)("span",{className:"class-part remapped",title:t.className,children:a}):(0,n.jsx)("span",{className:"class-part",children:a}),!!o&&(0,n.jsx)("span",{className:"lambda-part",children:o}),".",d?(0,n.jsx)("span",{className:"method-part remapped",title:t.methodName,children:i}):(0,n.jsx)("span",{className:"method-part",children:i}),"()"]})};function eB(e){let t,{children:s,time:r,selfTime:a,threadTime:l,importance:o,significance:c,source:d,infoPoint:u,isSourceRoot:h}=e,p=(0,i.useContext)(eb);h&&(r=l-a);let m=(0,i.useContext)(ek),f=(0,i.useContext)(eN);if(m)if(p.samplerMode===A.gi.ALLOCATION)t=r/((f.supported?f.getMillisInRange():p.endTime-p.startTime)/1e3);else{var g;t=r/Math.max(f.supported?f.getTicksInRange():(null==(g=p.dataAggregator)?void 0:g.numberOfIncludedTicks)||p.numberOfTicks,1)}function x(e){return p.samplerMode===A.gi.ALLOCATION?(0,q.DL)(e):(0,q.fU)(e)+"ms"}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("span",{className:"name",children:[s,(0,n.jsx)("span",{className:"percent",style:{filter:"hue-rotate(-".concat(25*o,"deg)")+" "+"saturate(".concat(1+13*o,")"),opacity:c<.01?.5+100*c/2:void 0},children:m?"".concat(x(t)):(0,q.XL)(r/l)}),u,(0,n.jsxs)("span",{className:"time",children:[x(r),Math.floor(a)>0&&!h&&(0,n.jsxs)(n.Fragment,{children:[" ","(self: ",x(a)," -"," ",(0,q.XL)(a/l),")"]}),!!d&&(0,n.jsxs)(n.Fragment,{children:[" (",d,")"]})]})]}),(0,n.jsx)("div",{className:"bar",children:(0,n.jsx)("span",{className:"inner",style:{width:(0,q.XL)(r/l)}})})]})}function eU(e){let{node:t,mappings:s,lookup:r}=e;if(!r.enabled||!r.methods||!r.threads)return null;let a=t.getDetails();if("stackTrace"===a.type){let e=s.resolve(a);if("native"===e.type)return null;let{className:t,methodName:i,packageName:l}=e,o=r.methods.lookup("".concat(l).concat(t,".").concat(i,"()"));return(0,n.jsx)(eW,{desc:o})}if("thread"===a.type){let e=r.threads.lookup(a.name);return(0,n.jsx)(eW,{desc:e})}return null}s(3120);let eW=e=>{let{desc:t}=e;return t.result?(0,n.jsx)("span",{className:"infopoint","data-tooltip-id":"infopoint-tooltip","data-tooltip-html":t.result,children:(0,n.jsx)(u.g,{icon:d.iW_})}):null},eG=i.memo(e=>{let t,s,{parents:r,node:a,forcedTime:o}=e,c=(0,i.useContext)(ex),d=(0,i.useContext)(ev),u=(0,i.useContext)(ew),h=(0,i.useContext)(ej),p=(0,i.useContext)(eN),m=(0,i.useContext)(eD)&&0!==r.length,f=0!==r.length?r[r.length-1]:null,[g,x]=(0,i.useState)(()=>!!u.check(a)||null!=f&&(m?f.getParents():f.getChildren()).filter(e=>h.matches(e)).length<=1),v=(0,i.useMemo)(()=>r.concat([a]),[r,a]),{show:w}=(0,l.EF)({id:"sampler-cm"});if(!h.matches(a))return null;let j=en()({node:!0,collapsed:!g,parent:0===r.length}),b=en()({"node-info":!0,bookmarked:u.has(a)}),k=p.getTime(a),N=0===r.length?k:p.getTime(r[0]),y=m&&o||k,S=m?0:y-a.getChildren().reduce((e,t)=>e+p.getTime(t),0);if(0===y&&0===k)return null;if(f){let e=f instanceof eT&&f.getSourceTime()||p.getTime(f);t=o?.5:k<e?k/e:e/k,s=e!==k?t:0}else t=1,s=0;return(0,n.jsxs)("li",{className:j,children:[(0,n.jsx)("div",{className:b,onClick:function(e){e.altKey?u.toggle(a):x(!g)},onContextMenu:function(e){e.preventDefault(),w({event:e,props:{node:a}})},children:(0,n.jsxs)(eB,{time:y,selfTime:S,threadTime:N,importance:s,significance:t,source:a.getSource(),infoPoint:(0,n.jsx)(eU,{node:a,mappings:c,lookup:d}),isSourceRoot:a instanceof eT,children:[(0,n.jsx)(eK,{details:a.getDetails(),mappings:c}),(0,n.jsx)(eF,{node:a,parent:f})]})}),g&&(0,n.jsx)("ul",{className:"children",children:(m?a.getParents():a.getChildren()).sort((e,t)=>p.getTime(t)-p.getTime(e)).map((e,t)=>(0,n.jsx)(eG,{node:e,forcedTime:m&&(o||2===r.length)?y:void 0,parents:v},t))})]})});eG.displayName="BaseNode";let eX=eG;function e$(e){let{children:t}=e,{t:s}=(0,eI.o)();return(0,n.jsxs)("div",{className:"header",children:[(0,n.jsx)("h2",{children:s("viewer.allView.title")}),(0,n.jsx)("p",{children:s("viewer.allView.description")}),t]})}function ez(e){let{data:t,setLabelMode:s}=e,r=(0,i.useContext)(ek);return(0,n.jsxs)("div",{className:"allview",children:[(0,n.jsx)(e$,{children:(0,n.jsx)(eP,{labelMode:r,setLabelMode:s})}),(0,n.jsx)("hr",{}),(0,n.jsx)("div",{className:"stack",children:t.threads.map(e=>(0,n.jsx)(eX,{parents:[],node:new Z(t,e)},e.name))})]})}function eQ(e){let{merged:t,setMerged:s}=e,{t:r}=(0,eI.o)();return(0,n.jsxs)(eA,{value:t,setValue:s,title:r("viewer.sampler.buttons.mergeMode"),labelTrue:r("viewer.sampler.buttons.merge"),labelFalse:r("viewer.sampler.buttons.separate"),children:[(0,n.jsx)("p",{children:r("viewer.sampler.buttons.mergeDescription")}),(0,n.jsx)("p",{children:r("viewer.sampler.buttons.separateDescription")})]})}function eq(e){var t;let{children:s}=e,r=(0,i.useContext)(eb),{t:a}=(0,eI.o)(),l=["Fabric","Forge","NeoForge"].includes(null==(t=r.platform)?void 0:t.name);return(0,n.jsxs)("div",{className:"header",children:[(0,n.jsx)("h2",{children:a(l?"viewer.sourcesView.modsTitle":"viewer.sourcesView.pluginsTitle")}),(0,n.jsx)("p",{children:a(l?"viewer.sourcesView.modsDescription":"viewer.sourcesView.pluginsDescription")}),s]})}function eY(e){let{data:t,viewData:s,setLabelMode:r}=e,a=(0,i.useContext)(ek),[l,o]=(0,i.useState)(!0),c=l?null==s?void 0:s.sourcesMerged:null==s?void 0:s.sourcesSeparate;return(0,n.jsxs)("div",{className:"sourceview",children:[(0,n.jsxs)(eq,{children:[(0,n.jsx)(eP,{labelMode:a,setLabelMode:r}),(0,n.jsx)(eQ,{merged:l,setMerged:o})]}),(0,n.jsx)("hr",{}),c?(0,n.jsxs)(n.Fragment,{children:[c.map(e=>(0,n.jsx)(eJ,{data:t,viewData:e},e.source)),(0,n.jsx)(eZ,{alreadyShown:c.map(e=>e.source)})]}):(0,n.jsx)(h.A,{children:"Loading..."})]})}let eH=e=>e.startsWith("v")?e:"v"+e,eJ=e=>{let{data:t,viewData:s}=e,{source:r,threads:a}=s,l=(0,i.useContext)(eb).sources[r.toLowerCase()];return(0,n.jsxs)("div",{className:"stack",children:[(0,n.jsxs)("h2",{children:[r," ",l&&(0,n.jsxs)("span",{className:"version",children:["(",eH(l.version),")"]})]}),a.map(e=>(0,n.jsx)(eX,{parents:[],node:new eT(t,e)},e.name))]})},eZ=e=>{var t;let{alreadyShown:s}=e,r=(0,i.useContext)(eb);if(!r.sources)return null;let a=Object.values(r.sources).filter(e=>!s.includes(e.name)).filter(e=>!e.builtIn);if(!a.length)return null;let l=["Fabric","Forge","NeoForge"].includes(null==r||null==(t=r.platform)?void 0:t.name)?"mods":"plugins";return(0,n.jsxs)("div",{className:"other-sources",children:[(0,n.jsx)("h2",{children:"Other"}),(0,n.jsxs)("p",{children:["The following other ",l," are installed, but didn't show up in this profile. Yay!"]}),(0,n.jsx)("ul",{children:a.map(e=>{let{name:t,version:s}=e;return(0,n.jsxs)("li",{children:[t," ",(0,n.jsxs)("span",{children:["(",eH(s),")"]})]},t)})})]})};var e0=s(9893);async function e1(){let e=await fetch("https://spark-infopoints.lucko.me/points.json");return await e.json()}class e2{lookup(e){let t=this.map.get(e);if(t)return t;for(let[t,s]of this.regexMap)if(t.test(e)){let t={result:s};return this.map.set(e,t),t}return this.map.set(e,e2.EMPTY_RESULT),e2.EMPTY_RESULT}constructor(e,t){for(let s of(this.map=new Map,this.regexMap=new Map,e.points))for(let e of t(s)){let t=e2.REGEX_KEY.exec(e);if(t){let e=new RegExp(t[1]);this.regexMap.set(e,s.description)}else this.map.set(e,{result:s.description})}}}e2.EMPTY_RESULT={},e2.REGEX_KEY=/\/(.+)\//;var e3=s(2127);let e4="".concat(e3._.NEXT_PUBLIC_SPARK_MAPPINGS_URL,"/dist/");async function e5(){let e=await fetch(e4+"mappings.json");return await e.json()}async function e7(e,t,s){let n=await fetch(e4+e+"/"+t+".wasm");return s(new Uint8Array(await n.arrayBuffer()))}class e8{map(e){return{}}constructor(){}}e8.INSTANCE=new e8;class e6{map(e){let t;if(!e.className.startsWith(this.expectedPackage))return{};let s=e.className.substring(this.expectedPackage.length);if(t=this.nmsVersion?this.bukkitMappings.classes[s]:this.bukkitMappings.classes["net.minecraft."+s],"MinecraftServer"===s&&(t=this.bukkitMappings.classes["net.minecraft.server.MinecraftServer"]),!t)return{};let n=t.obfuscated,r=this.outputMappings.classes[n];if(!r||t.methods.some(t=>t.mapped===e.methodName))return{};let a=r.methods.filter(t=>t.obfuscated===e.methodName);if(!a)return{};if(1===a.length)return{methodName:a[0].mapped};if(!e.methodDesc)return{};for(let t of a){let s=t.description.replace(/L([^;]+);/g,e=>{let t=e.substring(1,e.length-1),s=this.classesObfuscated[t];if(s)if(this.nmsVersion)return"Lnet/minecraft/server/"+this.nmsVersion+"/"+s.mapped+";";else return"L"+s.mapped.replaceAll(".","/")+";";return e});if(e.methodDesc===s)return{methodName:t.mapped}}return{}}constructor(e,t,s){for(let n of(this.outputMappings=e,this.bukkitMappings=t,this.nmsVersion=s,s?this.expectedPackage="net.minecraft.server."+s+".":this.expectedPackage="net.minecraft.",this.classesObfuscated={},Object.values(t.classes)))this.classesObfuscated[n.obfuscated]=n}}class e9{map(e){return{methodName:this.mcpMappings.methods[e.methodName]}}constructor(e){this.mcpMappings=e}}class te{map(e){let t,s=e.className.match(/^(.+)(\$\$Lambda.+)$/),n=s?this.mojangMappings.classes[s[1]]:this.mojangMappings.classes[e.className];if(!n)return{};let r=n.mapped+(s?s[2]:""),a=n.methods.filter(t=>t.obfuscated===e.methodName);if(1===a.length)t=a[0].mapped;else if(a.length>1){let s=a.find(t=>t.description===e.methodDesc);s&&(t=s.mapped)}return{className:r,methodName:t}}constructor(e){this.mojangMappings=e}}class tt{map(e){let t=this.yarnMappings.methods[e.methodName],s=e.className.match(/^(.+)(\$\$Lambda.+)$/);return{className:s?(this.yarnMappings.classes[s[1]]||s[1])+s[2]:this.yarnMappings.classes[e.className],methodName:t}}constructor(e){this.yarnMappings=e}}async function ts(e,t,s){if("auto"===e){let n=function(e,t){if(!e.auto||!t||!t.platform||!t.platform.name||!t.platform.minecraftVersion||t.platform.type===A.KI.PROXY)return null;let s=t.platform.minecraftVersion.match(/(\d+\.\d+) Release Candidate \d+/);s&&(t.platform.minecraftVersion=s[1]);let n=t.platform.name.toLowerCase();"paper"===n?n="bukkit":t.platform.type===A.KI.APPLICATION&&(n="vanilla");let r=n+"/"+t.platform.minecraftVersion;return e.auto[r]}(t,s);if(!n)return e8.INSTANCE;e=n}if(e.startsWith("bukkit-mojang")){let s=e.substring(14),n=t.types["bukkit-mojang"].versions[s].nmsVersion,r=t.types["bukkit-mojang"].versions[s].mojangClassNamesAtRuntime;if(!n&&!r)throw Error("No NMS version specified!");let[a,i]=await Promise.all([e7(s,"mojang",e=>A.cx.fromBinary(e)),e7(s,"bukkit",e=>A.oj.fromBinary(e))]);return new e6(a,i,n)}if(e.startsWith("bukkit")){let s=e.substring(7),n=t.types.bukkit.versions[s].nmsVersion,[r,a]=await Promise.all([e7(s,"mcp",e=>A.Qx.fromBinary(e)),e7(s,"bukkit",e=>A.oj.fromBinary(e))]);return new e6(r,a,n)}if(e.startsWith("mcp")){let t=e.substring(4);return new e9(await e7(t,"mcp",e=>A.Qx.fromBinary(e)))}if(e.startsWith("yarn")){let t=e.substring(5);return new tt(await e7(t,"yarn",e=>A.CO.fromBinary(e)))}{if(!e.startsWith("vanilla"))return e8.INSTANCE;let t=e.substring(8);return new te(await e7(t,"mojang",e=>A.cx.fromBinary(e)))}}class tn{resolve(e){let t,s;if("native"===e.className)return{type:"native"};let{className:n,methodName:r}=this.mappingFunction.map(e)||{},a=!!n,i=!!r;n=n||e.className,r=r||e.methodName;let l=n.indexOf("$$Lambda");return -1!==l&&(t=n.substring(l),n=n.substring(0,l)),-1!==(l=n.lastIndexOf("."))&&(s=n.substring(0,l+1),n=n.substring(l+1)),{type:"normal",className:n,methodName:r,packageName:s,lambda:t,remappedClass:a,remappedMethod:i}}constructor(e){this.mappingFunction=e}}var tr=s(1528),ta=s.n(tr);function ti(e){let{value:t,toggle:s}=e;return(0,n.jsxs)("label",{className:ta().switch,children:[(0,n.jsx)("input",{type:"checkbox",checked:t,onChange:()=>s()}),(0,n.jsx)("span",{className:ta().slider})]})}function tl(e){let t,{mappingsMetadata:s,mappings:r,setMappings:a}=e,i=[{id:"none",label:"None",options:[{id:"auto",label:"Auto Detect"},{id:"none",label:"No Mappings"}]}];for(t in s.types){let e=s.types[t],n=[];for(let s of Object.keys(e.versions)){let r=e.versions[s],a=e.format.replace("%s",r.name);n.push({id:t+"-"+s,label:a})}i.push({id:t,label:e.name,options:n})}return(0,n.jsx)("span",{className:"dropdown",id:"mappings-selector",children:(0,n.jsx)("select",{title:"mappings",value:r,onChange:e=>a(e.target.value),children:i.map(e=>(0,n.jsx)(to,{group:e},e.id))})})}let to=e=>{let{group:t}=e;return(0,n.jsx)("optgroup",{label:t.label,children:t.options.map(e=>(0,n.jsx)(tc,{option:e},e.id))})},tc=e=>{let{option:t}=e;return(0,n.jsx)("option",{value:t.id,children:t.label})};function td(e){let{mappingsMetadata:t,mappings:s,setMappings:r,infoPoints:a,toggleInfoPoints:i}=e;return(0,n.jsxs)(h.A,{extraClassName:c()["settings-menu"],children:[t&&(0,n.jsx)(tu,{name:"Mappings",desc:"Select which deobfuscation mappings the viewer should use when displaying profiler frames.",children:(0,n.jsx)(tl,{mappingsMetadata:t,mappings:s,setMappings:r})}),(0,n.jsx)(tu,{name:"Info Points",desc:"Select whether info points should be shown.",children:(0,n.jsx)(ti,{value:a,toggle:i})})]})}let tu=e=>{let{name:t,desc:s,children:r}=e;return(0,n.jsxs)("div",{className:"setting",children:[(0,n.jsxs)("div",{className:"setting-control",children:[(0,n.jsx)(u.g,{icon:d._$s})," ",(0,n.jsxs)("span",{children:[t,":"]})," ",r]}),(0,n.jsx)("p",{children:s})]})},th=a()(()=>Promise.all([s.e(628),s.e(274)]).then(s.bind(s,4274)),{loadableGenerated:{webpack:()=>[4274]}});function tp(e){var t;let{data:s,fetchUpdatedData:r,metadata:a,setMetadata:o,exportCallback:d}=e,u=function(e){let[t,s]=(0,i.useState)(""),n=(0,i.useMemo)(()=>t?new N(e).resolveSearchQuery(t):null,[e,t]);return{value:t,setValue:s,matches:(0,i.useCallback)(e=>{if(null==n)return!0;let t=e.getId();return Array.isArray(t)?t.some(e=>n.has(e)):n.has(t)},[n])}}(s),h=function(){let e=(0,x.useRouter)(),[t,s]=(0,i.useState)(()=>{let t=new Set,s=e.query.hl;return s&&s.split(",").forEach(e=>t.add(parseInt(e))),t});(0,i.useEffect)(()=>{let s=Array.from(t).join(",");if(!s&&!e.query.hl||s===e.query.hl)return;let n=e.asPath,r=n.indexOf("?");r>=0&&(n=n.substring(0,r));let a=t.size?"?hl=".concat(s):"";e.push(n+a,void 0,{shallow:!0})},[t,e]);let n=(0,i.useCallback)(e=>{s(t=>{let s=new Set(t);return w(s,e.getId())?b(s,e.getId()):j(s,e.getId()),s})},[s]),r=(0,i.useCallback)(e=>{if(!t.size)return!1;if(w(t,e.getId()))return!0;for(let t of e.getChildren())if(r(t))return!0;return!1},[t]);return{toggle:n,check:r,has:(0,i.useCallback)(e=>w(t,e.getId()),[t]),clear:(0,i.useCallback)(()=>s(new Set),[s])}}(),[v,k]=(0,i.useState)(!1),T=function(e,t){let s=(0,i.useMemo)(()=>e.length>1,[e]),[n,r]=(0,i.useState)(new Set),[a,l]=(0,i.useState)(!0),o=(0,i.useCallback)(e=>a||n.has(e),[n,a]),c=(0,i.useCallback)(t=>{let s=new Set(e.filter(t));r(s),l(e.length===s.size)},[e]),d=(0,i.useCallback)(t=>{let s=t.getTimes();return s&&!a?s.filter((t,s)=>o(e[s])).reduce((e,t)=>e+t,0):t.getTime()},[a,o,e]),u=(0,i.useCallback)(()=>{let s=0;for(let n of e)o(n)&&(s+=t[n].ticks);return s},[o,t,e]),h=(0,i.useCallback)(()=>{let s=0;for(let n of e)o(n)&&(s+=t[n].duration);return s},[o,t,e]);return{supported:s,times:e,isTimeSelected:o,setSelectedTimes:c,allTimesSelected:a,getTime:d,getTicksInRange:u,getMillisInRange:h}}(s.timeWindows,s.timeWindowStatistics),M=function(e){let[t,s]=(0,i.useState)(),[n,r]=(0,i.useState)(new tn(e8.INSTANCE)),[a,l]=(0,i.useState)("none"===(0,_.get)("spark-mappings-pref")?"none":"auto");(0,i.useEffect)(()=>{e5().then(s)},[]);let o=(0,i.useCallback)(s=>{t&&e&&a!==s&&(l(s),ts(s,t,e).then(e=>{r(new tn(e))}),"none"===s?(0,_.set)("spark-mappings-pref","none"):(0,_.remove)("spark-mappings-pref"))},[a,t,e]);return(0,i.useEffect)(()=>{t&&e&&"auto"===a&&ts("auto",t,e).then(e=>{r(new tn(e))})},[a,t,e]),{requestMappings:o,mappingsMetadata:t,mappingsResolver:n,mappingsType:a}}(a),I=function(){let[e,t,s]=(0,g.A)("prefInfoPoints",!0),[n,r]=(0,i.useState)(),[a,l]=(0,i.useState)();return(0,i.useEffect)(()=>{e1().then(e=>{r(new e2(e,e=>e.methods)),l(new e2(e,e=>e.threads))})},[]),{methods:n,threads:a,enabled:e,setEnabled:t,toggleEnabled:s}}(),[A,E]=(0,i.useState)(),[P,L]=(0,i.useState)("all"),[D,V]=(0,g.A)("prefShowGraph",!0),[F,K]=(0,i.useState)(!1),[O,U]=(0,g.A)("prefShowSocket",!1),[W,G]=(0,i.useState)(),[X,$]=(0,i.useState)();(0,i.useEffect)(()=>{(async()=>{let e=await B.create(s);s.sources.hasSources()&&$(await e.generateSourcesView()),G(await e.generateFlatView()),e.close()})()},[s]);let z=function(e){var t,s;let{socket:n,fetchUpdatedData:r,metadata:a,setMetadata:l}=e,[o,c]=(0,i.useState)(),[d,u]=(0,i.useState)();return t=n.socket,s=(0,i.useCallback)(e=>{if("serverUpdateStatistics"===e.oneofKind){var t;let{platform:s,system:n}=e.serverUpdateStatistics,r=(0,S._)((0,y._)({},s),{world:null==(t=a.platformStatistics)?void 0:t.world});l((0,S._)((0,y._)({},a),{platformStatistics:r,systemStatistics:n})),c(Date.now())}return"serverUpdateSampler"===e.oneofKind&&(r(e.serverUpdateSampler.payloadId),u(Date.now())),C.KEEP_LISTENING},[a,l,r]),(0,i.useEffect)(()=>{if(t)return t.eventBus.register(s)},[t,s]),{socket:n,lastStatsUpdate:o,lastSamplerUpdate:d}}({socket:function(e,t){let[s,n]=(0,i.useState)(!1),[r,a]=(0,i.useState)(),[l,o]=(0,i.useState)(),[c,d]=(0,i.useState)(!1),[u,h]=(0,i.useState)(),[p,m]=(0,i.useState)(),f=(0,i.useCallback)(async e=>{await R.connect(e,{onConnect(e,s,n,r,i){a(e),o(r),d(n),h(s),i&&t(i)},onPing(e){m(e)},onClose(){a(void 0)}})},[t]);return(0,i.useEffect)(()=>{e&&!s&&(n(!0),f(e).catch(e=>{console.log("Error initialising the socket",e)}))},[e,s,f]),{socket:r,clientId:l,trusted:c,settings:u,latency:p}}(s.channelInfo,r),fetchUpdatedData:r,metadata:a,setMetadata:o}),Q=(0,f.A)(),q=(null==a||null==(t=a.platform)?void 0:t.sparkVersion)&&a.platform.sparkVersion>=2;return(0,n.jsxs)("div",{className:c().sampler,children:[(0,n.jsx)(ed,{data:s,metadata:a,metadataToggle:Q,exportCallback:d,showSettings:F,setShowSettings:K,view:P,setView:L,sourcesViewSupported:s.sources.hasSources(),graphSupported:T.supported,showGraph:D,setShowGraph:V,socket:z,showSocketInfo:O,setShowSocketInfo:U,flameData:A,setFlameData:E,searchQuery:u}),F&&(0,n.jsx)(td,{mappingsMetadata:M.mappingsMetadata,mappings:M.mappingsType,setMappings:M.requestMappings,infoPoints:I.enabled,toggleInfoPoints:I.toggleEnabled}),O&&z.socket.socket&&(0,n.jsx)(eg,{socket:z}),!q&&(0,n.jsx)(p,{}),(0,n.jsx)(m.A,{metadata:a,metadataToggle:Q}),T.supported&&(0,n.jsx)(i.Suspense,{fallback:null,children:(0,n.jsx)(th,{show:D,timeSelector:T,windowStatistics:s.timeWindowStatistics})}),!!A&&(0,n.jsx)(ep,{flameData:A,mappings:M.mappingsResolver,metadata:a,timeSelector:T}),(0,n.jsx)("div",{style:{display:A?"none":void 0},children:(0,n.jsxs)(ey,{mappings:M.mappingsResolver,infoPoints:I,highlighted:h,searchQuery:u,labelMode:v,metadata:a,timeSelector:T,children:["all"===P?(0,n.jsx)(ez,{data:s,setLabelMode:k}):P===eo?(0,n.jsx)(eV,{data:s,viewData:W,setLabelMode:k}):(0,n.jsx)(eY,{data:s,viewData:X,setLabelMode:k}),I.enabled&&(0,n.jsx)(e0.m_,{id:"infopoint-tooltip",place:"right",className:"infopoint-tooltip",clickable:!0})]})}),0===s.threads.length&&(0,n.jsx)(ef,{isConnectedToSocket:!!z.socket.socket}),(0,n.jsxs)(l.W1,{id:"sampler-cm",theme:"dark",children:[(0,n.jsx)(l.q7,{onClick:function(e){var t;let s=null==(t=e.props)?void 0:t.node;s&&E(s)},children:"View as Flame Graph"}),(0,n.jsx)(l.q7,{onClick:function(e){e.props&&h.toggle(e.props.node)},children:"Toggle bookmark"}),(0,n.jsx)(l.q7,{onClick:function(){h.clear()},children:"Clear all bookmarks"})]})]})}},1528:e=>{e.exports={switch:"switch_switch__MKxDO",slider:"switch_slider__uUjiS"}},6570:e=>{e.exports={sampler:"sampler_sampler__ukhXD","version-warning":"sampler_version-warning__d4E7m","socket-info":"sampler_socket-info__zWi5e","settings-menu":"sampler_settings-menu__mXCl3","no-data":"sampler_no-data__9SnRa"}},8144:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var n=s(7876),r=s(1041),a=s(2318),i=s(8341);function l(e){let{metadata:t,metadataToggle:s}=e,{t:l}=(0,i.o)();return t.platform?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(a.A,{icon:r.d1P,onClick:s.toggleWidgets,title:l("viewer.controls.toggleWidgets"),extraClassName:s.showWidgets?"toggled":void 0}),(0,n.jsx)(a.A,{icon:r.iW_,onClick:s.toggleInfo,title:l("viewer.controls.toggleMetadata"),extraClassName:s.showInfo?"toggled":void 0})]}):null}}}]);