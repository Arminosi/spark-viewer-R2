(()=>{"use strict";let e=Symbol("Comlink.proxy"),t=Symbol("Comlink.endpoint"),r=Symbol("Comlink.releaseProxy"),s=Symbol("Comlink.finalizer"),a=Symbol("Comlink.thrown"),n=e=>"object"==typeof e&&null!==e||"function"==typeof e,i=new Map([["proxy",{canHandle:t=>n(t)&&t[e],serialize(e){let{port1:t,port2:r}=new MessageChannel;return o(e,t),[r,[r]]},deserialize:e=>(e.start(),function(e,s){let a=new Map;return e.addEventListener("message",function(e){let{data:t}=e;if(!t||!t.id)return;let r=a.get(t.id);if(r)try{r(t)}finally{a.delete(t.id)}}),function e(s,a,n=[],i=function(){}){let o=!1,l=new Proxy(i,{get(t,i){if(c(o),i===r)return()=>{d&&d.unregister(l),u(s),a.clear(),o=!0};if("then"===i){if(0===n.length)return{then:()=>l};let e=y(s,a,{type:"GET",path:n.map(e=>e.toString())}).then(g);return e.then.bind(e)}return e(s,a,[...n,i])},set(e,t,r){c(o);let[i,l]=f(r);return y(s,a,{type:"SET",path:[...n,t].map(e=>e.toString()),value:i},l).then(g)},apply(r,i,l){c(o);let u=n[n.length-1];if(u===t)return y(s,a,{type:"ENDPOINT"}).then(g);if("bind"===u)return e(s,a,n.slice(0,-1));let[h,d]=m(l);return y(s,a,{type:"APPLY",path:n.map(e=>e.toString()),argumentList:h},d).then(g)},construct(e,t){c(o);let[r,i]=m(t);return y(s,a,{type:"CONSTRUCT",path:n.map(e=>e.toString()),argumentList:r},i).then(g)}}),p=(h.get(s)||0)+1;return h.set(s,p),d&&d.register(l,s,l),l}(e,a,[],void 0)}(e))}],["throw",{canHandle:e=>n(e)&&a in e,serialize:({value:e})=>[e instanceof Error?{isError:!0,value:{message:e.message,name:e.name,stack:e.stack}}:{isError:!1,value:e},[]],deserialize(e){if(e.isError)throw Object.assign(Error(e.value.message),e.value);throw e.value}}]]);function o(t,r=globalThis,n=["*"]){r.addEventListener("message",function i(c){let u;if(!c||!c.data)return;if(!function(e,t){for(let r of e)if(t===r||"*"===r||r instanceof RegExp&&r.test(t))return!0;return!1}(n,c.origin))return void console.warn(`Invalid origin '${c.origin}' for comlink proxy`);let{id:h,type:d,path:m}=Object.assign({path:[]},c.data),y=(c.data.argumentList||[]).map(g);try{var S,T,w;let r=m.slice(0,-1).reduce((e,t)=>e[t],t),s=m.reduce((e,t)=>e[t],t);switch(d){case"GET":u=s;break;case"SET":r[m.slice(-1)[0]]=g(c.data.value),u=!0;break;case"APPLY":u=s.apply(r,y);break;case"CONSTRUCT":S=new s(...y),u=Object.assign(S,{[e]:!0});break;case"ENDPOINT":{let{port1:e,port2:r}=new MessageChannel;o(t,r),T=e,w=[e],p.set(T,w),u=T}break;case"RELEASE":u=void 0;break;default:return}}catch(e){u={value:e,[a]:0}}Promise.resolve(u).catch(e=>({value:e,[a]:0})).then(e=>{let[a,n]=f(e);r.postMessage(Object.assign(Object.assign({},a),{id:h}),n),"RELEASE"===d&&(r.removeEventListener("message",i),l(r),s in t&&"function"==typeof t[s]&&t[s]())}).catch(e=>{let[t,s]=f({value:TypeError("Unserializable return value"),[a]:0});r.postMessage(Object.assign(Object.assign({},t),{id:h}),s)})}),r.start&&r.start()}function l(e){"MessagePort"===e.constructor.name&&e.close()}function c(e){if(e)throw Error("Proxy has been released and is not useable")}function u(e){return y(e,new Map,{type:"RELEASE"}).then(()=>{l(e)})}let h=new WeakMap,d="FinalizationRegistry"in globalThis&&new FinalizationRegistry(e=>{let t=(h.get(e)||0)-1;h.set(e,t),0===t&&u(e)});function m(e){var t;let r=e.map(f);return[r.map(e=>e[0]),(t=r.map(e=>e[1]),Array.prototype.concat.apply([],t))]}let p=new WeakMap;function f(e){for(let[t,r]of i)if(r.canHandle(e)){let[s,a]=r.serialize(e);return[{type:"HANDLER",name:t,value:s},a]}return[{type:"RAW",value:e},p.get(e)||[]]}function g(e){switch(e.type){case"HANDLER":return i.get(e.name).deserialize(e.value);case"RAW":return e.value}}function y(e,t,r,s){return new Promise(a=>{let n=[,,,,].fill(0).map(()=>Math.floor(Math.random()*Number.MAX_SAFE_INTEGER).toString(16)).join("-");t.set(n,a),e.start&&e.start(),e.postMessage(Object.assign({id:n},r),s)})}class S{addNode(e){let t=S.keyForNode(e),r=this.map.get(t);void 0===r&&(r=[],this.map.set(t,r)),r.push(e)}build(){return Array.from(this.map.values())}static keyForNode(e){return"".concat(e.className,"\0").concat(e.methodName,"\0").concat(e.methodDesc)}constructor(){this.map=new Map}}class T{generateView(){let e=[],t=[];for(let r of this.threads)e.push(this.generate(r,!0,250)),t.push(this.generate(r,!1,250));return{flatSelfTime:e,flatTotalTime:t}}generate(e,t,r){let s,a=new Map;for(let r of(s=t?new b:new Set,e.children))this.visit(r,a,s);let n=t?(e,t)=>t.selfTime-e.selfTime:(e,t)=>t.totalTime-e.totalTime,i=Array.from(a.values()).sort(n).slice(0,r),o=[];for(let{nodes:e}of i){let t=e.map(e=>e.id);o.push(t)}return{name:e.name,id:e.id,time:e.time,times:e.times,children:o}}visit(e,t,r){let s=S.keyForNode(e),a=r.has(s);a||r.add(s);let n=0;for(let s of e.children)this.visit(s,t,r),n+=s.time;a||r.delete(s);let i=e.time-n;if(!a){let r=t.get(s);r||(r=new w,t.set(s,r)),r.append(e,i)}}constructor(e){this.threads=e.threads}}class w{append(e,t){this.nodes.push(e),this.selfTime+=t,this.totalTime+=e.time}constructor(){this.nodes=[],this.selfTime=0,this.totalTime=0}}class b{add(e){return this}delete(e){return!1}has(e){return!1}}class v{static createFromExisting(e){return new v(e.sources,e.idToSource)}static create(e,t){let{classSources:r,methodSources:s,lineSources:a}=t;if(!(r||s||a))return new v([],new Map);let n=Array.from(new Set([...Object.values(r||{}),...Object.values(s||{}),...Object.values(a||{})])),i=new Map;for(let t of e)if(t.className&&!v.excludes(t)){let e;s&&t.methodName&&t.methodDesc&&(e=s["".concat(t.className,";").concat(t.methodName,";").concat(t.methodDesc)]),!e&&a&&t.lineNumber&&(e=a["".concat(t.className,";").concat(t.lineNumber)]),!e&&r&&(e=r[t.className]),e&&!["minecraft","java"].includes(e)&&i.set(t.id,e)}return new v(n,i)}getSource(e){return this.idToSource.get(e)}getSources(){return this.sources}hasSources(){return this.idToSource.size>0}constructor(e,t){this.sources=e,this.idToSource=t}}v.excludes=e=>e.className.startsWith("com.destroystokyo.paper.event.executor.asm.generated.");class N{generateView(){return{sourcesMerged:this.generate(!0),sourcesSeparate:this.generate(!1)}}generate(e){return this.sources.map(t=>{let r=Array.from(this.threads.map(r=>this.generateThread(e,r,t)).filter(e=>null!=e).map(e=>e));return{source:t,threads:r,totalSourceTime:r.reduce((e,t)=>e+t.sourceTime,0)}}).filter(e=>e.threads.length&&e.totalSourceTime).sort((e,t)=>t.totalSourceTime-e.totalSourceTime)}generateThread(e,t,r){let s;s=e?this.findMatchesMerge(new S,r,t.children).build():this.findMatchesSeparate([],r,t.children).map(e=>[e]);let a=e=>e.reduce((e,t)=>e+t.time,0);return s.sort((e,t)=>a(t)-a(e)),s.length?{name:t.name,id:t.id,threadTime:t.time,threadTimes:t.times,sourceTime:s.reduce((e,t)=>e+a(t),0),children:s.map(e=>e.map(e=>e.id))}:null}findMatchesMerge(e,t,r){for(let s of r){let r=this.sourcesMap.getSource(s.id);r!==t||N.hideNode(s,r)?this.findMatchesMerge(e,t,s.children):e.addNode(s)}return e}findMatchesSeparate(e,t,r){for(let s of r){let r=this.sourcesMap.getSource(s.id);r!==t||N.hideNode(s,r)?this.findMatchesSeparate(e,t,s.children):e.push(s)}return e}static hideNode(e,t){return e.className&&e.methodName&&e.className.startsWith("net.minecraft.server.MinecraftServer")&&(e.methodName.endsWith("modifiedRunLoop")||e.methodName.endsWith("fixUpdateSuppressionCrashTick"))&&t.includes("carpet")}constructor(e){this.threads=e.threads,this.sourcesMap=v.createFromExisting(e.sources),this.sources=this.sourcesMap.getSources()}}class E{generateFlatView(){return new T(this.props).generateView()}generateSourcesView(){return new N(this.props).generateView()}constructor(e){this.props=e}}o(E)})(),_N_E={};