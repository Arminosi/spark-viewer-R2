(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[815],{1528:e=>{e.exports={switch:"switch_switch__MKxDO",slider:"switch_slider__uUjiS"}},2815:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>tw});var n=s(7876),a=s(8847),r=s.n(a),i=s(4232),l=s(3038),o=s(6570),c=s.n(o),d=s(1041),u=s(7460),h=s(9915);function m(){let[e,t]=(0,i.useState)(!0);if(!e)return null;let s=(0,n.jsx)("span",{role:"img","aria-label":"warning",children:"⚠️"});return(0,n.jsxs)(h.A,{extraClassName:c()["version-warning"],children:[s,(0,n.jsx)("b",{children:" This profile was created using an old version of spark! "}),s,(0,n.jsx)(u.g,{icon:d.GRI,onClick:function(){t(!1)}}),(0,n.jsx)("br",{}),"Some viewer features cannot be supported. Please consider updating to a newer version."]})}var p=s(140),f=s(4344),g=s(3957),x=s(9099);let v=e=>(t,s)=>{if(!Array.isArray(s))return e(t,s);for(let n of s)if(e(t,n))return!0;return!1},j=v((e,t)=>e.has(t)),w=v((e,t)=>(e.add(t),!1)),b=v((e,t)=>(e.delete(t),!1));var N=s(2162);class k{resolveSearchQuery(e){let t=new Set;for(let s of this.data.nodes.threadNodes)this.resolve(s,e,t);return t}resolve(e,t,s){for(let n of(!s.has(e.id)&&this.nodeMatchesQuery(t,e)&&(s.add(e.id),this.addAllChildren(e,s),this.addAllParents(e,s)),e.children))this.resolve(n,t,s)}addAllChildren(e,t){for(let s of e.children)t.add(e.id),this.addAllChildren(s,t)}addAllParents(e,t){for(let s of this.data.bottomUp.getParents(e.id))t.add(s)}nodeMatchesQuery(e,t){if((0,N.fX)(t))return t.name.toLowerCase().includes(e);{let s=this.data.sources.getSource(t.id);return t.className.toLowerCase().includes(e)||t.methodName.toLowerCase().includes(e)||s&&s.toLowerCase().includes(e)}}constructor(e){this.data=e}}var y=s(3576),S=s(2701),C=function(e){return e[e.KEEP_LISTENING=0]="KEEP_LISTENING",e[e.STOP_LISTENING=1]="STOP_LISTENING",e}({});class T{register(e){return this.listeners.push(e),()=>this.unregister(e)}unregister(e){let t=this.listeners.indexOf(e);t>=0&&this.listeners.splice(t,1)}dispatch(e){let t=[];this.listeners.forEach((s,n)=>{s(e)===C.STOP_LISTENING&&t.unshift(n)}),t.forEach(e=>this.listeners.splice(e,1))}constructor(){this.listeners=[]}}var M=s(3270),_=s.n(M),I=s(5436);class A{async run(){this.socket.eventBus.register(this.onMessage.bind(this)),await this.sendClientConnect()}async sendClientConnect(){let{browser:e,os:t}=_().parse(window.navigator.userAgent),s={clientId:this.clientId,description:"".concat(e.name," on ").concat(t.name)};await this.socket.send({oneofKind:"clientConnect",clientConnect:s})}constructor(e,t){this.onMessage=e=>{if("serverConnectResponse"!==e.oneofKind)return C.KEEP_LISTENING;let t=e.serverConnectResponse;if(t.clientId!==this.clientId)return C.KEEP_LISTENING;if(t.state===I.zr.ACCEPTED||t.state===I.zr.UNTRUSTED){let e=t.state===I.zr.ACCEPTED;return console.log("[WS] Established connection with server (".concat(e?"trusted":"untrusted",")")),this.socket.startKeepalive(this.listener.onPing).then(e=>{}),this.listener.onConnect(this.socket,t.settings,e,this.clientId,t.lastPayloadId),e?C.STOP_LISTENING:C.KEEP_LISTENING}if(t.state===I.zr.REJECTED)return console.log("[WS] Rejected by server, disconnecting."),this.socket.socket.close(),C.STOP_LISTENING;throw Error("unknown state: ".concat(t.state))},this.socket=e,this.listener=t,this.clientId="".concat(P(4),"-").concat(P(4))}}function P(e){let t=new Uint8Array((e||40)/2);return crypto.getRandomValues(t),Array.from(t,function(e){return e.toString(16).padStart(2,"0")}).join("")}var E=s(943),L=s(6823);async function F(){let e=(0,L.get)("viewer-public-key"),t=(0,L.get)("viewer-private-key");if(e&&t){var s,n;return{publicKey:await (s=(0,E.D)(e),V("spki",s,[])),privateKey:await (n=(0,E.D)(t),V("pkcs8",n,["sign"]))}}}async function D(){let{publicKey:e,privateKey:t}=await crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["sign"]),s=await crypto.subtle.exportKey("spki",e);(0,L.set)("viewer-public-key",(0,E.l)(s));let n=await crypto.subtle.exportKey("pkcs8",t);return(0,L.set)("viewer-private-key",(0,E.l)(n)),{publicKey:e,privateKey:t}}function V(e,t,s){return crypto.subtle.importKey(e,t,{name:"RSASSA-PKCS1-v1_5",hash:"SHA-256"},!0,s)}var K=s(5583);class O{static async connect(e,t,n){console.log("[WS] Creating remote socket client");let a=new Worker(s.tu(new URL(s.p+s.u(614),s.b))),r=(0,K.LV)(a);return new O(await new r(e,t,(0,K.BX)({onclose:(0,K.BX)(n.onclose),onerror:(0,K.BX)(n.onerror),onmessage:(0,K.BX)(n.onmessage),onopen:(0,K.BX)(n.onopen)})))}async send(e){await this.proxy.send((0,K.k0)(e,[e.buffer]))}async startKeepalive(e){await this.proxy.startKeepalive((0,K.BX)(e))}async close(){await this.proxy.close(),this.proxy[K.A2]()}constructor(e){this.proxy=e}}class R{static async connect(e,t){let s=await F()||await D(),n=await V("spki",e.publicKey,["verify"]);console.log("[WS] Loaded viewer keys and decoded remote public key");let a=new R,r=await O.connect(e.channelId,{remotePublicKey:n,localPublicKey:s.publicKey,localPrivateKey:s.privateKey},{onclose:()=>{t.onClose()},onopen:()=>{console.log("[WS] Socket open, initialising connection..."),new A(a,t).run()},onmessage:e=>{a.onReceive(e)},onerror:()=>{}});a.setSocket(r)}setSocket(e){this.socket=e}async startKeepalive(e){await this.socket.startKeepalive(e)}async send(e){await this.socket.send(I.A1.toBinary({packet:e}))}async onReceive(e){this.eventBus.dispatch(I.A1.fromBinary(e).packet)}constructor(){this.eventBus=new T}}class B{static async create(e){let t=new Worker(s.tu(new URL(s.p+s.u(467),s.b))),n=(0,K.LV)(t),a={threads:e.threads,sources:e.sources};return new B(await new n(a))}generateFlatView(){return this.proxy.generateFlatView()}generateSourcesView(){return this.proxy.generateSourcesView()}close(){this.proxy[K.A2]()}constructor(e){this.proxy=e}}var W=s(1630),U=s.n(W),G=s(5573),X=s(8144),$=s(7328),z=s.n($),Q=s(3213),q=s(2779);function Y(e){let{metadata:t}=e,{user:s,startTime:a,interval:r,dataAggregator:i}=t,l=t.comment?'"'+t.comment+'"':"",[o,c]=(0,q.Yq)(a),d="";i&&i.type===I.zy.TICKED&&(d=", ticks >= "+i.tickLengthThreshold/1e3+"ms");let u=t.samplerMode===I.gi.ALLOCATION,h=u?(0,q.DL)(r):"".concat(r/1e3,"ms");return(0,n.jsxs)("div",{className:"textbox title",children:[(0,n.jsx)(z(),{children:(0,n.jsxs)("title",{children:[u?"Memory Profile":"Profile"," @ ",o," ",c," | spark"]})}),(0,n.jsxs)("span",{children:[l,(0,n.jsx)(Q.A,{user:s,platform:t.platform}),null==s?void 0:s.name," @ ",o," ",c,", interval"," ",h,d]})]})}var J=s(2318);function H(e){let{setFlameData:t}=e;return(0,n.jsx)(J.A,{icon:d.GRI,onClick:function(){t(void 0)},title:"Exit the Flame Graph view"})}class Z{getId(){return this.node.id}getDetails(){return(0,N.fX)(this.node)?{type:"thread",name:this.node.name}:{type:"stackTrace",className:this.node.className,methodName:this.node.methodName,parentLineNumber:this.node.parentLineNumber,lineNumber:this.node.lineNumber,methodDesc:this.node.methodDesc}}getTime(){return this.node.time}getTimes(){return this.node.times}getChildren(){return void 0===this.children&&(this.children=this.node.children.map(e=>new Z(this.data,e,this))),this.children}getParents(){return this.parent?[this.parent]:[]}getSource(){return this.data.sources.getSource(this.node.id)}constructor(e,t,s){this.data=e,this.node=t,this.parent=s}}function ee(e){let{data:t,setFlameData:s}=e;return 1!==t.threads.length?null:(0,n.jsx)(J.A,{icon:d.kNw,onClick:function(){s(new Z(t,t.threads[0]))},title:"View the profile as a Flame Graph"})}function et(e){let{graphSupported:t,showGraph:s,setShowGraph:a}=e;return t?(0,n.jsx)(J.A,{icon:d.gK3,onClick:function(){a(e=>!e)},title:"View the graph",extraClassName:s?"toggled":void 0}):null}var es=s(5039),en=s.n(es),ea=s(1995);function er(e){var t,s;let{socket:a,showSocketInfo:r,setShowSocketInfo:i}=e;return a.socket.socket?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:en()("last-update-spinner button textbox",{toggled:r}),onClick:function(e){i(e=>!e)},children:(0,n.jsx)(ea.F,{isPlaying:!0,size:26,strokeWidth:4,duration:null!=(s=null==(t=a.socket.settings)?void 0:t.samplerInterval)?s:60,colors:"#b5b5b5",trailColor:"#3c3f41",children:()=>{var e,t;return(0,n.jsx)(ea.F,{isPlaying:!0,size:16,strokeWidth:4,duration:null!=(t=null==(e=a.socket.settings)?void 0:e.statisticsInterval)?t:10,colors:"#b5b5b5",trailColor:"#3c3f41"},a.lastStatsUpdate)}},a.lastSamplerUpdate)})}):null}function ei(e){let{searchQuery:t}=e;return(0,n.jsx)("input",{className:"searchbar",type:"text",value:t.value,onChange:function(e){t.setValue(e.target.value.toLowerCase())}})}function el(e){let{showSettings:t,setShowSettings:s}=e;return(0,n.jsx)(J.A,{icon:d._$s,onClick:function(){s(e=>!e)},title:"Click to show the settings menu",extraClassName:t?"toggled":void 0})}let eo="flat";function ec(e){let{metadata:t,view:s,setView:a,sourcesViewSupported:r}=e,i=["all",eo,...r?["sources"]:[]];return(0,n.jsx)(n.Fragment,{children:i.map(e=>{let r;if("all"===e)r="all";else if(e===eo)r="flat";else{var i;r=["Fabric","Forge","NeoForge"].includes((null==t||null==(i=t.platform)?void 0:i.name)||"")?"mods":"plugins"}return(0,n.jsx)(J.A,{icon:d.pS3,onClick:function(){a(e)},title:"Toggle the view",extraClassName:s===e?"sources-view-button toggled":"sources-view-button",children:(0,n.jsx)("span",{children:r})},r)})})}function ed(e){let{data:t,metadata:s,metadataToggle:a,exportCallback:r,showSettings:i,setShowSettings:l,view:o,setView:c,sourcesViewSupported:d,graphSupported:u,showGraph:h,setShowGraph:m,socket:p,showSocketInfo:f,setShowSocketInfo:g,flameData:x,setFlameData:v,searchQuery:j}=e;return(0,n.jsxs)("div",{className:U().controls,children:[(0,n.jsx)(Y,{metadata:s}),(0,n.jsx)(X.A,{metadata:s,metadataToggle:a}),(0,n.jsx)(et,{graphSupported:u,showGraph:h,setShowGraph:m}),(0,n.jsx)(el,{showSettings:i,setShowSettings:l}),x?(0,n.jsx)(H,{setFlameData:v}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ec,{metadata:s,view:o,setView:c,sourcesViewSupported:d}),(0,n.jsx)(ee,{data:t,setFlameData:v}),(0,n.jsx)(G.A,{exportCallback:r}),(0,n.jsx)(ei,{searchQuery:j})]}),(0,n.jsx)(er,{socket:p,showSocketInfo:f,setShowSocketInfo:g})]})}var eu=s(7560),eh=s(3860);function em(e){let{flameData:t,mappings:s,metadata:a,timeSelector:r}=e,l=r.getTime,o=a.samplerMode===I.gi.ALLOCATION,[c,d]=(0,i.useMemo)(()=>(function e(t,s,n,a){let r,i,l=t.getDetails();if("thread"===l.type)r=l.name;else if("stackTrace"===l.type){let e=s.resolve(l);if("native"===e.type)r=l.methodName+" (native)";else{let{className:s,methodName:n,packageName:o}=e;o=ep(o,"nms.",/^net\.minecraft\.server(?:\.v[0-9R_]+)?\.(.*)$/),o=ep(o,"nm.",/^net\.minecraft(?:\.v[0-9R_]+)?\.(.*)$/),o=ep(o,"obc.",/^org\.bukkit\.craftbukkit(?:\.v[0-9R_]+)?\.(.*)$/),r="".concat(o||"").concat(s,".").concat(n,"()");let c=a?(0,q.DL)(t.getTime()):"".concat(t.getTime(),"ms");i="".concat(l.className,".").concat(l.methodName,"() - ").concat(c)}}else throw Error("unknown type: "+l.type);let o=n(t),c=[],d=1;for(let r of t.getChildren().sort((e,t)=>n(t)-n(e))){let[t,i]=e(r,s,n,a);d=Math.max(d,i+1),c.push(t)}return[{name:r,tooltip:i,value:o,children:c},d]})(t,s,l,o),[t,s,l,o]),u=Math.min(20*d,5e3);return(0,n.jsx)("div",{className:"flame",style:{height:"".concat(u,"px")},children:(0,n.jsx)(eh.t$,{children:e=>{let{width:t}=e;return(0,n.jsx)(eu.C,{data:c,height:u,width:t})}})})}function ep(e,t,s){if(!e)return e;let n=e.match(s);return n&&2===n.length&&(e=t+n[1]),e}function ef(e){let{isConnectedToSocket:t}=e;return(0,n.jsxs)(h.A,{extraClassName:c()["no-data"],children:[(0,n.jsxs)("h2",{children:[(0,n.jsx)(u.g,{icon:d.QJT})," ",(0,n.jsx)("b",{children:"No Data"})]}),t?(0,n.jsx)("p",{children:"This profile doesn't contain any data yet! The viewer will refresh shortly."}):(0,n.jsx)("p",{children:"This profile doesn't contain any data!"})]})}function eg(e){var t;let{socket:s}=e,{clientId:a,settings:r,latency:i}=s.socket;return(0,n.jsxs)(h.A,{extraClassName:c()["socket-info"],children:[(0,n.jsxs)("h2",{children:[(0,n.jsx)(u.g,{icon:d.jBL,color:"#89d753"})," ",(0,n.jsx)("b",{children:"Connected"})," via WebSocket"]}),(0,n.jsxs)("p",{children:["spark viewer is connected to the spark profiler using a socket connection. ",(0,n.jsx)("br",{}),"The statistics will update every"," ",null!=(t=null==r?void 0:r.statisticsInterval)?t:"?"," seconds, and the profiler data will update every minute."]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("b",{children:"Latency"}),": ",null!=i?i:"?","ms",(0,n.jsx)("br",{}),(0,n.jsx)("b",{children:"Client ID"}),": ",a]})]})}let ex=(0,i.createContext)(void 0),ev=(0,i.createContext)(void 0),ej=(0,i.createContext)(void 0),ew=(0,i.createContext)(void 0),eb=(0,i.createContext)(void 0),eN=(0,i.createContext)(!1),ek=(0,i.createContext)(void 0);function ey(e){let{mappings:t,infoPoints:s,highlighted:a,searchQuery:r,labelMode:i,metadata:l,timeSelector:o,children:c}=e;return(0,n.jsx)(ex.Provider,{value:t,children:(0,n.jsx)(ev.Provider,{value:s,children:(0,n.jsx)(ej.Provider,{value:a,children:(0,n.jsx)(ew.Provider,{value:r,children:(0,n.jsx)(eN.Provider,{value:i,children:(0,n.jsx)(eb.Provider,{value:l,children:(0,n.jsx)(ek.Provider,{value:o,children:c})})})})})})})}class eS{addNode(e){let t=eS.keyForNode(e),s=this.map.get(t);void 0===s&&(s=[],this.map.set(t,s)),s.push(e)}build(){return Array.from(this.map.values())}static keyForNode(e){return"".concat(e.className,"\0").concat(e.methodName,"\0").concat(e.methodDesc)}constructor(){this.map=new Map}}class eC{getId(){return 1==this.nodes.length?this.nodes[0].id:this.nodes.map(e=>e.id)}getDetails(){let e=this.nodes[0];return(0,N.fX)(e)?{type:"thread",name:e.name}:{type:"stackTrace",className:e.className,methodName:e.methodName,parentLineNumber:e.parentLineNumber,lineNumber:e.lineNumber,methodDesc:e.methodDesc}}getTime(){return this.nodes.reduce((e,t)=>e+t.time,0)}getTimes(){if(1===this.nodes.length)return this.nodes[0].times;let e=this.nodes[0].times.length;return this.nodes.reduce((t,s)=>{for(let n=0;n<e;n++)t[n]=t[n]+s.times[n];return t},Array(e).fill(0))}getChildren(){if(1==this.nodes.length)return this.nodes[0].children.map(e=>new eC(this.data,[e]));let e=new eS;return this.nodes.flatMap(e=>e.children).forEach(t=>e.addNode(t)),e.build().map(e=>new eC(this.data,e))}getParents(){let e=new eS,t=[];return this.nodes.map(e=>this.data.bottomUp.getParent(e.id)).filter(e=>void 0!==e).map(e=>this.data.nodes.getNode(e)).forEach(s=>{(0,N.fX)(s)?t.push(s):e.addNode(s)}),[...t.map(e=>new Z(this.data,e)),...e.build().map(e=>new eC(this.data,e))]}getSource(){for(let e of this.nodes){let t=this.data.sources.getSource(e.id);if(t)return t}}constructor(e,t){if(this.data=e,this.nodes=t,0===t.length)throw Error("nodes length is 0")}}class eT{getId(){return this.node.id}getDetails(){return{type:"thread",name:this.node.name}}getTime(){return this.node.threadTime}getTimes(){return this.node.threadTimes}getChildren(){return void 0===this.children&&(this.children=this.node.children.map(e=>new eC(this.data,e.map(e=>this.data.nodes.getNode(e))))),this.children}getParents(){return[]}getSource(){return this.data.sources.getSource(this.node.id)}getSourceTime(){return this.node.sourceTime}constructor(e,t){this.data=e,this.node=t}}class eM{getId(){return this.node.id}getDetails(){return{type:"thread",name:this.node.name}}getTime(){return this.node.time}getTimes(){return this.node.times}getChildren(){return void 0===this.children&&(this.children=this.node.children.map(e=>new eC(this.data,e.map(e=>this.data.nodes.getNode(e))))),this.children}getParents(){return[]}getSource(){return this.data.sources.getSource(this.node.id)}constructor(e,t){this.data=e,this.node=t}}var e_=s(8341);function eI(e){let{value:t,setValue:s,title:a,labelTrue:r,labelFalse:i,children:l}=e;return(0,n.jsxs)("div",{className:"button",children:[(0,n.jsxs)("button",{onClick:function(){s(!t)},children:[(0,n.jsx)(u.g,{icon:d.Ubc})," ",(0,n.jsxs)("span",{children:[a,":"]})," ",t?r:i]}),t?l[0]:l[1]]})}function eA(e){let{bottomUp:t,setBottomUp:s}=e,{t:a}=(0,e_.o)();return(0,n.jsxs)(eI,{value:t,setValue:s,title:a("viewer.sampler.buttons.display"),labelTrue:a("viewer.sampler.displayMode.bottomUp"),labelFalse:a("viewer.sampler.displayMode.topDown"),children:[(0,n.jsx)("p",{children:a("viewer.sampler.displayMode.bottomUpDescription")}),(0,n.jsx)("p",{children:a("viewer.sampler.displayMode.topDownDescription")})]})}function eP(e){let{labelMode:t,setLabelMode:s}=e,{t:a}=(0,e_.o)(),r=(0,i.useContext)(eb);return r.numberOfTicks?r.samplerMode===I.gi.ALLOCATION?(0,n.jsxs)(eI,{value:t,setValue:s,title:a("viewer.sampler.buttons.label"),labelTrue:a("viewer.sampler.buttons.bytesPerSecond"),labelFalse:a("viewer.sampler.labelMode.percentage"),children:[(0,n.jsx)("p",{children:a("viewer.sampler.buttons.bytesPerSecondDescription")}),(0,n.jsx)("p",{children:a("viewer.sampler.buttons.percentageAllocationDescription")})]}):(0,n.jsxs)(eI,{value:t,setValue:s,title:a("viewer.sampler.buttons.label"),labelTrue:a("viewer.sampler.buttons.timePerTick"),labelFalse:a("viewer.sampler.labelMode.percentage"),children:[(0,n.jsx)("p",{children:a("viewer.sampler.buttons.timePerTickDescription")}),(0,n.jsx)("p",{children:a("viewer.sampler.labelMode.percentageDescription")})]}):null}function eE(e){let{selfTimeMode:t,setSelfTimeMode:s}=e,{t:a}=(0,e_.o)();return(0,i.useContext)(eb).samplerMode===I.gi.ALLOCATION?(0,n.jsxs)(eI,{value:t,setValue:s,title:a("viewer.sampler.buttons.sortMode"),labelTrue:a("viewer.sampler.buttons.selfBytesAllocated"),labelFalse:a("viewer.sampler.buttons.totalBytesAllocated"),children:[(0,n.jsx)("p",{children:a("viewer.sampler.buttons.selfBytesDescription")}),(0,n.jsx)("p",{children:a("viewer.sampler.buttons.totalBytesDescription")})]}):(0,n.jsxs)(eI,{value:t,setValue:s,title:a("viewer.sampler.buttons.sortMode"),labelTrue:a("viewer.sampler.sortMode.selfTime"),labelFalse:a("viewer.sampler.sortMode.totalTime"),children:[(0,n.jsx)("p",{children:a("viewer.sampler.sortMode.selfTimeDescription")}),(0,n.jsx)("p",{children:a("viewer.sampler.sortMode.totalTimeDescription")})]})}function eL(e){let{children:t}=e,{t:s}=(0,e_.o)();return(0,n.jsxs)("div",{className:"header",children:[(0,n.jsx)("h2",{children:s("viewer.flatView.title")}),(0,n.jsx)("p",{children:s("viewer.flatView.description")}),t]})}let eF=(0,i.createContext)(!1);function eD(e){let{data:t,viewData:s,setLabelMode:a}=e,r=(0,i.useContext)(eN),[l,o]=(0,i.useState)(!1),[c,d]=(0,i.useState)(!1),u=c?null==s?void 0:s.flatSelfTime:null==s?void 0:s.flatTotalTime;return(0,n.jsxs)("div",{className:"flatview",children:[(0,n.jsxs)(eL,{children:[(0,n.jsx)(eP,{labelMode:r,setLabelMode:a}),(0,n.jsx)(eA,{bottomUp:l,setBottomUp:o}),(0,n.jsx)(eE,{selfTimeMode:c,setSelfTimeMode:d})]}),(0,n.jsx)("hr",{}),u?(0,n.jsx)("div",{className:"stack",children:(0,n.jsx)(eF.Provider,{value:l,children:u.map(e=>(0,n.jsx)(eX,{parents:[],node:new eM(t,e)},e.name))})}):(0,n.jsx)(h.A,{children:"Loading..."})]})}function eV(e){let{node:t,parent:s}=e;if(!s)return null;let a=t.getDetails();if("stackTrace"!==a.type||!a.parentLineNumber)return null;let r=s.getDetails();if("stackTrace"!==r.type)return null;let i="Invoked on line "+a.parentLineNumber+" of "+r.className+"."+r.methodName+"()";return(0,n.jsxs)("span",{className:"lineNumber",title:i,children:[":",a.parentLineNumber]})}function eK(e){let{details:t,mappings:s}=e;switch(t.type){case"thread":return(0,n.jsx)(eO,{details:t,mappings:s});case"stackTrace":return(0,n.jsx)(eR,{details:t,mappings:s})}}let eO=e=>{let{details:t,mappings:s}=e;return(0,n.jsx)(n.Fragment,{children:t.name})},eR=e=>{let{details:t,mappings:s}=e,a=s.resolve(t);if("native"===a.type)return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"native-part",children:t.methodName}),(0,n.jsx)("span",{className:"package-part",children:" (native)"})]});let{className:r,methodName:i,packageName:l,lambda:o,remappedClass:c,remappedMethod:d}=a;return(0,n.jsxs)(n.Fragment,{children:[!!l&&(0,n.jsx)("span",{className:"package-part",children:l}),c?(0,n.jsx)("span",{className:"class-part remapped",title:t.className,children:r}):(0,n.jsx)("span",{className:"class-part",children:r}),!!o&&(0,n.jsx)("span",{className:"lambda-part",children:o}),".",d?(0,n.jsx)("span",{className:"method-part remapped",title:t.methodName,children:i}):(0,n.jsx)("span",{className:"method-part",children:i}),"()"]})};function eB(e){let t,{children:s,time:a,selfTime:r,threadTime:l,importance:o,significance:c,source:d,infoPoint:u,isSourceRoot:h}=e,m=(0,i.useContext)(eb);h&&(a=l-r);let p=(0,i.useContext)(eN),f=(0,i.useContext)(ek);if(p)if(m.samplerMode===I.gi.ALLOCATION)t=a/((f.supported?f.getMillisInRange():m.endTime-m.startTime)/1e3);else{var g;t=a/Math.max(f.supported?f.getTicksInRange():(null==(g=m.dataAggregator)?void 0:g.numberOfIncludedTicks)||m.numberOfTicks,1)}function x(e){return m.samplerMode===I.gi.ALLOCATION?(0,q.DL)(e):(0,q.fU)(e)+"ms"}return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("span",{className:"name",children:[s,(0,n.jsx)("span",{className:"percent",style:{filter:"hue-rotate(-".concat(25*o,"deg)")+" "+"saturate(".concat(1+13*o,")"),opacity:c<.01?.5+100*c/2:void 0},children:p?"".concat(x(t)):(0,q.XL)(a/l)}),u,(0,n.jsxs)("span",{className:"time",children:[x(a),Math.floor(r)>0&&!h&&(0,n.jsxs)(n.Fragment,{children:[" ","(self: ",x(r)," -"," ",(0,q.XL)(r/l),")"]}),!!d&&(0,n.jsxs)(n.Fragment,{children:[" (",d,")"]})]})]}),(0,n.jsx)("div",{className:"bar",children:(0,n.jsx)("span",{className:"inner",style:{width:(0,q.XL)(a/l)}})})]})}function eW(e){let{node:t,mappings:s,lookup:a}=e;if(!a.enabled||!a.methods||!a.threads)return null;let r=t.getDetails();if("stackTrace"===r.type){let e=s.resolve(r);if("native"===e.type)return null;let{className:t,methodName:i,packageName:l}=e,o=a.methods.lookup("".concat(l).concat(t,".").concat(i,"()"));return(0,n.jsx)(eU,{desc:o})}if("thread"===r.type){let e=a.threads.lookup(r.name);return(0,n.jsx)(eU,{desc:e})}return null}s(3120);let eU=e=>{let{desc:t}=e;return t.result?(0,n.jsx)("span",{className:"infopoint","data-tooltip-id":"infopoint-tooltip","data-tooltip-html":t.result,children:(0,n.jsx)(u.g,{icon:d.iW_})}):null},eG=i.memo(e=>{let t,s,{parents:a,node:r,forcedTime:o}=e,c=(0,i.useContext)(ex),d=(0,i.useContext)(ev),u=(0,i.useContext)(ej),h=(0,i.useContext)(ew),m=(0,i.useContext)(ek),p=(0,i.useContext)(eF)&&0!==a.length,f=0!==a.length?a[a.length-1]:null,[g,x]=(0,i.useState)(()=>!!u.check(r)||null!=f&&(p?f.getParents():f.getChildren()).filter(e=>h.matches(e)).length<=1);(0,i.useEffect)(()=>{u.check(r)&&x(!0)},[u,r]);let v=(0,i.useMemo)(()=>a.concat([r]),[a,r]),{show:j}=(0,l.EF)({id:"sampler-cm"});if(!h.matches(r))return null;let w=en()({node:!0,collapsed:!g,parent:0===a.length}),b=en()({"node-info":!0,bookmarked:u.has(r)}),N=m.getTime(r),k=0===a.length?N:m.getTime(a[0]),y=p&&o||N,S=p?0:y-r.getChildren().reduce((e,t)=>e+m.getTime(t),0);if(0===y&&0===N)return null;if(f){let e=f instanceof eT&&f.getSourceTime()||m.getTime(f);t=o?.5:N<e?N/e:e/N,s=e!==N?t:0}else t=1,s=0;let C=r.getId(),T="node-".concat(Array.isArray(C)?C.join("-"):String(C));return(0,n.jsxs)("li",{id:T,className:w,children:[(0,n.jsx)("div",{className:b,onClick:function(e){e.altKey?u.toggle(r):x(!g)},onContextMenu:function(e){e.preventDefault(),j({event:e,props:{node:r}})},children:(0,n.jsxs)(eB,{time:y,selfTime:S,threadTime:k,importance:s,significance:t,source:r.getSource(),infoPoint:(0,n.jsx)(eW,{node:r,mappings:c,lookup:d}),isSourceRoot:r instanceof eT,children:[(0,n.jsx)(eK,{details:r.getDetails(),mappings:c}),(0,n.jsx)(eV,{node:r,parent:f})]})}),g&&(0,n.jsx)("ul",{className:"children",children:(p?r.getParents():r.getChildren()).sort((e,t)=>m.getTime(t)-m.getTime(e)).map((e,t)=>(0,n.jsx)(eG,{node:e,forcedTime:p&&(o||2===a.length)?y:void 0,parents:v},t))})]})});eG.displayName="BaseNode";let eX=eG;function e$(e){let{onClick:t}=e,{t:s}=(0,e_.o)();return(0,n.jsx)("div",{className:"button top-functions-button",children:(0,n.jsxs)("button",{onClick:t,"aria-label":s("viewer.sampler.topFunctions.button"),children:[(0,n.jsx)(u.g,{icon:d.Tsj})," ",(0,n.jsx)("span",{children:s("viewer.sampler.topFunctions.button")})]})})}var ez=s(5278),eQ=s.n(ez);function eq(e){let{topFunctions:t,isOpen:s,onClose:a,onFunctionClick:r}=e,{t:l}=(0,e_.o)(),o=(0,i.useContext)(ej),c=(0,i.useContext)(eb);return s?(0,n.jsx)("div",{className:eQ().backdrop,onClick:function(e){e.target===e.currentTarget&&a()},children:(0,n.jsxs)("div",{className:eQ().modal,children:[(0,n.jsxs)("div",{className:eQ().header,children:[(0,n.jsx)("h2",{children:l("viewer.sampler.topFunctions.title")}),(0,n.jsx)("button",{className:eQ().closeButton,onClick:a,"aria-label":"Close",children:(0,n.jsx)(u.g,{icon:d.GRI})})]}),(0,n.jsx)("div",{className:eQ().content,children:(0,n.jsx)("div",{className:eQ().functionList,children:t.map((e,t)=>(0,n.jsxs)("div",{className:eQ().functionItem,onClick:()=>{o.replace(e.node),r(e),a()},children:[(0,n.jsx)("div",{className:eQ().rank,children:t+1}),(0,n.jsxs)("div",{className:eQ().functionInfo,children:[(0,n.jsx)("div",{className:eQ().functionName,children:e.name}),(()=>{var t;let s=e.node.getSource(),a=s&&c?null==(t=c.sources)?void 0:t[s]:void 0;return a?(0,n.jsxs)("div",{className:eQ().functionMeta,children:[a.name,a.version?" "+a.version:""]}):null})(),(0,n.jsxs)("div",{className:eQ().functionStats,children:[(0,n.jsxs)("span",{className:eQ().time,children:[e.selfTime.toFixed(0)," ms"]}),(0,n.jsxs)("span",{className:eQ().percentage,children:[e.percentage.toFixed(2),"%"]})]})]})]},t))})})]})}):null}function eY(e){let{children:t}=e,{t:s}=(0,e_.o)();return(0,n.jsxs)("div",{className:"header",children:[(0,n.jsx)("h2",{children:s("viewer.allView.title")}),(0,n.jsx)("p",{children:s("viewer.allView.description")}),t]})}function eJ(e){let{data:t,setLabelMode:s}=e,a=(0,i.useContext)(eN);(0,i.useContext)(ej);let[r,l]=(0,i.useState)(!1),[o,c]=(0,i.useState)([]);return(0,n.jsxs)("div",{className:"allview",children:[(0,n.jsxs)(eY,{children:[(0,n.jsx)(eP,{labelMode:a,setLabelMode:s}),(0,n.jsx)(e$,{onClick:function(){c(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,s=e.nodes.stackTraceNodes,n=e.threads.reduce((e,t)=>e+t.time,0);return s.filter(e=>e.time>0).map(t=>{let s=new Z(e,t),a=s.getDetails(),r=t.children.reduce((e,t)=>e+t.time,0),i=t.time-r,l="stackTrace"===a.type&&a.className&&a.methodName?"".concat(a.className,".").concat(a.methodName):"stackTrace"===a.type?a.className||a.methodName||"Unknown":a.name||"Unknown";return{node:s,time:t.time,selfTime:i,percentage:n>0?i/n*100:0,name:l,className:"stackTrace"===a.type?a.className:void 0,methodName:"stackTrace"===a.type?a.methodName:void 0}}).filter(e=>e.selfTime>0).sort((e,t)=>t.selfTime-e.selfTime).slice(0,t)}(t,20)),l(!0)}})]}),(0,n.jsx)("hr",{}),(0,n.jsx)("div",{className:"stack",children:t.threads.map(e=>(0,n.jsx)(eX,{parents:[],node:new Z(t,e)},e.name))}),(0,n.jsx)(eq,{topFunctions:o,isOpen:r,onClose:()=>l(!1),onFunctionClick:function(e){let t=e.node.getId(),s="node-".concat(Array.isArray(t)?t.join("-"):String(t)),n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=document.getElementById(s);t?t.scrollIntoView({behavior:"smooth",block:"center"}):e<8&&setTimeout(()=>n(e+1),100)};setTimeout(()=>n(),50)}})]})}function eH(e){let{merged:t,setMerged:s}=e,{t:a}=(0,e_.o)();return(0,n.jsxs)(eI,{value:t,setValue:s,title:a("viewer.sampler.buttons.mergeMode"),labelTrue:a("viewer.sampler.buttons.merge"),labelFalse:a("viewer.sampler.buttons.separate"),children:[(0,n.jsx)("p",{children:a("viewer.sampler.buttons.mergeDescription")}),(0,n.jsx)("p",{children:a("viewer.sampler.buttons.separateDescription")})]})}function eZ(e){var t;let{children:s}=e,a=(0,i.useContext)(eb),{t:r}=(0,e_.o)(),l=["Fabric","Forge","NeoForge"].includes(null==(t=a.platform)?void 0:t.name);return(0,n.jsxs)("div",{className:"header",children:[(0,n.jsx)("h2",{children:r(l?"viewer.sourcesView.modsTitle":"viewer.sourcesView.pluginsTitle")}),(0,n.jsx)("p",{children:r(l?"viewer.sourcesView.modsDescription":"viewer.sourcesView.pluginsDescription")}),s]})}function e0(e){let{data:t,viewData:s,setLabelMode:a}=e,r=(0,i.useContext)(eN),[l,o]=(0,i.useState)(!0),c=l?null==s?void 0:s.sourcesMerged:null==s?void 0:s.sourcesSeparate;return(0,n.jsxs)("div",{className:"sourceview",children:[(0,n.jsxs)(eZ,{children:[(0,n.jsx)(eP,{labelMode:r,setLabelMode:a}),(0,n.jsx)(eH,{merged:l,setMerged:o})]}),(0,n.jsx)("hr",{}),c?(0,n.jsxs)(n.Fragment,{children:[c.map(e=>(0,n.jsx)(e2,{data:t,viewData:e},e.source)),(0,n.jsx)(e3,{alreadyShown:c.map(e=>e.source)})]}):(0,n.jsx)(h.A,{children:"Loading..."})]})}let e1=e=>e.startsWith("v")?e:"v"+e,e2=e=>{let{data:t,viewData:s}=e,{source:a,threads:r}=s,l=(0,i.useContext)(eb).sources[a.toLowerCase()];return(0,n.jsxs)("div",{className:"stack",children:[(0,n.jsxs)("h2",{children:[a," ",l&&(0,n.jsxs)("span",{className:"version",children:["(",e1(l.version),")"]})]}),r.map(e=>(0,n.jsx)(eX,{parents:[],node:new eT(t,e)},e.name))]})},e3=e=>{var t;let{alreadyShown:s}=e,a=(0,i.useContext)(eb);if(!a.sources)return null;let r=Object.values(a.sources).filter(e=>!s.includes(e.name)).filter(e=>!e.builtIn);if(!r.length)return null;let l=["Fabric","Forge","NeoForge"].includes(null==a||null==(t=a.platform)?void 0:t.name)?"mods":"plugins";return(0,n.jsxs)("div",{className:"other-sources",children:[(0,n.jsx)("h2",{children:"Other"}),(0,n.jsxs)("p",{children:["The following other ",l," are installed, but didn't show up in this profile. Yay!"]}),(0,n.jsx)("ul",{children:r.map(e=>{let{name:t,version:s}=e;return(0,n.jsxs)("li",{children:[t," ",(0,n.jsxs)("span",{children:["(",e1(s),")"]})]},t)})})]})};var e5=s(9893);async function e4(){let e=await fetch("https://spark-infopoints.lucko.me/points.json");return await e.json()}class e8{lookup(e){let t=this.map.get(e);if(t)return t;for(let[t,s]of this.regexMap)if(t.test(e)){let t={result:s};return this.map.set(e,t),t}return this.map.set(e,e8.EMPTY_RESULT),e8.EMPTY_RESULT}constructor(e,t){for(let s of(this.map=new Map,this.regexMap=new Map,e.points))for(let e of t(s)){let t=e8.REGEX_KEY.exec(e);if(t){let e=new RegExp(t[1]);this.regexMap.set(e,s.description)}else this.map.set(e,{result:s.description})}}}e8.EMPTY_RESULT={},e8.REGEX_KEY=/\/(.+)\//;var e7=s(2127);let e6="".concat(e7._.NEXT_PUBLIC_SPARK_MAPPINGS_URL,"/dist/");async function e9(){let e=await fetch(e6+"mappings.json");return await e.json()}async function te(e,t,s){let n=await fetch(e6+e+"/"+t+".wasm");return s(new Uint8Array(await n.arrayBuffer()))}class tt{map(e){return{}}constructor(){}}tt.INSTANCE=new tt;class ts{map(e){let t;if(!e.className.startsWith(this.expectedPackage))return{};let s=e.className.substring(this.expectedPackage.length);if(t=this.nmsVersion?this.bukkitMappings.classes[s]:this.bukkitMappings.classes["net.minecraft."+s],"MinecraftServer"===s&&(t=this.bukkitMappings.classes["net.minecraft.server.MinecraftServer"]),!t)return{};let n=t.obfuscated,a=this.outputMappings.classes[n];if(!a||t.methods.some(t=>t.mapped===e.methodName))return{};let r=a.methods.filter(t=>t.obfuscated===e.methodName);if(!r)return{};if(1===r.length)return{methodName:r[0].mapped};if(!e.methodDesc)return{};for(let t of r){let s=t.description.replace(/L([^;]+);/g,e=>{let t=e.substring(1,e.length-1),s=this.classesObfuscated[t];if(s)if(this.nmsVersion)return"Lnet/minecraft/server/"+this.nmsVersion+"/"+s.mapped+";";else return"L"+s.mapped.replaceAll(".","/")+";";return e});if(e.methodDesc===s)return{methodName:t.mapped}}return{}}constructor(e,t,s){for(let n of(this.outputMappings=e,this.bukkitMappings=t,this.nmsVersion=s,s?this.expectedPackage="net.minecraft.server."+s+".":this.expectedPackage="net.minecraft.",this.classesObfuscated={},Object.values(t.classes)))this.classesObfuscated[n.obfuscated]=n}}class tn{map(e){return{methodName:this.mcpMappings.methods[e.methodName]}}constructor(e){this.mcpMappings=e}}class ta{map(e){let t,s=e.className.match(/^(.+)(\$\$Lambda.+)$/),n=s?this.mojangMappings.classes[s[1]]:this.mojangMappings.classes[e.className];if(!n)return{};let a=n.mapped+(s?s[2]:""),r=n.methods.filter(t=>t.obfuscated===e.methodName);if(1===r.length)t=r[0].mapped;else if(r.length>1){let s=r.find(t=>t.description===e.methodDesc);s&&(t=s.mapped)}return{className:a,methodName:t}}constructor(e){this.mojangMappings=e}}class tr{map(e){let t=this.yarnMappings.methods[e.methodName],s=e.className.match(/^(.+)(\$\$Lambda.+)$/);return{className:s?(this.yarnMappings.classes[s[1]]||s[1])+s[2]:this.yarnMappings.classes[e.className],methodName:t}}constructor(e){this.yarnMappings=e}}async function ti(e,t,s){if("auto"===e){let n=function(e,t){if(!e.auto||!t||!t.platform||!t.platform.name||!t.platform.minecraftVersion||t.platform.type===I.KI.PROXY)return null;let s=t.platform.minecraftVersion.match(/(\d+\.\d+) Release Candidate \d+/);s&&(t.platform.minecraftVersion=s[1]);let n=t.platform.name.toLowerCase();"paper"===n?n="bukkit":t.platform.type===I.KI.APPLICATION&&(n="vanilla");let a=n+"/"+t.platform.minecraftVersion;return e.auto[a]}(t,s);if(!n)return tt.INSTANCE;e=n}if(e.startsWith("bukkit-mojang")){let s=e.substring(14),n=t.types["bukkit-mojang"].versions[s].nmsVersion,a=t.types["bukkit-mojang"].versions[s].mojangClassNamesAtRuntime;if(!n&&!a)throw Error("No NMS version specified!");let[r,i]=await Promise.all([te(s,"mojang",e=>I.cx.fromBinary(e)),te(s,"bukkit",e=>I.oj.fromBinary(e))]);return new ts(r,i,n)}if(e.startsWith("bukkit")){let s=e.substring(7),n=t.types.bukkit.versions[s].nmsVersion,[a,r]=await Promise.all([te(s,"mcp",e=>I.Qx.fromBinary(e)),te(s,"bukkit",e=>I.oj.fromBinary(e))]);return new ts(a,r,n)}if(e.startsWith("mcp")){let t=e.substring(4);return new tn(await te(t,"mcp",e=>I.Qx.fromBinary(e)))}if(e.startsWith("yarn")){let t=e.substring(5);return new tr(await te(t,"yarn",e=>I.CO.fromBinary(e)))}{if(!e.startsWith("vanilla"))return tt.INSTANCE;let t=e.substring(8);return new ta(await te(t,"mojang",e=>I.cx.fromBinary(e)))}}class tl{resolve(e){let t,s;if("native"===e.className)return{type:"native"};let{className:n,methodName:a}=this.mappingFunction.map(e)||{},r=!!n,i=!!a;n=n||e.className,a=a||e.methodName;let l=n.indexOf("$$Lambda");return -1!==l&&(t=n.substring(l),n=n.substring(0,l)),-1!==(l=n.lastIndexOf("."))&&(s=n.substring(0,l+1),n=n.substring(l+1)),{type:"normal",className:n,methodName:a,packageName:s,lambda:t,remappedClass:r,remappedMethod:i}}constructor(e){this.mappingFunction=e}}var to=s(1528),tc=s.n(to);function td(e){let{value:t,toggle:s}=e;return(0,n.jsxs)("label",{className:tc().switch,children:[(0,n.jsx)("input",{type:"checkbox",checked:t,onChange:()=>s()}),(0,n.jsx)("span",{className:tc().slider})]})}function tu(e){let t,{mappingsMetadata:s,mappings:a,setMappings:r}=e,i=[{id:"none",label:"None",options:[{id:"auto",label:"Auto Detect"},{id:"none",label:"No Mappings"}]}];for(t in s.types){let e=s.types[t],n=[];for(let s of Object.keys(e.versions)){let a=e.versions[s],r=e.format.replace("%s",a.name);n.push({id:t+"-"+s,label:r})}i.push({id:t,label:e.name,options:n})}return(0,n.jsx)("span",{className:"dropdown",id:"mappings-selector",children:(0,n.jsx)("select",{title:"mappings",value:a,onChange:e=>r(e.target.value),children:i.map(e=>(0,n.jsx)(th,{group:e},e.id))})})}let th=e=>{let{group:t}=e;return(0,n.jsx)("optgroup",{label:t.label,children:t.options.map(e=>(0,n.jsx)(tm,{option:e},e.id))})},tm=e=>{let{option:t}=e;return(0,n.jsx)("option",{value:t.id,children:t.label})};function tp(e){let{mappingsMetadata:t,mappings:s,setMappings:a,infoPoints:r,toggleInfoPoints:i}=e;return(0,n.jsxs)(h.A,{extraClassName:c()["settings-menu"],children:[t&&(0,n.jsx)(tf,{name:"Mappings",desc:"Select which deobfuscation mappings the viewer should use when displaying profiler frames.",children:(0,n.jsx)(tu,{mappingsMetadata:t,mappings:s,setMappings:a})}),(0,n.jsx)(tf,{name:"Info Points",desc:"Select whether info points should be shown.",children:(0,n.jsx)(td,{value:r,toggle:i})})]})}let tf=e=>{let{name:t,desc:s,children:a}=e;return(0,n.jsxs)("div",{className:"setting",children:[(0,n.jsxs)("div",{className:"setting-control",children:[(0,n.jsx)(u.g,{icon:d._$s})," ",(0,n.jsxs)("span",{children:[t,":"]})," ",a]}),(0,n.jsx)("p",{children:s})]})};var tg=s(6167),tx=s.n(tg);function tv(e){let{isOpen:t,onClose:s,node:a,metadata:r}=e,{t:l}=(0,e_.o)(),o=(0,i.useMemo)(()=>null==a?void 0:a.getSource(),[a]),c=(0,i.useMemo)(()=>{try{var e;if(!o||!r)return;return null==(e=r.sources)?void 0:e[o]}catch(e){return}},[o,r]),h=(0,i.useMemo)(()=>{if(!a||!r)return[];let e=new Map,t=new Set,s=[a];for(;s.length;){let n=s.shift(),a=Array.isArray(n.getId())?n.getId().join("-"):String(n.getId());if(t.has(a))continue;t.add(a);let r=n.getSource();if(r){let t=e.get(r)||0;e.set(r,t+("function"==typeof n.getTime?n.getTime():0))}for(let e of n.getParents()){let n=Array.isArray(e.getId())?e.getId().join("-"):String(e.getId());t.has(n)||s.push(e)}for(let e of n.getChildren()){let n=Array.isArray(e.getId())?e.getId().join("-"):String(e.getId());t.has(n)||s.push(e)}}o&&e.delete(o);let n=Array.from(e.entries()).sort((e,t)=>t[1]-e[1]).slice(0,8).map(e=>{let[t,s]=e;return{key:t,total:s}}),i=n.reduce((e,t)=>e+t.total,0);return n.map(e=>(0,S._)((0,y._)({},e),{percent:i>0?e.total/i:0}))},[a,r,o]);return t?(0,n.jsx)("div",{className:tx().backdrop,onClick:function(e){e.target===e.currentTarget&&s()},children:(0,n.jsxs)("div",{className:tx().modal,role:"dialog","aria-modal":!0,children:[(0,n.jsxs)("div",{className:tx().header,children:[(0,n.jsx)("h2",{children:l("viewer.sourceModal.title")}),(0,n.jsx)("button",{className:tx().closeButton,onClick:s,"aria-label":l("common.close"),children:(0,n.jsx)(u.g,{icon:d.GRI})})]}),(0,n.jsxs)("div",{className:tx().content,children:[!o&&(0,n.jsx)("div",{className:tx().empty,children:l("viewer.sourceModal.noSource")}),o&&(0,n.jsxs)("div",{className:tx().field,children:[(0,n.jsx)("div",{className:"label",children:l("viewer.sourceModal.sourceKey")}),(0,n.jsx)("div",{className:"value",children:o})]}),c?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:tx().field,children:[(0,n.jsx)("div",{className:"label",children:l("viewer.sourceModal.name")}),(0,n.jsx)("div",{className:"value",children:c.name||"-"})]}),(0,n.jsxs)("div",{className:tx().field,children:[(0,n.jsx)("div",{className:"label",children:l("viewer.sourceModal.version")}),(0,n.jsx)("div",{className:"value",children:c.version||"-"})]}),(0,n.jsxs)("div",{className:tx().field,children:[(0,n.jsx)("div",{className:"label",children:l("viewer.sourceModal.author")}),(0,n.jsx)("div",{className:"value",children:c.author||"-"})]}),c.description&&(0,n.jsxs)("div",{className:tx().field,children:[(0,n.jsx)("div",{className:"label",children:l("viewer.sourceModal.description")}),(0,n.jsx)("div",{className:"value",children:c.description})]})]}):o?(0,n.jsx)("div",{className:tx().empty,children:l("viewer.sourceModal.notFound")}):(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:tx().field,children:[(0,n.jsx)("div",{className:"label",children:l("viewer.sourceModal.suggestionsTitle")}),0===h.length?(0,n.jsx)("div",{className:"value",children:l("viewer.sourceModal.suggestionsNone")}):(0,n.jsx)("div",{className:"value",children:(0,n.jsx)("ul",{children:h.map((e,t)=>{var s;let a=null==(s=r.sources)?void 0:s[e.key];return(0,n.jsxs)("li",{children:[(0,n.jsx)("span",{children:(null==a?void 0:a.name)?"".concat(a.name).concat(a.version?" "+a.version:""):e.key}),(0,n.jsxs)("span",{style:{float:"right",color:"#9f9f9f"},children:[(0,q.fU)(e.total),"ms • ",(0,q.XL)(e.percent)]})]},t)})})})]})})]})]})}):null}let tj=r()(()=>Promise.all([s.e(628),s.e(274)]).then(s.bind(s,4274)),{loadableGenerated:{webpack:()=>[4274]}});function tw(e){var t;let{data:s,fetchUpdatedData:a,metadata:r,setMetadata:o,exportCallback:d}=e,u=function(e){let[t,s]=(0,i.useState)(""),n=(0,i.useMemo)(()=>t?new k(e).resolveSearchQuery(t):null,[e,t]);return{value:t,setValue:s,matches:(0,i.useCallback)(e=>{if(null==n)return!0;let t=e.getId();return Array.isArray(t)?t.some(e=>n.has(e)):n.has(t)},[n])}}(s),h=function(){let e=(0,x.useRouter)(),[t,s]=(0,i.useState)(()=>{let t=new Set,s=e.query.hl;return s&&s.split(",").forEach(e=>t.add(parseInt(e))),t});(0,i.useEffect)(()=>{let s=Array.from(t).join(",");if(!s&&!e.query.hl||s===e.query.hl)return;let n=e.asPath,a=n.indexOf("?");a>=0&&(n=n.substring(0,a));let r=t.size?"?hl=".concat(s):"";e.push(n+r,void 0,{shallow:!0})},[t,e]);let n=(0,i.useCallback)(e=>{s(t=>{let s=new Set(t);return j(s,e.getId())?b(s,e.getId()):w(s,e.getId()),s})},[s]),a=(0,i.useCallback)(e=>{if(!t.size)return!1;if(j(t,e.getId()))return!0;for(let t of e.getChildren())if(a(t))return!0;return!1},[t]),r=(0,i.useCallback)(e=>j(t,e.getId()),[t]);return{toggle:n,check:a,has:r,clear:(0,i.useCallback)(()=>s(new Set),[s]),replace:(0,i.useCallback)(e=>{let t=new Set;w(t,e.getId()),s(t)},[s])}}(),[v,N]=(0,i.useState)(!1),T=function(e,t){let s=(0,i.useMemo)(()=>e.length>1,[e]),[n,a]=(0,i.useState)(new Set),[r,l]=(0,i.useState)(!0),o=(0,i.useCallback)(e=>r||n.has(e),[n,r]),c=(0,i.useCallback)(t=>{let s=new Set(e.filter(t));a(s),l(e.length===s.size)},[e]),d=(0,i.useCallback)(t=>{let s=t.getTimes();return s&&!r?s.filter((t,s)=>o(e[s])).reduce((e,t)=>e+t,0):t.getTime()},[r,o,e]),u=(0,i.useCallback)(()=>{let s=0;for(let n of e)o(n)&&(s+=t[n].ticks);return s},[o,t,e]),h=(0,i.useCallback)(()=>{let s=0;for(let n of e)o(n)&&(s+=t[n].duration);return s},[o,t,e]);return{supported:s,times:e,isTimeSelected:o,setSelectedTimes:c,allTimesSelected:r,getTime:d,getTicksInRange:u,getMillisInRange:h}}(s.timeWindows,s.timeWindowStatistics),M=function(e){let[t,s]=(0,i.useState)(),[n,a]=(0,i.useState)(new tl(tt.INSTANCE)),[r,l]=(0,i.useState)("none"===(0,L.get)("spark-mappings-pref")?"none":"auto");(0,i.useEffect)(()=>{e9().then(s)},[]);let o=(0,i.useCallback)(s=>{t&&e&&r!==s&&(l(s),ti(s,t,e).then(e=>{a(new tl(e))}),"none"===s?(0,L.set)("spark-mappings-pref","none"):(0,L.remove)("spark-mappings-pref"))},[r,t,e]);return(0,i.useEffect)(()=>{t&&e&&"auto"===r&&ti("auto",t,e).then(e=>{a(new tl(e))})},[r,t,e]),{requestMappings:o,mappingsMetadata:t,mappingsResolver:n,mappingsType:r}}(r),_=function(){let[e,t,s]=(0,g.A)("prefInfoPoints",!0),[n,a]=(0,i.useState)(),[r,l]=(0,i.useState)();return(0,i.useEffect)(()=>{e4().then(e=>{a(new e8(e,e=>e.methods)),l(new e8(e,e=>e.threads))})},[]),{methods:n,threads:r,enabled:e,setEnabled:t,toggleEnabled:s}}(),[I,A]=(0,i.useState)(),[P,E]=(0,i.useState)(!1),[F,D]=(0,i.useState)(),[V,K]=(0,i.useState)("all"),[O,W]=(0,g.A)("prefShowGraph",!0),[U,G]=(0,i.useState)(!1),[X,$]=(0,g.A)("prefShowSocket",!1),[z,Q]=(0,i.useState)(),[q,Y]=(0,i.useState)();(0,i.useEffect)(()=>{(async()=>{let e=await B.create(s);s.sources.hasSources()&&Y(await e.generateSourcesView()),Q(await e.generateFlatView()),e.close()})()},[s]);let J=function(e){var t,s;let{socket:n,fetchUpdatedData:a,metadata:r,setMetadata:l}=e,[o,c]=(0,i.useState)(),[d,u]=(0,i.useState)();return t=n.socket,s=(0,i.useCallback)(e=>{if("serverUpdateStatistics"===e.oneofKind){var t;let{platform:s,system:n}=e.serverUpdateStatistics,a=(0,S._)((0,y._)({},s),{world:null==(t=r.platformStatistics)?void 0:t.world});l((0,S._)((0,y._)({},r),{platformStatistics:a,systemStatistics:n})),c(Date.now())}return"serverUpdateSampler"===e.oneofKind&&(a(e.serverUpdateSampler.payloadId),u(Date.now())),C.KEEP_LISTENING},[r,l,a]),(0,i.useEffect)(()=>{if(t)return t.eventBus.register(s)},[t,s]),{socket:n,lastStatsUpdate:o,lastSamplerUpdate:d}}({socket:function(e,t){let[s,n]=(0,i.useState)(!1),[a,r]=(0,i.useState)(),[l,o]=(0,i.useState)(),[c,d]=(0,i.useState)(!1),[u,h]=(0,i.useState)(),[m,p]=(0,i.useState)(),f=(0,i.useCallback)(async e=>{await R.connect(e,{onConnect(e,s,n,a,i){r(e),o(a),d(n),h(s),i&&t(i)},onPing(e){p(e)},onClose(){r(void 0)}})},[t]);return(0,i.useEffect)(()=>{e&&!s&&(n(!0),f(e).catch(e=>{console.log("Error initialising the socket",e)}))},[e,s,f]),{socket:a,clientId:l,trusted:c,settings:u,latency:m}}(s.channelInfo,a),fetchUpdatedData:a,metadata:r,setMetadata:o}),H=(0,f.A)(),{t:Z}=(0,e_.o)(),ee=(null==r||null==(t=r.platform)?void 0:t.sparkVersion)&&r.platform.sparkVersion>=2;return(0,n.jsxs)("div",{className:c().sampler,children:[(0,n.jsx)(ed,{data:s,metadata:r,metadataToggle:H,exportCallback:d,showSettings:U,setShowSettings:G,view:V,setView:K,sourcesViewSupported:s.sources.hasSources(),graphSupported:T.supported,showGraph:O,setShowGraph:W,socket:J,showSocketInfo:X,setShowSocketInfo:$,flameData:I,setFlameData:A,searchQuery:u}),U&&(0,n.jsx)(tp,{mappingsMetadata:M.mappingsMetadata,mappings:M.mappingsType,setMappings:M.requestMappings,infoPoints:_.enabled,toggleInfoPoints:_.toggleEnabled}),X&&J.socket.socket&&(0,n.jsx)(eg,{socket:J}),!ee&&(0,n.jsx)(m,{}),(0,n.jsx)(p.A,{metadata:r,metadataToggle:H}),T.supported&&(0,n.jsx)(i.Suspense,{fallback:null,children:(0,n.jsx)(tj,{show:O,timeSelector:T,windowStatistics:s.timeWindowStatistics})}),!!I&&(0,n.jsx)(em,{flameData:I,mappings:M.mappingsResolver,metadata:r,timeSelector:T}),(0,n.jsx)("div",{style:{display:I?"none":void 0},children:(0,n.jsxs)(ey,{mappings:M.mappingsResolver,infoPoints:_,highlighted:h,searchQuery:u,labelMode:v,metadata:r,timeSelector:T,children:["all"===V?(0,n.jsx)(eJ,{data:s,setLabelMode:N}):V===eo?(0,n.jsx)(eD,{data:s,viewData:z,setLabelMode:N}):(0,n.jsx)(e0,{data:s,viewData:q,setLabelMode:N}),_.enabled&&(0,n.jsx)(e5.m_,{id:"infopoint-tooltip",place:"right",className:"infopoint-tooltip",clickable:!0})]})}),0===s.threads.length&&(0,n.jsx)(ef,{isConnectedToSocket:!!J.socket.socket}),(0,n.jsxs)(l.W1,{id:"sampler-cm",theme:"dark",children:[(0,n.jsx)(l.q7,{onClick:function(e){var t;let s=null==(t=e.props)?void 0:t.node;s&&A(s)},children:Z("viewer.contextMenu.viewAsFlame")}),(0,n.jsx)(l.q7,{onClick:function(e){var t;let s=null==(t=e.props)?void 0:t.node;s&&(D(s),E(!0))},children:Z("viewer.contextMenu.showSource")}),(0,n.jsx)(l.q7,{onClick:function(e){e.props&&h.toggle(e.props.node)},children:Z("viewer.contextMenu.toggleBookmark")}),(0,n.jsx)(l.q7,{onClick:function(){h.clear()},children:Z("viewer.contextMenu.clearBookmarks")})]}),(0,n.jsx)(tv,{isOpen:P,onClose:()=>E(!1),node:F,metadata:r})]})}},5278:e=>{e.exports={backdrop:"TopFunctionsModal_backdrop__lxXiL",modal:"TopFunctionsModal_modal__QV73V",header:"TopFunctionsModal_header__OapJI",closeButton:"TopFunctionsModal_closeButton__6lRl3",content:"TopFunctionsModal_content__OeBSA",functionList:"TopFunctionsModal_functionList__TtjTy",functionItem:"TopFunctionsModal_functionItem__k8LEg",rank:"TopFunctionsModal_rank__P06VN",functionInfo:"TopFunctionsModal_functionInfo__fIgP2",functionMeta:"TopFunctionsModal_functionMeta__yJa8O",functionName:"TopFunctionsModal_functionName__PN4fs",functionStats:"TopFunctionsModal_functionStats__YTvjj",time:"TopFunctionsModal_time__QPkKP",percentage:"TopFunctionsModal_percentage__duukl"}},6167:e=>{e.exports={backdrop:"SourceInfoModal_backdrop__Gf7Qe",modal:"SourceInfoModal_modal__k9WCS",header:"SourceInfoModal_header__htPtS",closeButton:"SourceInfoModal_closeButton__KRWpe",content:"SourceInfoModal_content__BS0zR",field:"SourceInfoModal_field__aIfl1",label:"SourceInfoModal_label__qJiW8",value:"SourceInfoModal_value__bKqdb",empty:"SourceInfoModal_empty__Wz9_T"}},6570:e=>{e.exports={sampler:"sampler_sampler__ukhXD","version-warning":"sampler_version-warning__d4E7m","socket-info":"sampler_socket-info__zWi5e","settings-menu":"sampler_settings-menu__mXCl3","no-data":"sampler_no-data__9SnRa"}},8144:(e,t,s)=>{"use strict";s.d(t,{A:()=>l});var n=s(7876),a=s(1041),r=s(2318),i=s(8341);function l(e){let{metadata:t,metadataToggle:s}=e,{t:l}=(0,i.o)();return t.platform?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(r.A,{icon:a.d1P,onClick:s.toggleWidgets,title:l("viewer.controls.toggleWidgets"),extraClassName:s.showWidgets?"toggled":void 0}),(0,n.jsx)(r.A,{icon:a.iW_,onClick:s.toggleInfo,title:l("viewer.controls.toggleMetadata"),extraClassName:s.showInfo?"toggled":void 0})]}):null}}}]);