(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[666],{550:e=>{e.exports={container:"FlameGraphCanvas_container__6tvDf",canvas:"FlameGraphCanvas_canvas__olyCD",tooltip:"FlameGraphCanvas_tooltip__jEGbC"}},1528:e=>{e.exports={switch:"switch_switch__MKxDO",slider:"switch_slider__uUjiS"}},5278:e=>{e.exports={backdrop:"TopFunctionsModal_backdrop__lxXiL",modal:"TopFunctionsModal_modal__QV73V",header:"TopFunctionsModal_header__OapJI",closeButton:"TopFunctionsModal_closeButton__6lRl3",content:"TopFunctionsModal_content__OeBSA",functionList:"TopFunctionsModal_functionList__TtjTy",functionItem:"TopFunctionsModal_functionItem__k8LEg",rank:"TopFunctionsModal_rank__P06VN",functionInfo:"TopFunctionsModal_functionInfo__fIgP2",functionMeta:"TopFunctionsModal_functionMeta__yJa8O",functionName:"TopFunctionsModal_functionName__PN4fs",functionStats:"TopFunctionsModal_functionStats__YTvjj",time:"TopFunctionsModal_time__QPkKP",percentage:"TopFunctionsModal_percentage__duukl",pctLow:"TopFunctionsModal_pctLow__o0_Wl",pctMed:"TopFunctionsModal_pctMed__kMFo0",pctHigh:"TopFunctionsModal_pctHigh__xLmfw",sourceList:"TopFunctionsModal_sourceList__KO8Z_",sourceItem:"TopFunctionsModal_sourceItem__R3PmX",sourceName:"TopFunctionsModal_sourceName__YMWCl",sourceStats:"TopFunctionsModal_sourceStats__xQ23R",expandRow:"TopFunctionsModal_expandRow__fnU6M",expandButton:"TopFunctionsModal_expandButton__3jO_I"}},6167:e=>{e.exports={backdrop:"SourceInfoModal_backdrop__Gf7Qe",modal:"SourceInfoModal_modal__k9WCS",header:"SourceInfoModal_header__htPtS",closeButton:"SourceInfoModal_closeButton__KRWpe",content:"SourceInfoModal_content__BS0zR",field:"SourceInfoModal_field__aIfl1",label:"SourceInfoModal_label__qJiW8",value:"SourceInfoModal_value__bKqdb",empty:"SourceInfoModal_empty__Wz9_T"}},6570:e=>{e.exports={sampler:"sampler_sampler__ukhXD","version-warning":"sampler_version-warning__d4E7m","socket-info":"sampler_socket-info__zWi5e","settings-menu":"sampler_settings-menu__mXCl3","no-data":"sampler_no-data__9SnRa"}},9666:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>tx});var n=s(7876),r=s(8847),a=s.n(r),i=s(4232),o=s(3038),l=s(6570),c=s.n(l),d=s(1041),u=s(7460),m=s(9915);function p(){let[e,t]=(0,i.useState)(!0);if(!e)return null;let s=(0,n.jsx)("span",{role:"img","aria-label":"warning",children:"⚠️"});return(0,n.jsxs)(m.A,{extraClassName:c()["version-warning"],children:[s,(0,n.jsx)("b",{children:" This profile was created using an old version of spark! "}),s,(0,n.jsx)(u.g,{icon:d.GRI,onClick:function(){t(!1)}}),(0,n.jsx)("br",{}),"Some viewer features cannot be supported. Please consider updating to a newer version."]})}var h=s(140),f=s(4344),g=s(3957),v=s(3576),x=s(9099);let w=e=>(t,s)=>{if(!Array.isArray(s))return e(t,s);for(let n of s)if(e(t,n))return!0;return!1},j=w((e,t)=>e.has(t)),y=w((e,t)=>(e.add(t),!1)),b=w((e,t)=>(e.delete(t),!1));var S=s(2162);class N{resolveSearchQuery(e){let t=new Set;for(let s of this.data.nodes.threadNodes)this.resolve(s,e,t);return t}resolve(e,t,s){for(let n of(!s.has(e.id)&&this.nodeMatchesQuery(t,e)&&(s.add(e.id),this.addAllChildren(e,s),this.addAllParents(e,s)),e.children))this.resolve(n,t,s)}addAllChildren(e,t){for(let s of e.children)t.add(e.id),this.addAllChildren(s,t)}addAllParents(e,t){for(let s of this.data.bottomUp.getParents(e.id))t.add(s)}nodeMatchesQuery(e,t){if((0,S.fX)(t))return t.name.toLowerCase().includes(e);{let s=this.data.sources.getSource(t.id);return t.className.toLowerCase().includes(e)||t.methodName.toLowerCase().includes(e)||s&&s.toLowerCase().includes(e)}}constructor(e){this.data=e}}var k=s(2701),T=function(e){return e[e.KEEP_LISTENING=0]="KEEP_LISTENING",e[e.STOP_LISTENING=1]="STOP_LISTENING",e}({});class C{register(e){return this.listeners.push(e),()=>this.unregister(e)}unregister(e){let t=this.listeners.indexOf(e);t>=0&&this.listeners.splice(t,1)}dispatch(e){let t=[];this.listeners.forEach((s,n)=>{s(e)===T.STOP_LISTENING&&t.unshift(n)}),t.forEach(e=>this.listeners.splice(e,1))}constructor(){this.listeners=[]}}var _=s(3270),M=s.n(_),I=s(5436);class A{async run(){this.socket.eventBus.register(this.onMessage.bind(this)),await this.sendClientConnect()}async sendClientConnect(){let{browser:e,os:t}=M().parse(window.navigator.userAgent),s={clientId:this.clientId,description:"".concat(e.name," on ").concat(t.name)};await this.socket.send({oneofKind:"clientConnect",clientConnect:s})}constructor(e,t){this.onMessage=e=>{if("serverConnectResponse"!==e.oneofKind)return T.KEEP_LISTENING;let t=e.serverConnectResponse;if(t.clientId!==this.clientId)return T.KEEP_LISTENING;if(t.state===I.zr.ACCEPTED||t.state===I.zr.UNTRUSTED){let e=t.state===I.zr.ACCEPTED;return console.log("[WS] Established connection with server (".concat(e?"trusted":"untrusted",")")),this.socket.startKeepalive(this.listener.onPing).then(e=>{}),this.listener.onConnect(this.socket,t.settings,e,this.clientId,t.lastPayloadId),e?T.STOP_LISTENING:T.KEEP_LISTENING}if(t.state===I.zr.REJECTED)return console.log("[WS] Rejected by server, disconnecting."),this.socket.socket.close(),T.STOP_LISTENING;throw Error("unknown state: ".concat(t.state))},this.socket=e,this.listener=t,this.clientId="".concat(F(4),"-").concat(F(4))}}function F(e){let t=new Uint8Array((e||40)/2);return crypto.getRandomValues(t),Array.from(t,function(e){return e.toString(16).padStart(2,"0")}).join("")}var L=s(943),E=s(6823);async function P(){let e=(0,E.get)("viewer-public-key"),t=(0,E.get)("viewer-private-key");if(e&&t){var s,n;return{publicKey:await (s=(0,L.D)(e),V("spki",s,[])),privateKey:await (n=(0,L.D)(t),V("pkcs8",n,["sign"]))}}}async function D(){let{publicKey:e,privateKey:t}=await crypto.subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:2048,publicExponent:new Uint8Array([1,0,1]),hash:"SHA-256"},!0,["sign"]),s=await crypto.subtle.exportKey("spki",e);(0,E.set)("viewer-public-key",(0,L.l)(s));let n=await crypto.subtle.exportKey("pkcs8",t);return(0,E.set)("viewer-private-key",(0,L.l)(n)),{publicKey:e,privateKey:t}}function V(e,t,s){return crypto.subtle.importKey(e,t,{name:"RSASSA-PKCS1-v1_5",hash:"SHA-256"},!0,s)}var R=s(5583);class B{static async connect(e,t,n){console.log("[WS] Creating remote socket client");let r=new Worker(s.tu(new URL(s.p+s.u(614),s.b))),a=(0,R.LV)(r);return new B(await new a(e,t,(0,R.BX)({onclose:(0,R.BX)(n.onclose),onerror:(0,R.BX)(n.onerror),onmessage:(0,R.BX)(n.onmessage),onopen:(0,R.BX)(n.onopen)})))}async send(e){await this.proxy.send((0,R.k0)(e,[e.buffer]))}async startKeepalive(e){await this.proxy.startKeepalive((0,R.BX)(e))}async close(){await this.proxy.close(),this.proxy[R.A2]()}constructor(e){this.proxy=e}}class O{static async connect(e,t){let s=await P()||await D(),n=await V("spki",e.publicKey,["verify"]);console.log("[WS] Loaded viewer keys and decoded remote public key");let r=new O,a=await B.connect(e.channelId,{remotePublicKey:n,localPublicKey:s.publicKey,localPrivateKey:s.privateKey},{onclose:()=>{t.onClose()},onopen:()=>{console.log("[WS] Socket open, initialising connection..."),new A(r,t).run()},onmessage:e=>{r.onReceive(e)},onerror:()=>{}});r.setSocket(a)}setSocket(e){this.socket=e}async startKeepalive(e){await this.socket.startKeepalive(e)}async send(e){await this.socket.send(I.A1.toBinary({packet:e}))}async onReceive(e){this.eventBus.dispatch(I.A1.fromBinary(e).packet)}constructor(){this.eventBus=new C}}class K{getId(){return this.node.id}getDetails(){return(0,S.fX)(this.node)?{type:"thread",name:this.node.name}:{type:"stackTrace",className:this.node.className,methodName:this.node.methodName,parentLineNumber:this.node.parentLineNumber,lineNumber:this.node.lineNumber,methodDesc:this.node.methodDesc}}getTime(){return this.node.time}getTimes(){return this.node.times}getChildren(){return void 0===this.children&&(this.children=this.node.children.map(e=>new K(this.data,e,this))),this.children}getParents(){return this.parent?[this.parent]:[]}getSource(){return this.data.sources.getSource(this.node.id)}constructor(e,t,s){this.data=e,this.node=t,this.parent=s}}class W{static async create(e){let t=new Worker(s.tu(new URL(s.p+s.u(467),s.b))),n=(0,R.LV)(t),r={threads:e.threads,sources:e.sources};return new W(await new n(r))}generateFlatView(){return this.proxy.generateFlatView()}generateSourcesView(){return this.proxy.generateSourcesView()}close(){this.proxy[R.A2]()}constructor(e){this.proxy=e}}var z=s(1630),U=s.n(z),G=s(5573),X=s(7328),q=s.n(X),Q=s(3213),Y=s(2779);function $(e){let{metadata:t}=e,{user:s,startTime:r,interval:a,dataAggregator:i}=t,o=t.comment?'"'+t.comment+'"':"",[l,c]=(0,Y.F5)(r),d="";i&&i.type===I.zy.TICKED&&(d=", ticks >= "+i.tickLengthThreshold/1e3+"ms");let u=t.samplerMode===I.gi.ALLOCATION,m=u?(0,Y.DL)(a):"".concat(a/1e3,"ms");return(0,n.jsxs)("div",{className:"textbox title",children:[(0,n.jsx)(q(),{children:(0,n.jsxs)("title",{children:[u?"Memory Profile":"Profile"," @ ",l," ",c," | spark"]})}),(0,n.jsxs)("span",{children:[o,(0,n.jsx)(Q.A,{user:s,platform:t.platform}),null==s?void 0:s.name," @ ",l," ",c,", interval"," ",m,d]})]})}var J=s(5039),H=s.n(J),Z=s(1995);function ee(e){var t,s;let{socket:r,showSocketInfo:a,setShowSocketInfo:i}=e;return r.socket.socket?(0,n.jsx)(n.Fragment,{children:(0,n.jsx)("div",{className:H()("last-update-spinner button textbox",{toggled:a}),onClick:function(e){i(e=>!e)},children:(0,n.jsx)(Z.F,{isPlaying:!0,size:26,strokeWidth:4,duration:null!=(s=null==(t=r.socket.settings)?void 0:t.samplerInterval)?s:60,colors:"#b5b5b5",trailColor:"#3c3f41",children:()=>{var e,t;return(0,n.jsx)(Z.F,{isPlaying:!0,size:16,strokeWidth:4,duration:null!=(t=null==(e=r.socket.settings)?void 0:e.statisticsInterval)?t:10,colors:"#b5b5b5",trailColor:"#3c3f41"},r.lastStatsUpdate)}},r.lastSamplerUpdate)})}):null}function et(e){let{searchQuery:t}=e;return(0,n.jsx)("input",{className:"searchbar",type:"text",value:t.value,onChange:function(e){t.setValue(e.target.value.toLowerCase())}})}var es=s(2318);function en(e){let{showSettings:t,setShowSettings:s}=e;return(0,n.jsx)(es.A,{icon:d._$s,onClick:function(){s(e=>!e)},title:"Click to show the settings menu",extraClassName:t?"toggled":void 0})}function er(e){let{data:t,metadata:s,metadataToggle:r,exportCallback:a,showSettings:i,setShowSettings:o,view:l,setView:c,sourcesViewSupported:d,graphSupported:u,showGraph:m,setShowGraph:p,socket:h,showSocketInfo:f,setShowSocketInfo:g,flameData:v,setFlameData:x,searchQuery:w}=e;return(0,n.jsxs)("div",{className:U().controls,children:[(0,n.jsx)($,{metadata:s}),(0,n.jsx)(en,{showSettings:i,setShowSettings:o}),(0,n.jsx)(G.A,{exportCallback:a}),(0,n.jsx)(et,{searchQuery:w}),(0,n.jsx)(ee,{socket:h,showSocketInfo:f,setShowSocketInfo:g})]})}var ea=s(8341),ei=s(1332),eo=s(550),el=s.n(eo);function ec(e){let{flameData:t,mappings:s,metadata:r,timeSelector:a}=e,{t:o}=(0,ea.o)(),l=(0,i.useRef)(null),c=(0,i.useRef)(null),[d,u]=(0,i.useState)(null),[m,p]=(0,i.useState)({width:0,height:0}),[h,f]=(0,i.useState)(0),g=r.samplerMode===I.gi.ALLOCATION,v=a.getTime,x=()=>{let e=0,n=(t,r,a)=>{e=Math.max(e,r);let i=t.getDetails(),o="";if("thread"===i.type)o=i.name;else if("stackTrace"===i.type){let e=s.resolve(i);if("native"===e.type)o=i.methodName+" (native)";else{let{className:t,methodName:s}=e;o="".concat(t,".").concat(s,"()")}}let l=v(t),c=a>0?l/a*100:0;return{name:o,value:l,children:t.getChildren().sort((e,t)=>v(t)-v(e)).map(e=>n(e,r+1,a)),x:0,y:0,width:0,depth:r,percentage:c}},r=v(t);return f(r),{root:n(t,0,r),maxDepth:e}},w=(e,t)=>{let s=(e,t,n,r)=>{e.x=t,e.y=r,e.width=n;let a=t,i=e.children.reduce((e,t)=>e+t.value,0);e.children.forEach(e=>{let t=i>0?e.value/i*n:0;t>=.5&&(s(e,a,t,r+24),a+=t)})};s(e,0,t,0)},j=()=>{let e=l.current,t=c.current;if(!e||!t)return;let s=e.getContext("2d");if(!s)return;let{root:n,maxDepth:r}=x(),a=t.clientWidth,i=(r+1)*24;if(0===a||0===i)return;let o=window.devicePixelRatio||1;e.width=a*o,e.height=i*o,e.style.width="".concat(a,"px"),e.style.height="".concat(i,"px"),s.scale(o,o),p({width:a,height:i}),w(n,a),s.clearRect(0,0,a,i);let d=e=>{if(!(e.width<.5)){if(s.fillStyle=(e=>{let t=Math.max(0,Math.min(100,e));if(t<1)return"#7eb3d5";if(t<5)return"#5cb85c";if(t<15)return"#8bc34a";if(t<30)return"#ffc107";if(t<50)return"#ff9800";else if(t<75)return"#ff5722";else return"#f44336"})(e.percentage),s.fillRect(e.x,e.y,e.width,22),s.strokeStyle="#1a1d1f",s.lineWidth=1,s.strokeRect(e.x,e.y,e.width,22),e.width>30){s.fillStyle="#000",s.font='12px "JetBrains Mono", monospace',s.textBaseline="middle";let t=e.name,n=s.measureText(t).width,r=e.width-8;if(n<=r)s.fillText(t,e.x+4,e.y+11);else{let n=t;for(;s.measureText(n+"...").width>r&&n.length>0;)n=n.slice(0,-1);s.fillText(n+"...",e.x+4,e.y+11)}}e.children.forEach(d)}};d(n)};return(0,i.useEffect)(()=>{requestAnimationFrame(()=>{j()});let e=()=>{j()},t=new ResizeObserver(()=>{requestAnimationFrame(()=>{j()})}),s=new MutationObserver(e=>{e.forEach(e=>{"attributes"===e.type&&"class"===e.attributeName&&setTimeout(()=>{let e=c.current;e&&null!==e.offsetParent&&j()},100)})});if(c.current){t.observe(c.current);let e=c.current.parentElement;e&&s.observe(e,{attributes:!0,attributeFilter:["class"]})}return window.addEventListener("resize",e),()=>{window.removeEventListener("resize",e),t.disconnect(),s.disconnect()}},[t,s,r,a]),(0,n.jsx)(ei.A,{className:"flame",title:o("viewer.flame.title")||"Flame Graph",children:(0,n.jsxs)("div",{ref:c,className:el().container,children:[(0,n.jsx)("canvas",{ref:l,className:el().canvas,onMouseMove:e=>{let t=l.current;if(!t)return;let s=t.getBoundingClientRect(),n=e.clientX-s.left,r=e.clientY-s.top,{root:a}=x();w(a,m.width);let i=e=>{if(n>=e.x&&n<=e.x+e.width&&r>=e.y&&r<=e.y+24-2)return e;for(let t of e.children){let e=i(t);if(e)return e}return null},o=i(a);if(o){let t=g?(0,Y.DL)(o.value):"".concat(o.value,"ms"),s="".concat(o.percentage.toFixed(2),"%");u({x:e.clientX,y:e.clientY,text:"".concat(o.name,"\n").concat(t," (").concat(s,")")})}else u(null)},onMouseLeave:()=>{u(null)}}),d&&(0,n.jsx)("div",{className:el().tooltip,style:{left:d.x+10,top:d.y+10},children:d.text.split("\n").map((e,t)=>(0,n.jsx)("div",{children:e},t))})]})})}function ed(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:20,s=e.nodes.stackTraceNodes,n=e.threads.reduce((e,t)=>e+t.time,0);return s.filter(e=>e.time>0).map(t=>{let s=new K(e,t),r=s.getDetails(),a=t.children.reduce((e,t)=>e+t.time,0),i=t.time-a,o="stackTrace"===r.type&&r.className&&r.methodName?"".concat(r.className,".").concat(r.methodName):"stackTrace"===r.type?r.className||r.methodName||"Unknown":r.name||"Unknown";return{node:s,time:t.time,selfTime:i,percentage:n>0?i/n*100:0,name:o,className:"stackTrace"===r.type?r.className:void 0,methodName:"stackTrace"===r.type?r.methodName:void 0,source:e.sources.getSource(t.id)}}).filter(e=>e.selfTime>0).sort((e,t)=>t.selfTime-e.selfTime).slice(0,t)}function eu(e){let{data:t,highlighted:s}=e,{t:r}=(0,ea.o)(),a=(0,i.useMemo)(()=>{var e,s;let n=ed(t,1),a=n.length>0?n[0]:null,i="good",o=20,l=0,c=Object.values(t.timeWindowStatistics);c.length>0?(l=c.reduce((e,t)=>e+t.msptMedian,0)/c.length,o=c.reduce((e,t)=>Math.min(e,t.tps),20)):(null==(s=t.metadata)||null==(e=s.platformStatistics)?void 0:e.tps)&&(o=t.metadata.platformStatistics.tps.last1M),o<10||l>100?i="severe":(o<18||l>50)&&(i="lagging");let d="",u=null==a?void 0:a.source,m=null;if(!u&&a){let e=a.node.getId();if("number"==typeof e){let s=t.nodes.getNode(e),n=0;for(;s&&n<500;){let e=t.nodes.getParent(s.id);if(!e)break;let r=t.sources.getSource(e.id);if(r){u=r,m=new K(t,e);break}s=e,n++}}}let p=u||r("viewer.intelligentAnalyzer.unknownSource");return!u&&((null==a?void 0:a.name.startsWith("net.minecraft"))||(null==a?void 0:a.name.startsWith("java")))&&(p="Minecraft / Java"),d="good"===i?r("viewer.intelligentAnalyzer.status.good"):"minecraft"===p||"java"===p||"Minecraft / Java"===p?r("viewer.intelligentAnalyzer.vanillaIssue"):u?r("viewer.intelligentAnalyzer.checkMod").replace("{source}",p):r("viewer.intelligentAnalyzer.generatedInsights")+" "+((null==a?void 0:a.name)||"Unknown"),{status:i,topFunction:a,sourceName:p,analysisText:d,relatedNode:m}},[t,r]),o={good:"#4caf50",lagging:"#ff9800",severe:"#f44336"}[a.status],l={good:d.SGM,lagging:d.zpE,severe:d.zm_}[a.status];return(0,n.jsx)(ei.A,{title:(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,n.jsx)(u.g,{icon:d.YSV}),r("viewer.intelligentAnalyzer.title")]}),children:(0,n.jsxs)("div",{style:{display:"flex",gap:"20px",flexWrap:"wrap"},children:[(0,n.jsxs)("div",{style:{flex:1,minWidth:"200px",backgroundColor:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"8px"},children:[(0,n.jsx)("div",{style:{fontSize:"0.9em",color:"#aaa",marginBottom:"5px"},children:r("viewer.intelligentAnalyzer.serverStatus")}),(0,n.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px",fontSize:"1.2em",fontWeight:"bold",color:o},children:[(0,n.jsx)(u.g,{icon:l}),r("viewer.intelligentAnalyzer.status.".concat(a.status))]}),(0,n.jsx)("div",{style:{marginTop:"10px",fontSize:"0.9em"},children:a.analysisText})]}),a.topFunction&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{style:{flex:1,minWidth:"200px",backgroundColor:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"8px",cursor:"pointer"},onClick:()=>{if(a.topFunction){s.replace(a.topFunction.node);let e=a.topFunction.node.getId(),t="node-".concat(Array.isArray(e)?e.join("-"):String(e)),n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,s=document.getElementById(t);s?s.scrollIntoView({behavior:"smooth",block:"center"}):e<8&&setTimeout(()=>n(e+1),100)};setTimeout(()=>n(),50)}},children:[(0,n.jsx)("div",{style:{fontSize:"0.9em",color:"#aaa",marginBottom:"5px"},children:r("viewer.intelligentAnalyzer.topHotspot")}),(0,n.jsx)("div",{style:{fontSize:"1.1em",fontWeight:"bold",wordBreak:"break-all"},children:a.topFunction.name}),a.relatedNode&&(0,n.jsxs)("div",{style:{fontSize:"0.85em",color:"#999",marginTop:"4px",wordBreak:"break-all"},children:["↳ ",a.sourceName,": ",(()=>{let e=a.relatedNode.getDetails();return"stackTrace"===e.type?"".concat(e.className,".").concat(e.methodName):e.name})()]}),(0,n.jsxs)("div",{style:{color:"#ffc107",marginTop:"5px"},children:[(0,Y.fU)(a.topFunction.selfTime)," ms (",a.topFunction.percentage.toFixed(2),"%)"]})]}),(0,n.jsxs)("div",{style:{flex:1,minWidth:"200px",backgroundColor:"rgba(255,255,255,0.05)",padding:"15px",borderRadius:"8px"},children:[(0,n.jsx)("div",{style:{fontSize:"0.9em",color:"#aaa",marginBottom:"5px"},children:r("viewer.intelligentAnalyzer.associatedSource")}),(0,n.jsx)("div",{style:{fontSize:"1.2em",fontWeight:"bold"},children:a.sourceName}),"Minecraft / Java"!==a.sourceName&&!["minecraft","java"].includes(a.sourceName)&&a.topFunction.source&&(0,n.jsx)("div",{style:{fontSize:"0.8em",color:"#aaa",marginTop:"5px"},children:r("viewer.sourceModal.suggestionsTitle")})]})]})]})})}function em(e){let{isConnectedToSocket:t}=e;return(0,n.jsxs)(m.A,{extraClassName:c()["no-data"],children:[(0,n.jsxs)("h2",{children:[(0,n.jsx)(u.g,{icon:d.QJT})," ",(0,n.jsx)("b",{children:"No Data"})]}),t?(0,n.jsx)("p",{children:"This profile doesn't contain any data yet! The viewer will refresh shortly."}):(0,n.jsx)("p",{children:"This profile doesn't contain any data!"})]})}function ep(e){var t;let{socket:s}=e,{clientId:r,settings:a,latency:i}=s.socket;return(0,n.jsxs)(m.A,{extraClassName:c()["socket-info"],children:[(0,n.jsxs)("h2",{children:[(0,n.jsx)(u.g,{icon:d.jBL,color:"#89d753"})," ",(0,n.jsx)("b",{children:"Connected"})," via WebSocket"]}),(0,n.jsxs)("p",{children:["spark viewer is connected to the spark profiler using a socket connection. ",(0,n.jsx)("br",{}),"The statistics will update every"," ",null!=(t=null==a?void 0:a.statisticsInterval)?t:"?"," seconds, and the profiler data will update every minute."]}),(0,n.jsxs)("p",{children:[(0,n.jsx)("b",{children:"Latency"}),": ",null!=i?i:"?","ms",(0,n.jsx)("br",{}),(0,n.jsx)("b",{children:"Client ID"}),": ",r]})]})}let eh=(0,i.createContext)(void 0),ef=(0,i.createContext)(void 0),eg=(0,i.createContext)(void 0),ev=(0,i.createContext)(void 0),ex=(0,i.createContext)(void 0),ew=(0,i.createContext)(!1),ej=(0,i.createContext)(void 0);function ey(e){let{mappings:t,infoPoints:s,highlighted:r,searchQuery:a,labelMode:i,metadata:o,timeSelector:l,children:c}=e;return(0,n.jsx)(eh.Provider,{value:t,children:(0,n.jsx)(ef.Provider,{value:s,children:(0,n.jsx)(eg.Provider,{value:r,children:(0,n.jsx)(ev.Provider,{value:a,children:(0,n.jsx)(ew.Provider,{value:i,children:(0,n.jsx)(ex.Provider,{value:o,children:(0,n.jsx)(ej.Provider,{value:l,children:c})})})})})})})}class eb{addNode(e){let t=eb.keyForNode(e),s=this.map.get(t);void 0===s&&(s=[],this.map.set(t,s)),s.push(e)}build(){return Array.from(this.map.values())}static keyForNode(e){return"".concat(e.className,"\0").concat(e.methodName,"\0").concat(e.methodDesc)}constructor(){this.map=new Map}}class eS{getId(){return 1==this.nodes.length?this.nodes[0].id:this.nodes.map(e=>e.id)}getDetails(){let e=this.nodes[0];return(0,S.fX)(e)?{type:"thread",name:e.name}:{type:"stackTrace",className:e.className,methodName:e.methodName,parentLineNumber:e.parentLineNumber,lineNumber:e.lineNumber,methodDesc:e.methodDesc}}getTime(){return this.nodes.reduce((e,t)=>e+t.time,0)}getTimes(){if(1===this.nodes.length)return this.nodes[0].times;let e=this.nodes[0].times.length;return this.nodes.reduce((t,s)=>{for(let n=0;n<e;n++)t[n]=t[n]+s.times[n];return t},Array(e).fill(0))}getChildren(){if(1==this.nodes.length)return this.nodes[0].children.map(e=>new eS(this.data,[e]));let e=new eb;return this.nodes.flatMap(e=>e.children).forEach(t=>e.addNode(t)),e.build().map(e=>new eS(this.data,e))}getParents(){let e=new eb,t=[];return this.nodes.map(e=>this.data.bottomUp.getParent(e.id)).filter(e=>void 0!==e).map(e=>this.data.nodes.getNode(e)).forEach(s=>{(0,S.fX)(s)?t.push(s):e.addNode(s)}),[...t.map(e=>new K(this.data,e)),...e.build().map(e=>new eS(this.data,e))]}getSource(){for(let e of this.nodes){let t=this.data.sources.getSource(e.id);if(t)return t}}constructor(e,t){if(this.data=e,this.nodes=t,0===t.length)throw Error("nodes length is 0")}}class eN{getId(){return this.node.id}getDetails(){return{type:"thread",name:this.node.name}}getTime(){return this.node.threadTime}getTimes(){return this.node.threadTimes}getChildren(){return void 0===this.children&&(this.children=this.node.children.map(e=>new eS(this.data,e.map(e=>this.data.nodes.getNode(e))))),this.children}getParents(){return[]}getSource(){return this.data.sources.getSource(this.node.id)}getSourceTime(){return this.node.sourceTime}constructor(e,t){this.data=e,this.node=t}}class ek{getId(){return this.node.id}getDetails(){return{type:"thread",name:this.node.name}}getTime(){return this.node.time}getTimes(){return this.node.times}getChildren(){return void 0===this.children&&(this.children=this.node.children.map(e=>new eS(this.data,e.map(e=>this.data.nodes.getNode(e))))),this.children}getParents(){return[]}getSource(){return this.data.sources.getSource(this.node.id)}constructor(e,t){this.data=e,this.node=t}}function eT(e){let{value:t,setValue:s,title:r,labelTrue:a,labelFalse:i,descriptionTrue:o,descriptionFalse:l}=e;return(0,n.jsx)("div",{className:"button",children:(0,n.jsxs)("button",{onClick:function(){s(!t)},title:t?o:l,children:[(0,n.jsx)(u.g,{icon:d.Ubc})," ",(0,n.jsxs)("span",{children:[r,":"]})," ",t?a:i]})})}function eC(e){let{bottomUp:t,setBottomUp:s}=e,{t:r}=(0,ea.o)();return(0,n.jsx)(eT,{value:t,setValue:s,title:r("viewer.sampler.buttons.display"),labelTrue:r("viewer.sampler.displayMode.bottomUp"),labelFalse:r("viewer.sampler.displayMode.topDown"),descriptionTrue:r("viewer.sampler.displayMode.bottomUpDescription"),descriptionFalse:r("viewer.sampler.displayMode.topDownDescription")})}function e_(e){let{labelMode:t,setLabelMode:s}=e,{t:r}=(0,ea.o)(),a=(0,i.useContext)(ex);return a.numberOfTicks?a.samplerMode===I.gi.ALLOCATION?(0,n.jsx)(eT,{value:t,setValue:s,title:r("viewer.sampler.buttons.label"),labelTrue:r("viewer.sampler.buttons.bytesPerSecond"),labelFalse:r("viewer.sampler.labelMode.percentage"),descriptionTrue:r("viewer.sampler.buttons.bytesPerSecondDescription"),descriptionFalse:r("viewer.sampler.buttons.percentageAllocationDescription")}):(0,n.jsx)(eT,{value:t,setValue:s,title:r("viewer.sampler.buttons.label"),labelTrue:r("viewer.sampler.buttons.timePerTick"),labelFalse:r("viewer.sampler.labelMode.percentage"),descriptionTrue:r("viewer.sampler.buttons.timePerTickDescription"),descriptionFalse:r("viewer.sampler.labelMode.percentageDescription")}):null}function eM(e){let{selfTimeMode:t,setSelfTimeMode:s}=e,{t:r}=(0,ea.o)();return(0,i.useContext)(ex).samplerMode===I.gi.ALLOCATION?(0,n.jsx)(eT,{value:t,setValue:s,title:r("viewer.sampler.buttons.sortMode"),labelTrue:r("viewer.sampler.buttons.selfBytesAllocated"),labelFalse:r("viewer.sampler.buttons.totalBytesAllocated"),descriptionTrue:r("viewer.sampler.buttons.selfBytesDescription"),descriptionFalse:r("viewer.sampler.buttons.totalBytesDescription")}):(0,n.jsx)(eT,{value:t,setValue:s,title:r("viewer.sampler.buttons.sortMode"),labelTrue:r("viewer.sampler.sortMode.selfTime"),labelFalse:r("viewer.sampler.sortMode.totalTime"),descriptionTrue:r("viewer.sampler.sortMode.selfTimeDescription"),descriptionFalse:r("viewer.sampler.sortMode.totalTimeDescription")})}function eI(e){let{children:t}=e,{t:s}=(0,ea.o)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h3",{children:s("viewer.flatView.title")}),(0,n.jsx)("div",{className:"header-controls",children:t})]})}function eA(e){let{onClick:t}=e,{t:s}=(0,ea.o)();return(0,n.jsx)("div",{className:"button top-functions-button",children:(0,n.jsxs)("button",{onClick:t,"aria-label":s("viewer.sampler.topFunctions.button"),children:[(0,n.jsx)(u.g,{icon:d.Tsj})," ",(0,n.jsx)("span",{children:s("viewer.sampler.topFunctions.button")})]})})}var eF=s(5278),eL=s.n(eF);function eE(e){let{topFunctions:t,isOpen:s,onClose:r,onFunctionClick:a,data:o}=e,{t:l}=(0,ea.o)(),c=(0,i.useContext)(eg),m=(0,i.useContext)(ex),[p,h]=(0,i.useState)({}),f=(0,i.useMemo)(()=>new Map,[]),g=(0,i.useCallback)(e=>{if(!o)return e;let t=Array.isArray(e.getId())?e.getId().join("-"):String(e.getId()),s=o.threads.map(e=>new K(o,e)),n=new Set,r=[...s];for(;r.length;){let e=r.shift(),s=Array.isArray(e.getId())?e.getId().join("-"):String(e.getId());if(!n.has(s)){if(n.add(s),s===t)return e;for(let t of e.getChildren())r.push(t);for(let t of e.getParents())r.push(t)}}return e},[o]);(0,i.useCallback)(function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:3,s=new Map,n=new Set,r=[e];for(;r.length;){let e=r.shift(),t=Array.isArray(e.getId())?e.getId().join("-"):String(e.getId());if(n.has(t))continue;n.add(t);let a=e.getSource();if(a){let t=s.get(a)||0;s.set(a,t+("function"==typeof e.getTime?e.getTime():0))}for(let t of e.getParents()){let e=Array.isArray(t.getId())?t.getId().join("-"):String(t.getId());n.has(e)||r.push(t)}for(let t of e.getChildren()){let e=Array.isArray(t.getId())?t.getId().join("-"):String(t.getId());n.has(e)||r.push(t)}}let a=e.getSource&&e.getSource();a&&s.delete(a);let i=Array.from(s.entries()).sort((e,t)=>t[1]-e[1]).slice(0,t).map(e=>{let[t,s]=e;return{key:t,total:s}}),o=i.reduce((e,t)=>e+t.total,0);return i.map(e=>{var t;return{key:e.key,total:e.total,percent:o>0?e.total/o:0,md:null==(t=m.sources)?void 0:t[e.key]}})},[m]);let[x,w]=(0,i.useState)(()=>t.map(()=>[])),j=(0,i.useCallback)(e=>{var t,s,n;let r=e.getSource&&e.getSource();if(r)return[{key:r,total:"function"==typeof e.getTime?e.getTime():0,percent:1,md:null==(t=m.sources)?void 0:t[r]}];for(let t of e.getChildren()){let e=t.getSource&&t.getSource();if(e)return[{key:e,total:"function"==typeof t.getTime?t.getTime():0,percent:1,md:null==(s=m.sources)?void 0:s[e]}]}for(let t of e.getParents()){let e=t.getSource&&t.getSource();if(e)return[{key:e,total:"function"==typeof t.getTime?t.getTime():0,percent:1,md:null==(n=m.sources)?void 0:n[e]}]}return[]},[m]);return((0,i.useEffect)(()=>{if(!s)return;w(t.map(e=>j(g(e.node))));let e=setTimeout(()=>{let e=t.map(()=>[]);for(let s=0;s<t.length;s++){let n=g(t[s].node),r=Array.isArray(n.getId())?n.getId().join("-"):String(n.getId());if(f.has(r)){e[s]=f.get(r);continue}let a=new Map,i=new Set,o=[n],l=0;for(;o.length&&l<2e3;){let e=o.shift();l++;let t=Array.isArray(e.getId())?e.getId().join("-"):String(e.getId());if(i.has(t))continue;i.add(t);let s=e.getSource&&e.getSource();for(let t of(s&&a.set(s,(a.get(s)||0)+("function"==typeof e.getTime?e.getTime():0)),e.getParents()))o.push(t);for(let t of e.getChildren())o.push(t)}let c=n.getSource&&n.getSource();c&&a.delete(c);let d=Array.from(a.entries()).sort((e,t)=>t[1]-e[1]).slice(0,8).map(e=>{let[t,s]=e;return{key:t,total:s}}),u=d.reduce((e,t)=>e+t.total,0),p=d.map(e=>{var t;return{key:e.key,total:e.total,percent:u>0?e.total/u:0,md:null==(t=m.sources)?void 0:t[e.key]}});e[s]=p,f.set(r,p)}w(e)},10);return()=>clearTimeout(e)},[s,t,g,j,m,f]),s)?(0,n.jsx)("div",{className:eL().backdrop,onClick:function(e){e.target===e.currentTarget&&r()},children:(0,n.jsxs)("div",{className:eL().modal,children:[(0,n.jsxs)("div",{className:eL().header,children:[(0,n.jsx)("h2",{children:l("viewer.sampler.topFunctions.title")}),(0,n.jsx)("button",{className:eL().closeButton,onClick:r,"aria-label":"Close",children:(0,n.jsx)(u.g,{icon:d.GRI})})]}),(0,n.jsx)("div",{className:eL().content,children:(0,n.jsx)("div",{className:eL().functionList,children:t.map((e,t)=>{var s;return(0,n.jsxs)("div",{className:eL().functionItem,onClick:()=>{c.replaceSilently?c.replaceSilently(e.node):c.replace(e.node),a(e),r()},children:[(0,n.jsx)("div",{className:eL().rank,children:t+1}),(0,n.jsxs)("div",{className:eL().functionInfo,children:[(0,n.jsx)("div",{className:eL().functionName,children:e.name}),(()=>{var s,r;let a=x[t]&&x[t][0],i=null!=(r=null==a?void 0:a.key)?r:e.node.getSource(),o=i&&m?null==(s=m.sources)?void 0:s[i]:void 0;return o?(0,n.jsxs)("div",{className:eL().functionMeta,children:[o.name,o.version?" "+o.version:""]}):i?(0,n.jsx)("div",{className:eL().functionMeta,children:i}):null})(),(0,n.jsx)("div",{className:eL().functionStats,children:(()=>{let t=e.percentage,s=eL().pctLow;return t>90?s=eL().pctHigh:t>70&&(s=eL().pctMed),(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("span",{className:"".concat(eL().time," ").concat(s),children:[e.selfTime.toFixed(0)," ms"]}),(0,n.jsxs)("span",{className:"".concat(eL().percentage," ").concat(s),children:[e.percentage.toFixed(2),"%"]})]})})()}),(0,n.jsxs)("div",{className:eL().sourceList,onClick:e=>e.stopPropagation(),children:[x[t]&&x[t].length>0&&(0,n.jsxs)("div",{className:eL().sourceItem,children:[(0,n.jsx)("div",{className:eL().sourceName,children:(null==(s=x[t][0].md)?void 0:s.name)?"".concat(x[t][0].md.name).concat(x[t][0].md.version?" "+x[t][0].md.version:""):x[t][0].key}),(0,n.jsxs)("div",{className:eL().sourceStats,children:[(0,Y.fU)(x[t][0].total),"ms • ",(0,Y.XL)(x[t][0].percent)]})]}),x[t]&&x[t].length>1&&(0,n.jsx)("div",{className:eL().expandRow,children:(0,n.jsx)("button",{className:eL().expandButton,onClick:()=>h(e=>(0,k._)((0,v._)({},e),{[t]:!e[t]})),"aria-expanded":!!p[t],children:p[t]?l("viewer.sampler.topFunctions.collapse"):"".concat(l("viewer.sampler.topFunctions.more")," (+").concat(x[t].length-1,")")})}),p[t]&&x[t].slice(1).map((e,t)=>{var s;return(0,n.jsxs)("div",{className:eL().sourceItem,children:[(0,n.jsx)("div",{className:eL().sourceName,children:(null==(s=e.md)?void 0:s.name)?"".concat(e.md.name).concat(e.md.version?" "+e.md.version:""):e.key}),(0,n.jsxs)("div",{className:eL().sourceStats,children:[(0,Y.fU)(e.total),"ms • ",(0,Y.XL)(e.percent)]})]},t)})]})]})]},t)})})})]})}):null}let eP="flat";function eD(e){let{metadata:t,view:s,setView:r,sourcesViewSupported:a}=e,{t:i}=(0,ea.o)(),o=["all",eP,...a?["sources"]:[]];return(0,n.jsx)("div",{className:"view-switcher",children:o.map(e=>{let a,o;if("all"===e)a=i("viewer.allView.title"),o=i("viewer.allView.description");else if(e===eP)a=i("viewer.flatView.title"),o=i("viewer.flatView.description");else{var l;let e=["Fabric","Forge","NeoForge"].includes((null==t||null==(l=t.platform)?void 0:l.name)||"");a=e?i("viewer.sourcesView.modsTitle"):i("viewer.sourcesView.pluginsTitle"),o=e?i("viewer.sourcesView.modsDescription"):i("viewer.sourcesView.pluginsDescription")}let c=s===e;return(0,n.jsx)("div",{className:"button",children:(0,n.jsxs)("button",{onClick:()=>r(e),title:o,style:c?{borderColor:"#ffc93a",background:"#38414a",color:"#fff"}:{},children:[(0,n.jsx)(u.g,{icon:d.pS3,style:c?{color:"#ffc93a"}:{}})," ",(0,n.jsx)("span",{style:c?{color:"#ffc93a"}:{},children:a})]})},e)})})}let eV=(0,i.createContext)(!1);function eR(e){let{data:t,viewData:s,setLabelMode:r,view:a,setView:o,sourcesViewSupported:l,metadata:c}=e,d=(0,i.useContext)(ew),[u,p]=(0,i.useState)(!1),[h,f]=(0,i.useState)(!1),[g,v]=(0,i.useState)(!1),[x,w]=(0,i.useState)([]),{t:j}=(0,ea.o)(),y=h?null==s?void 0:s.flatSelfTime:null==s?void 0:s.flatTotalTime;return(0,n.jsxs)(ei.A,{className:"flatview",title:j("viewer.functionList")||"Function List",children:[(0,n.jsxs)(eI,{children:[(0,n.jsx)(eA,{onClick:()=>{w(ed(t,20)),v(!0)}}),(0,n.jsx)("div",{style:{marginLeft:6}}),(0,n.jsx)(eD,{metadata:c,view:a,setView:o,sourcesViewSupported:l}),(0,n.jsx)(e_,{labelMode:d,setLabelMode:r}),(0,n.jsx)(eC,{bottomUp:u,setBottomUp:p}),(0,n.jsx)(eM,{selfTimeMode:h,setSelfTimeMode:f})]}),y?(0,n.jsx)("div",{className:"stack",children:(0,n.jsx)(eV.Provider,{value:u,children:y.map(e=>(0,n.jsx)(eq,{parents:[],node:new ek(t,e)},e.name))})}):(0,n.jsx)(m.A,{children:"Loading..."}),(0,n.jsx)(eE,{topFunctions:x,isOpen:g,onClose:()=>v(!1),onFunctionClick:e=>{let t=e.node.getId(),s="node-".concat(Array.isArray(t)?t.join("-"):String(t)),n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=document.getElementById(s);t?t.scrollIntoView({behavior:"smooth",block:"center"}):e<8&&setTimeout(()=>n(e+1),100)};setTimeout(()=>n(),50)},data:t})]})}function eB(e){let{node:t,parent:s}=e;if(!s)return null;let r=t.getDetails();if("stackTrace"!==r.type||!r.parentLineNumber)return null;let a=s.getDetails();if("stackTrace"!==a.type)return null;let i="Invoked on line "+r.parentLineNumber+" of "+a.className+"."+a.methodName+"()";return(0,n.jsxs)("span",{className:"lineNumber",title:i,children:[":",r.parentLineNumber]})}function eO(e){let{details:t,mappings:s}=e;switch(t.type){case"thread":return(0,n.jsx)(eK,{details:t,mappings:s});case"stackTrace":return(0,n.jsx)(eW,{details:t,mappings:s})}}let eK=e=>{let{details:t,mappings:s}=e;return(0,n.jsx)(n.Fragment,{children:t.name})},eW=e=>{let{details:t,mappings:s}=e,r=s.resolve(t);if("native"===r.type)return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{className:"native-part",children:t.methodName}),(0,n.jsx)("span",{className:"package-part",children:" (native)"})]});let{className:a,methodName:i,packageName:o,lambda:l,remappedClass:c,remappedMethod:d}=r;return(0,n.jsxs)(n.Fragment,{children:[!!o&&(0,n.jsx)("span",{className:"package-part",children:o}),c?(0,n.jsx)("span",{className:"class-part remapped",title:t.className,children:a}):(0,n.jsx)("span",{className:"class-part",children:a}),!!l&&(0,n.jsx)("span",{className:"lambda-part",children:l}),".",d?(0,n.jsx)("span",{className:"method-part remapped",title:t.methodName,children:i}):(0,n.jsx)("span",{className:"method-part",children:i}),"()"]})};function ez(e){var t,s;let r,{children:a,time:o,selfTime:l,threadTime:c,importance:d,significance:u,source:m,infoPoint:p,isSourceRoot:h}=e,f=(0,i.useContext)(ex);h&&(o=c-l);let g=(0,i.useContext)(ew),v=(0,i.useContext)(ej);function x(e){return f.samplerMode===I.gi.ALLOCATION?(0,Y.DL)(e):(0,Y.fU)(e)+"ms"}g&&(r=f.samplerMode===I.gi.ALLOCATION?o/((v.supported?v.getMillisInRange():f.endTime-f.startTime)/1e3):o/Math.max(v.supported?v.getTicksInRange():(null==(s=f.dataAggregator)?void 0:s.numberOfIncludedTicks)||f.numberOfTicks,1));let w=m?null==(t=f.sources)?void 0:t[m]:void 0;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("span",{className:"name",children:[a,(0,n.jsx)("span",{className:"percent",style:{filter:"hue-rotate(-".concat(25*d,"deg)")+" "+"saturate(".concat(1+13*d,")"),opacity:u<.01?.5+100*u/2:void 0},children:g?"".concat(x(r)):(0,Y.XL)(o/c)}),p,(0,n.jsxs)("span",{className:"time",children:[x(o),Math.floor(l)>0&&!h&&(0,n.jsxs)(n.Fragment,{children:[" ","(self: ",x(l)," -"," ",(0,Y.XL)(l/c),")"]}),!!m&&(0,n.jsxs)(n.Fragment,{children:[" (",m,")"]})]})]}),w&&(0,n.jsx)("span",{className:"moduleLabel",children:w.name}),(0,n.jsx)("div",{className:"bar",children:(0,n.jsx)("span",{className:"inner",style:{width:(0,Y.XL)(o/c)}})})]})}function eU(e){let{node:t,mappings:s,lookup:r}=e;if(!r.enabled||!r.methods||!r.threads)return null;let a=t.getDetails();if("stackTrace"===a.type){let e=s.resolve(a);if("native"===e.type)return null;let{className:t,methodName:i,packageName:o}=e,l=r.methods.lookup("".concat(o).concat(t,".").concat(i,"()"));return(0,n.jsx)(eG,{desc:l})}if("thread"===a.type){let e=r.threads.lookup(a.name);return(0,n.jsx)(eG,{desc:e})}return null}s(3120);let eG=e=>{let{desc:t}=e;return t.result?(0,n.jsx)("span",{className:"infopoint","data-tooltip-id":"infopoint-tooltip","data-tooltip-html":t.result,children:(0,n.jsx)(u.g,{icon:d.iW_})}):null},eX=i.memo(e=>{let t,s,{parents:r,node:a,forcedTime:l}=e,c=(0,i.useContext)(eh),d=(0,i.useContext)(ef),u=(0,i.useContext)(eg),m=(0,i.useContext)(ev),p=(0,i.useContext)(ej),h=(0,i.useContext)(eV)&&0!==r.length,f=0!==r.length?r[r.length-1]:null,[g,v]=(0,i.useState)(()=>!!u.check(a)||null!=f&&(h?f.getParents():f.getChildren()).filter(e=>m.matches(e)).length<=1);(0,i.useEffect)(()=>{u.check(a)&&v(!0)},[u,a]);let x=(0,i.useMemo)(()=>r.concat([a]),[r,a]),{show:w}=(0,o.EF)({id:"sampler-cm"});if(!m.matches(a))return null;let j=H()({node:!0,collapsed:!g,parent:0===r.length}),y=H()({"node-info":!0,bookmarked:u.has(a)}),b=p.getTime(a),S=0===r.length?b:p.getTime(r[0]),N=h&&l||b,k=h?0:N-a.getChildren().reduce((e,t)=>e+p.getTime(t),0);if(0===N&&0===b)return null;if(f){let e=f instanceof eN&&f.getSourceTime()||p.getTime(f);t=l?.5:b<e?b/e:e/b,s=e!==b?t:0}else t=1,s=0;let T=a.getId(),C="node-".concat(Array.isArray(T)?T.join("-"):String(T));return(0,n.jsxs)("li",{id:C,className:j,children:[(0,n.jsx)("div",{className:y,onClick:function(e){e.altKey?u.toggle(a):v(!g)},onContextMenu:function(e){e.preventDefault(),w({event:e,props:{node:a}})},children:(0,n.jsxs)(ez,{time:N,selfTime:k,threadTime:S,importance:s,significance:t,source:a.getSource(),infoPoint:(0,n.jsx)(eU,{node:a,mappings:c,lookup:d}),isSourceRoot:a instanceof eN,children:[(0,n.jsx)(eO,{details:a.getDetails(),mappings:c}),(0,n.jsx)(eB,{node:a,parent:f})]})}),g&&(0,n.jsx)("ul",{className:"children",children:(h?a.getParents():a.getChildren()).sort((e,t)=>p.getTime(t)-p.getTime(e)).map((e,t)=>(0,n.jsx)(eX,{node:e,forcedTime:h&&(l||2===r.length)?N:void 0,parents:x},t))})]})});eX.displayName="BaseNode";let eq=eX;function eQ(e){let{children:t}=e,{t:s}=(0,ea.o)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h3",{children:s("viewer.allView.title")}),(0,n.jsx)("div",{className:"header-controls",children:t})]})}function eY(e){let{data:t,setLabelMode:s,view:r,setView:a,sourcesViewSupported:o,metadata:l}=e,c=(0,i.useContext)(ew),d=(0,i.useContext)(eg),[u,m]=(0,i.useState)(!1),[p,h]=(0,i.useState)([]),f=(0,i.useRef)(!1);(0,i.useEffect)(()=>{if(!f.current&&(f.current=!0,d.isEmpty())){let e=ed(t,1);if(e.length>0){let t=e[0];d.replace(t.node)}}},[t,d]);let{t:g}=(0,ea.o)();return(0,n.jsxs)(ei.A,{className:"allview",title:g("viewer.functionList")||"Function List",children:[(0,n.jsxs)(eQ,{children:[(0,n.jsx)(eA,{onClick:function(){h(ed(t,20)),m(!0)}}),(0,n.jsx)("div",{style:{marginLeft:6}}),(0,n.jsx)(eD,{metadata:l,view:r,setView:a,sourcesViewSupported:o}),(0,n.jsx)(e_,{labelMode:c,setLabelMode:s})]}),(0,n.jsx)("div",{className:"stack",children:t.threads.map(e=>(0,n.jsx)(eq,{parents:[],node:new K(t,e)},e.name))}),(0,n.jsx)(eE,{topFunctions:p,isOpen:u,onClose:()=>m(!1),onFunctionClick:function(e){let t=e.node.getId(),s="node-".concat(Array.isArray(t)?t.join("-"):String(t)),n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=document.getElementById(s);t?t.scrollIntoView({behavior:"smooth",block:"center"}):e<8&&setTimeout(()=>n(e+1),100)};setTimeout(()=>n(),50)},data:t})]})}function e$(e){let{merged:t,setMerged:s}=e,{t:r}=(0,ea.o)();return(0,n.jsx)(eT,{value:t,setValue:s,title:r("viewer.sampler.buttons.mergeMode"),labelTrue:r("viewer.sampler.buttons.merge"),labelFalse:r("viewer.sampler.buttons.separate"),descriptionTrue:r("viewer.sampler.buttons.mergeDescription"),descriptionFalse:r("viewer.sampler.buttons.separateDescription")})}function eJ(e){var t;let{children:s}=e,r=(0,i.useContext)(ex),{t:a}=(0,ea.o)(),o=["Fabric","Forge","NeoForge"].includes(null==(t=r.platform)?void 0:t.name);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h3",{children:a(o?"viewer.sourcesView.modsTitle":"viewer.sourcesView.pluginsTitle")}),(0,n.jsx)("div",{className:"header-controls",children:s})]})}function eH(e){let{data:t,viewData:s,setLabelMode:r,view:a,setView:o,sourcesViewSupported:l,metadata:c}=e,d=(0,i.useContext)(ew),[u,p]=(0,i.useState)(!0),h=u?null==s?void 0:s.sourcesMerged:null==s?void 0:s.sourcesSeparate,[f,g]=(0,i.useState)(!1),[v,x]=(0,i.useState)([]),{t:w}=(0,ea.o)();return(0,n.jsxs)(ei.A,{className:"sourceview",title:w("viewer.functionList")||"Function List",children:[(0,n.jsxs)(eJ,{children:[(0,n.jsx)(eA,{onClick:()=>{x(ed(t,20)),g(!0)}}),(0,n.jsx)("div",{style:{marginLeft:6}}),(0,n.jsx)(eD,{metadata:c,view:a,setView:o,sourcesViewSupported:l}),(0,n.jsx)(e_,{labelMode:d,setLabelMode:r}),(0,n.jsx)(e$,{merged:u,setMerged:p})]}),h?(0,n.jsxs)(n.Fragment,{children:[h.map(e=>(0,n.jsx)(e0,{data:t,viewData:e},e.source)),(0,n.jsx)(e1,{alreadyShown:h.map(e=>e.source)})]}):(0,n.jsx)(m.A,{children:"Loading..."}),(0,n.jsx)(eE,{topFunctions:v,isOpen:f,onClose:()=>g(!1),onFunctionClick:e=>{let t=e.node.getId(),s="node-".concat(Array.isArray(t)?t.join("-"):String(t)),n=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=document.getElementById(s);t?t.scrollIntoView({behavior:"smooth",block:"center"}):e<8&&setTimeout(()=>n(e+1),100)};setTimeout(()=>n(),50)},data:t})]})}let eZ=e=>e.startsWith("v")?e:"v"+e,e0=e=>{let{data:t,viewData:s}=e,{source:r,threads:a}=s,o=(0,i.useContext)(ex).sources[r.toLowerCase()];return(0,n.jsxs)("div",{className:"stack",children:[(0,n.jsxs)("h2",{children:[r," ",o&&(0,n.jsxs)("span",{className:"version",children:["(",eZ(o.version),")"]})]}),a.map(e=>(0,n.jsx)(eq,{parents:[],node:new eN(t,e)},e.name))]})},e1=e=>{var t;let{alreadyShown:s}=e,r=(0,i.useContext)(ex);if(!r.sources)return null;let a=Object.values(r.sources).filter(e=>!s.includes(e.name)).filter(e=>!e.builtIn);if(!a.length)return null;let o=["Fabric","Forge","NeoForge"].includes(null==r||null==(t=r.platform)?void 0:t.name)?"mods":"plugins";return(0,n.jsxs)("div",{className:"other-sources",children:[(0,n.jsx)("h2",{children:"Other"}),(0,n.jsxs)("p",{children:["The following other ",o," are installed, but didn't show up in this profile. Yay!"]}),(0,n.jsx)("ul",{children:a.map(e=>{let{name:t,version:s}=e;return(0,n.jsxs)("li",{children:[t," ",(0,n.jsxs)("span",{children:["(",eZ(s),")"]})]},t)})})]})};var e5=s(9893);async function e2(){let e=await fetch("https://spark-infopoints.lucko.me/points.json");return await e.json()}class e3{lookup(e){let t=this.map.get(e);if(t)return t;for(let[t,s]of this.regexMap)if(t.test(e)){let t={result:s};return this.map.set(e,t),t}return this.map.set(e,e3.EMPTY_RESULT),e3.EMPTY_RESULT}constructor(e,t){for(let s of(this.map=new Map,this.regexMap=new Map,e.points))for(let e of t(s)){let t=e3.REGEX_KEY.exec(e);if(t){let e=new RegExp(t[1]);this.regexMap.set(e,s.description)}else this.map.set(e,{result:s.description})}}}e3.EMPTY_RESULT={},e3.REGEX_KEY=/\/(.+)\//;var e8=s(2127);let e4="".concat(e8._.NEXT_PUBLIC_SPARK_MAPPINGS_URL,"/dist/");async function e7(){let e=await fetch(e4+"mappings.json");return await e.json()}async function e6(e,t,s){let n=await fetch(e4+e+"/"+t+".wasm");return s(new Uint8Array(await n.arrayBuffer()))}class e9{map(e){return{}}constructor(){}}e9.INSTANCE=new e9;class te{map(e){let t;if(!e.className.startsWith(this.expectedPackage))return{};let s=e.className.substring(this.expectedPackage.length);if(t=this.nmsVersion?this.bukkitMappings.classes[s]:this.bukkitMappings.classes["net.minecraft."+s],"MinecraftServer"===s&&(t=this.bukkitMappings.classes["net.minecraft.server.MinecraftServer"]),!t)return{};let n=t.obfuscated,r=this.outputMappings.classes[n];if(!r||t.methods.some(t=>t.mapped===e.methodName))return{};let a=r.methods.filter(t=>t.obfuscated===e.methodName);if(!a)return{};if(1===a.length)return{methodName:a[0].mapped};if(!e.methodDesc)return{};for(let t of a){let s=t.description.replace(/L([^;]+);/g,e=>{let t=e.substring(1,e.length-1),s=this.classesObfuscated[t];if(s)if(this.nmsVersion)return"Lnet/minecraft/server/"+this.nmsVersion+"/"+s.mapped+";";else return"L"+s.mapped.replaceAll(".","/")+";";return e});if(e.methodDesc===s)return{methodName:t.mapped}}return{}}constructor(e,t,s){for(let n of(this.outputMappings=e,this.bukkitMappings=t,this.nmsVersion=s,s?this.expectedPackage="net.minecraft.server."+s+".":this.expectedPackage="net.minecraft.",this.classesObfuscated={},Object.values(t.classes)))this.classesObfuscated[n.obfuscated]=n}}class tt{map(e){return{methodName:this.mcpMappings.methods[e.methodName]}}constructor(e){this.mcpMappings=e}}class ts{map(e){let t,s=e.className.match(/^(.+)(\$\$Lambda.+)$/),n=s?this.mojangMappings.classes[s[1]]:this.mojangMappings.classes[e.className];if(!n)return{};let r=n.mapped+(s?s[2]:""),a=n.methods.filter(t=>t.obfuscated===e.methodName);if(1===a.length)t=a[0].mapped;else if(a.length>1){let s=a.find(t=>t.description===e.methodDesc);s&&(t=s.mapped)}return{className:r,methodName:t}}constructor(e){this.mojangMappings=e}}class tn{map(e){let t=this.yarnMappings.methods[e.methodName],s=e.className.match(/^(.+)(\$\$Lambda.+)$/);return{className:s?(this.yarnMappings.classes[s[1]]||s[1])+s[2]:this.yarnMappings.classes[e.className],methodName:t}}constructor(e){this.yarnMappings=e}}async function tr(e,t,s){if("auto"===e){let n=function(e,t){if(!e.auto||!t||!t.platform||!t.platform.name||!t.platform.minecraftVersion||t.platform.type===I.KI.PROXY)return null;let s=t.platform.minecraftVersion.match(/(\d+\.\d+) Release Candidate \d+/);s&&(t.platform.minecraftVersion=s[1]);let n=t.platform.name.toLowerCase();"paper"===n?n="bukkit":t.platform.type===I.KI.APPLICATION&&(n="vanilla");let r=n+"/"+t.platform.minecraftVersion;return e.auto[r]}(t,s);if(!n)return e9.INSTANCE;e=n}if(e.startsWith("bukkit-mojang")){let s=e.substring(14),n=t.types["bukkit-mojang"].versions[s].nmsVersion,r=t.types["bukkit-mojang"].versions[s].mojangClassNamesAtRuntime;if(!n&&!r)throw Error("No NMS version specified!");let[a,i]=await Promise.all([e6(s,"mojang",e=>I.cx.fromBinary(e)),e6(s,"bukkit",e=>I.oj.fromBinary(e))]);return new te(a,i,n)}if(e.startsWith("bukkit")){let s=e.substring(7),n=t.types.bukkit.versions[s].nmsVersion,[r,a]=await Promise.all([e6(s,"mcp",e=>I.Qx.fromBinary(e)),e6(s,"bukkit",e=>I.oj.fromBinary(e))]);return new te(r,a,n)}if(e.startsWith("mcp")){let t=e.substring(4);return new tt(await e6(t,"mcp",e=>I.Qx.fromBinary(e)))}if(e.startsWith("yarn")){let t=e.substring(5);return new tn(await e6(t,"yarn",e=>I.CO.fromBinary(e)))}{if(!e.startsWith("vanilla"))return e9.INSTANCE;let t=e.substring(8);return new ts(await e6(t,"mojang",e=>I.cx.fromBinary(e)))}}class ta{resolve(e){let t,s;if("native"===e.className)return{type:"native"};let{className:n,methodName:r}=this.mappingFunction.map(e)||{},a=!!n,i=!!r;n=n||e.className,r=r||e.methodName;let o=n.indexOf("$$Lambda");return -1!==o&&(t=n.substring(o),n=n.substring(0,o)),-1!==(o=n.lastIndexOf("."))&&(s=n.substring(0,o+1),n=n.substring(o+1)),{type:"normal",className:n,methodName:r,packageName:s,lambda:t,remappedClass:a,remappedMethod:i}}constructor(e){this.mappingFunction=e}}var ti=s(1528),to=s.n(ti);function tl(e){let{value:t,toggle:s}=e;return(0,n.jsxs)("label",{className:to().switch,children:[(0,n.jsx)("input",{type:"checkbox",checked:t,onChange:()=>s()}),(0,n.jsx)("span",{className:to().slider})]})}function tc(e){let t,{mappingsMetadata:s,mappings:r,setMappings:a}=e,i=[{id:"none",label:"None",options:[{id:"auto",label:"Auto Detect"},{id:"none",label:"No Mappings"}]}];for(t in s.types){let e=s.types[t],n=[];for(let s of Object.keys(e.versions)){let r=e.versions[s],a=e.format.replace("%s",r.name);n.push({id:t+"-"+s,label:a})}i.push({id:t,label:e.name,options:n})}return(0,n.jsx)("span",{className:"dropdown",id:"mappings-selector",children:(0,n.jsx)("select",{title:"mappings",value:r,onChange:e=>a(e.target.value),children:i.map(e=>(0,n.jsx)(td,{group:e},e.id))})})}let td=e=>{let{group:t}=e;return(0,n.jsx)("optgroup",{label:t.label,children:t.options.map(e=>(0,n.jsx)(tu,{option:e},e.id))})},tu=e=>{let{option:t}=e;return(0,n.jsx)("option",{value:t.id,children:t.label})};function tm(e){let{mappingsMetadata:t,mappings:s,setMappings:r,infoPoints:a,toggleInfoPoints:i}=e,{t:o}=(0,ea.o)();return(0,n.jsxs)(m.A,{extraClassName:c()["settings-menu"],children:[t&&(0,n.jsx)(tp,{name:o("viewer.settings.mappings.title")||"Mappings",desc:o("viewer.settings.mappings.description")||"Select which deobfuscation mappings the viewer should use when displaying profiler frames.",children:(0,n.jsx)(tc,{mappingsMetadata:t,mappings:s,setMappings:r})}),(0,n.jsx)(tp,{name:o("viewer.settings.infoPoints.title")||"Info Points",desc:o("viewer.settings.infoPoints.description")||"Select whether info points should be shown.",children:(0,n.jsx)(tl,{value:a,toggle:i})})]})}let tp=e=>{let{name:t,desc:s,children:r}=e;return(0,n.jsxs)("div",{className:"setting",children:[(0,n.jsxs)("div",{className:"setting-control",children:[(0,n.jsx)(u.g,{icon:d._$s})," ",(0,n.jsxs)("span",{children:[t,":"]})," ",r]}),(0,n.jsx)("p",{children:s})]})};var th=s(6167),tf=s.n(th);function tg(e){let{isOpen:t,onClose:s,node:r,metadata:a,highlighted:o}=e,{t:l}=(0,ea.o)(),c=(0,i.useMemo)(()=>null==r?void 0:r.getSource(),[r]),m=(0,i.useMemo)(()=>{try{var e;if(!c||!a)return;return null==(e=a.sources)?void 0:e[c]}catch(e){return}},[c,a]),p=(0,i.useMemo)(()=>{if(!r||!a)return[];let e=new Map,t=new Set,s=[r];for(;s.length;){let n=s.shift(),r=Array.isArray(n.getId())?n.getId().join("-"):String(n.getId());if(t.has(r))continue;t.add(r);let a=n.getSource();if(a){let t=e.get(a)||0;e.set(a,t+("function"==typeof n.getTime?n.getTime():0))}for(let e of n.getParents()){let n=Array.isArray(e.getId())?e.getId().join("-"):String(e.getId());t.has(n)||s.push(e)}for(let e of n.getChildren()){let n=Array.isArray(e.getId())?e.getId().join("-"):String(e.getId());t.has(n)||s.push(e)}}c&&e.delete(c);let n=Array.from(e.entries()).sort((e,t)=>t[1]-e[1]).slice(0,8).map(e=>{let[t,s]=e;return{key:t,total:s}}),i=n.reduce((e,t)=>e+t.total,0);return n.map(e=>(0,k._)((0,v._)({},e),{percent:i>0?e.total/i:0}))},[r,a,c]);return t?(0,n.jsx)("div",{className:tf().backdrop,onClick:function(e){e.target===e.currentTarget&&s()},children:(0,n.jsxs)("div",{className:tf().modal,role:"dialog","aria-modal":!0,children:[(0,n.jsxs)("div",{className:tf().header,children:[(0,n.jsx)("h2",{children:l("viewer.sourceModal.title")}),(0,n.jsx)("button",{className:tf().closeButton,onClick:s,"aria-label":l("common.close"),children:(0,n.jsx)(u.g,{icon:d.GRI})})]}),(0,n.jsxs)("div",{className:tf().content,children:[!c&&(0,n.jsx)("div",{className:tf().empty,children:l("viewer.sourceModal.noSource")}),c&&(0,n.jsxs)("div",{className:tf().field,children:[(0,n.jsx)("div",{className:"label",children:l("viewer.sourceModal.sourceKey")}),(0,n.jsx)("div",{className:"value",children:c})]}),m?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:tf().field,children:[(0,n.jsx)("div",{className:"label",children:l("viewer.sourceModal.name")}),(0,n.jsx)("div",{className:"value",children:m.name||"-"})]}),(0,n.jsxs)("div",{className:tf().field,children:[(0,n.jsx)("div",{className:"label",children:l("viewer.sourceModal.version")}),(0,n.jsx)("div",{className:"value",children:m.version||"-"})]}),(0,n.jsxs)("div",{className:tf().field,children:[(0,n.jsx)("div",{className:"label",children:l("viewer.sourceModal.author")}),(0,n.jsx)("div",{className:"value",children:m.author||"-"})]}),m.description&&(0,n.jsxs)("div",{className:tf().field,children:[(0,n.jsx)("div",{className:"label",children:l("viewer.sourceModal.description")}),(0,n.jsx)("div",{className:"value",children:m.description})]})]}):c?(0,n.jsx)("div",{className:tf().empty,children:l("viewer.sourceModal.notFound")}):(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:tf().field,children:[(0,n.jsx)("div",{className:"label",children:l("viewer.sourceModal.suggestionsTitle")}),0===p.length?(0,n.jsx)("div",{className:"value",children:l("viewer.sourceModal.suggestionsNone")}):(0,n.jsx)("div",{className:"value",children:(0,n.jsx)("ul",{children:p.map((e,t)=>{var i;let l=null==(i=a.sources)?void 0:i[e.key];return(0,n.jsxs)("li",{onClick:()=>(function(e,t){let n=function(e){if(!r)return;let t=new Set,s=[r];for(;s.length;){let n=s.shift(),r=Array.isArray(n.getId())?n.getId().join("-"):String(n.getId());if(!t.has(r)){if(t.add(r),n.getSource()===e)return n;for(let e of n.getParents()){let n=Array.isArray(e.getId())?e.getId().join("-"):String(e.getId());t.has(n)||s.push(e)}for(let e of n.getChildren()){let n=Array.isArray(e.getId())?e.getId().join("-"):String(e.getId());t.has(n)||s.push(e)}}}}(e);if(!n)return;try{t&&"function"==typeof t.replaceSilently?t.replaceSilently(n):null==t||t.replace(n)}catch(e){}let a=n.getId(),i="node-".concat(Array.isArray(a)?a.join("-"):String(a));setTimeout(()=>{let e=document.getElementById(i);e&&e.scrollIntoView({behavior:"smooth",block:"center"})},120),s()})(e.key,o),style:{cursor:"pointer"},children:[(0,n.jsx)("span",{children:(null==l?void 0:l.name)?"".concat(l.name).concat(l.version?" "+l.version:""):e.key}),(0,n.jsxs)("span",{style:{float:"right",color:"#9f9f9f"},children:[(0,Y.fU)(e.total),"ms • ",(0,Y.XL)(e.percent)]})]},t)})})})]})})]})]})}):null}let tv=a()(()=>Promise.all([s.e(628),s.e(274)]).then(s.bind(s,4274)),{loadableGenerated:{webpack:()=>[4274]}});function tx(e){var t;let{data:s,fetchUpdatedData:r,metadata:a,setMetadata:l,exportCallback:d}=e,u=function(e){let[t,s]=(0,i.useState)(""),n=(0,i.useMemo)(()=>t?new N(e).resolveSearchQuery(t):null,[e,t]);return{value:t,setValue:s,matches:(0,i.useCallback)(e=>{if(null==n)return!0;let t=e.getId();return Array.isArray(t)?t.some(e=>n.has(e)):n.has(t)},[n])}}(s),m=function(){let e=(0,x.useRouter)(),t=(0,i.useRef)(!1),s=(0,i.useRef)(!1),[n,r]=(0,i.useState)(()=>{let t=new Set,s=e.query.hl;return s&&s.split(",").forEach(e=>t.add(parseInt(e))),t});(0,i.useEffect)(()=>{let s=()=>{t.current=!0},n=()=>{t.current=!1};return e.events.on("routeChangeStart",s),e.events.on("routeChangeComplete",n),e.events.on("routeChangeError",n),()=>{e.events.off("routeChangeStart",s),e.events.off("routeChangeComplete",n),e.events.off("routeChangeError",n)}},[e.events]),(0,i.useEffect)(()=>{let r=Array.from(n).join(",");if(!r&&!e.query.hl||r===e.query.hl)return;let a=e.asPath,i=a.indexOf("?");if(i>=0&&(a=a.substring(0,i)),!("/[code]"===e.pathname||"/remote"===e.pathname||e.query.code)||t.current)return;if(s.current){s.current=!1;return}let o=(0,v._)({},e.query);n.size?o.hl=r:delete o.hl,e.push({pathname:e.pathname,query:o},void 0,{shallow:!0})},[n,e]);let a=(0,i.useCallback)(e=>{r(t=>{let s=new Set(t);return j(s,e.getId())?b(s,e.getId()):y(s,e.getId()),s})},[r]),o=(0,i.useCallback)(e=>{if(!n.size)return!1;if(j(n,e.getId()))return!0;for(let t of e.getChildren())if(o(t))return!0;return!1},[n]),l=(0,i.useCallback)(e=>j(n,e.getId()),[n]),c=(0,i.useCallback)(()=>r(new Set),[r]),d=(0,i.useCallback)(e=>{let t=new Set;y(t,e.getId()),r(t)},[r]);return{toggle:a,check:o,has:l,clear:c,replace:d,replaceSilently:(0,i.useCallback)(e=>{let t=new Set;y(t,e.getId()),s.current=!0,r(t)},[r]),isEmpty:(0,i.useCallback)(()=>0===n.size,[n])}}(),[w,S]=(0,i.useState)(!1),C=function(e,t){let s=(0,i.useMemo)(()=>e.length>1,[e]),[n,r]=(0,i.useState)(new Set),[a,o]=(0,i.useState)(!0),l=(0,i.useCallback)(e=>a||n.has(e),[n,a]),c=(0,i.useCallback)(t=>{let s=new Set(e.filter(t));r(s),o(e.length===s.size)},[e]),d=(0,i.useCallback)(t=>{let s=t.getTimes();return s&&!a?s.filter((t,s)=>l(e[s])).reduce((e,t)=>e+t,0):t.getTime()},[a,l,e]),u=(0,i.useCallback)(()=>{let s=0;for(let n of e)l(n)&&(s+=t[n].ticks);return s},[l,t,e]),m=(0,i.useCallback)(()=>{let s=0;for(let n of e)l(n)&&(s+=t[n].duration);return s},[l,t,e]);return{supported:s,times:e,isTimeSelected:l,setSelectedTimes:c,allTimesSelected:a,getTime:d,getTicksInRange:u,getMillisInRange:m}}(s.timeWindows,s.timeWindowStatistics),_=function(e){let[t,s]=(0,i.useState)(),[n,r]=(0,i.useState)(new ta(e9.INSTANCE)),[a,o]=(0,i.useState)("none"===(0,E.get)("spark-mappings-pref")?"none":"auto");(0,i.useEffect)(()=>{e7().then(s)},[]);let l=(0,i.useCallback)(s=>{t&&e&&a!==s&&(o(s),tr(s,t,e).then(e=>{r(new ta(e))}),"none"===s?(0,E.set)("spark-mappings-pref","none"):(0,E.remove)("spark-mappings-pref"))},[a,t,e]);return(0,i.useEffect)(()=>{t&&e&&"auto"===a&&tr("auto",t,e).then(e=>{r(new ta(e))})},[a,t,e]),{requestMappings:l,mappingsMetadata:t,mappingsResolver:n,mappingsType:a}}(a),M=function(){let[e,t,s]=(0,g.A)("prefInfoPoints",!0),[n,r]=(0,i.useState)(),[a,o]=(0,i.useState)();return(0,i.useEffect)(()=>{e2().then(e=>{r(new e3(e,e=>e.methods)),o(new e3(e,e=>e.threads))})},[]),{methods:n,threads:a,enabled:e,setEnabled:t,toggleEnabled:s}}(),[I,A]=(0,i.useState)(),[F,L]=(0,i.useState)(!1),[P,D]=(0,i.useState)(),[V,R]=(0,i.useState)("all"),[B,z]=(0,g.A)("prefShowGraph",!0),[U,G]=(0,i.useState)(!1),[X,q]=(0,g.A)("prefShowSocket",!1),[Q,$]=(0,i.useState)(),[J,H]=(0,i.useState)();(0,i.useEffect)(()=>{(async()=>{let e=await W.create(s);s.sources.hasSources()&&H(await e.generateSourcesView()),$(await e.generateFlatView()),e.close()})(),1===s.threads.length&&A(new K(s,s.threads[0]))},[s]);let Z=function(e){var t,s;let{socket:n,fetchUpdatedData:r,metadata:a,setMetadata:o}=e,[l,c]=(0,i.useState)(),[d,u]=(0,i.useState)();return t=n.socket,s=(0,i.useCallback)(e=>{if("serverUpdateStatistics"===e.oneofKind){var t;let{platform:s,system:n}=e.serverUpdateStatistics,r=(0,k._)((0,v._)({},s),{world:null==(t=a.platformStatistics)?void 0:t.world});o((0,k._)((0,v._)({},a),{platformStatistics:r,systemStatistics:n})),c(Date.now())}return"serverUpdateSampler"===e.oneofKind&&(r(e.serverUpdateSampler.payloadId),u(Date.now())),T.KEEP_LISTENING},[a,o,r]),(0,i.useEffect)(()=>{if(t)return t.eventBus.register(s)},[t,s]),{socket:n,lastStatsUpdate:l,lastSamplerUpdate:d}}({socket:function(e,t){let[s,n]=(0,i.useState)(!1),[r,a]=(0,i.useState)(),[o,l]=(0,i.useState)(),[c,d]=(0,i.useState)(!1),[u,m]=(0,i.useState)(),[p,h]=(0,i.useState)(),f=(0,i.useCallback)(async e=>{await O.connect(e,{onConnect(e,s,n,r,i){a(e),l(r),d(n),m(s),i&&t(i)},onPing(e){h(e)},onClose(){a(void 0)}})},[t]);return(0,i.useEffect)(()=>{e&&!s&&(n(!0),f(e).catch(e=>{console.log("Error initialising the socket",e)}))},[e,s,f]),{socket:r,clientId:o,trusted:c,settings:u,latency:p}}(s.channelInfo,r),fetchUpdatedData:r,metadata:a,setMetadata:l}),ee=(0,f.A)(),{t:et}=(0,ea.o)(),es=(null==a||null==(t=a.platform)?void 0:t.sparkVersion)&&a.platform.sparkVersion>=2;return(0,n.jsxs)("div",{className:c().sampler,children:[(0,n.jsx)(er,{data:s,metadata:a,metadataToggle:ee,exportCallback:d,showSettings:U,setShowSettings:G,view:V,setView:R,sourcesViewSupported:s.sources.hasSources(),graphSupported:C.supported,showGraph:B,setShowGraph:z,socket:Z,showSocketInfo:X,setShowSocketInfo:q,flameData:I,setFlameData:A,searchQuery:u}),U&&(0,n.jsx)(tm,{mappingsMetadata:_.mappingsMetadata,mappings:_.mappingsType,setMappings:_.requestMappings,infoPoints:M.enabled,toggleInfoPoints:M.toggleEnabled}),X&&Z.socket.socket&&(0,n.jsx)(ep,{socket:Z}),(0,n.jsx)(eu,{data:s,highlighted:m}),!es&&(0,n.jsx)(p,{}),(0,n.jsx)(h.A,{metadata:a,metadataToggle:ee}),C.supported&&(0,n.jsx)(i.Suspense,{fallback:null,children:(0,n.jsx)(tv,{show:B,timeSelector:C,windowStatistics:s.timeWindowStatistics})}),(0,n.jsxs)(ey,{mappings:_.mappingsResolver,infoPoints:M,highlighted:m,searchQuery:u,labelMode:w,metadata:a,timeSelector:C,children:["all"===V?(0,n.jsx)(eY,{data:s,setLabelMode:S,view:V,setView:R,sourcesViewSupported:s.sources.hasSources(),metadata:a}):V===eP?(0,n.jsx)(eR,{data:s,viewData:Q,setLabelMode:S,view:V,setView:R,sourcesViewSupported:s.sources.hasSources(),metadata:a}):(0,n.jsx)(eH,{data:s,viewData:J,setLabelMode:S,view:V,setView:R,sourcesViewSupported:s.sources.hasSources(),metadata:a}),M.enabled&&(0,n.jsx)(e5.m_,{id:"infopoint-tooltip",place:"right",className:"infopoint-tooltip",clickable:!0})]}),!!I&&(0,n.jsx)(ec,{flameData:I,mappings:_.mappingsResolver,metadata:a,timeSelector:C}),0===s.threads.length&&(0,n.jsx)(em,{isConnectedToSocket:!!Z.socket.socket}),(0,n.jsxs)(o.W1,{id:"sampler-cm",theme:"dark",children:[(0,n.jsx)(o.q7,{onClick:function(e){var t;let s=null==(t=e.props)?void 0:t.node;s&&A(s)},children:et("viewer.contextMenu.viewAsFlame")}),(0,n.jsx)(o.q7,{onClick:function(e){var t;let s=null==(t=e.props)?void 0:t.node;s&&(D(s),L(!0))},children:et("viewer.contextMenu.showSource")}),(0,n.jsx)(o.q7,{onClick:function(e){var t;let s=null==(t=e.props)?void 0:t.node;if(!s)return;let n=[],r=s;for(;r;){n.push(r);let e=r.getParents();r=e&&e.length>0?e[0]:void 0}let a=n.slice().reverse(),i=a[0],o=i?C.getTime(i):0,l=a.map((e,t)=>{let s=e.getDetails(),n="";"thread"===s.type?n=s.name:(n="".concat(s.className,".").concat(s.methodName),void 0!==s.lineNumber&&null!==s.lineNumber&&(n+=":".concat(s.lineNumber)));let r=C.getTime(e),a="  ".repeat(t);return"".concat(a).concat(n," — ").concat((0,Y.fU)(r)," ms (").concat((0,Y.XL)(o?r/o:0),")")}).join("\n");if(navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(l).catch(()=>{let e=document.createElement("textarea");e.value=l,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove()});else{let e=document.createElement("textarea");e.value=l,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove()}},children:et("viewer.contextMenu.copyFullChain")}),(0,n.jsx)(o.q7,{onClick:function(e){var t;let s=null==(t=e.props)?void 0:t.node;if(!s)return;let n=s.getDetails(),r="";if("thread"===n.type?r=n.name:(r="".concat(n.className,".").concat(n.methodName),void 0!==n.lineNumber&&null!==n.lineNumber&&(r+=":".concat(n.lineNumber))),navigator.clipboard&&navigator.clipboard.writeText)navigator.clipboard.writeText(r).catch(()=>{let e=document.createElement("textarea");e.value=r,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove()});else{let e=document.createElement("textarea");e.value=r,document.body.appendChild(e),e.select(),document.execCommand("copy"),e.remove()}},children:et("viewer.contextMenu.copyFunctionName")}),(0,n.jsx)(o.q7,{onClick:function(e){e.props&&m.toggle(e.props.node)},children:et("viewer.contextMenu.toggleBookmark")}),(0,n.jsx)(o.q7,{onClick:function(){m.clear()},children:et("viewer.contextMenu.clearBookmarks")})]}),(0,n.jsx)(tg,{isOpen:F,onClose:()=>L(!1),node:P,metadata:a,highlighted:m})]})}}}]);